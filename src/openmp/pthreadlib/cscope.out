cscope 15 $HOME/nautilus/src/openmp/pthreadlib               0000134221
	@cleanup.c

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

55 
±e_˛ónup_t
 *

56 
	$±e_p›_˛ónup
 (
execuã
)

82 
±e_˛ónup_t
 *
˛ónup
;

84 
˛ónup
 = (
±e_˛ónup_t
 *Ë
	`±hªad_gë•ecific
 (
±e_˛ónupKey
);

86 i‡(
˛ónup
 !
NULL
)

88 i‡(
execuã
 && (
˛ónup
->
routöe
 !
NULL
))

91 (*
˛ónup
->
routöe
Ë(˛ónup->
¨g
);

95 
	`±hªad_£t•ecific
 (
±e_˛ónupKey
, (*Ë
˛ónup
->
¥ev
);

99  (
˛ónup
);

101 
	}
}

105 
	$±e_push_˛ónup
 (
±e_˛ónup_t
 * 
˛ónup
,

106 
±e_˛ónup_ˇŒback_t
 
routöe
, *
¨g
)

147 
˛ónup
->
routöe
 =Ñoutine;

148 
˛ónup
->
¨g
 =árg;

150 
˛ónup
->
¥ev
 = (
±e_˛ónup_t
 *Ë
	`±hªad_gë•ecific
 (
±e_˛ónupKey
);

152 
	`±hªad_£t•ecific
 (
±e_˛ónupKey
, (*Ë
˛ónup
);

154 
	}
}

	@create.c

44 
	~"nk/±e_oßl.h
"

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

47 
	~<«utûus/«utûus.h
>

50 
	$±hªad_¸óã
 (
±hªad_t
 * 
tid
,

51 c⁄° 
±hªad_©å_t
 * 
©å
,

52 *(*
°¨t
Ë(*), *
¨g
)

91 
±hªad_t
 
thªad
;

92 
±e_thªad_t
 * 
ç
;

93 
±hªad_©å_t
 
a
;

94 
ªsu…
 = 
EAGAIN
;

95 
run
 = 
PTE_TRUE
;

96 
ThªadP¨ms
 *
∑rms
 = 
NULL
;

97 
°ackSize
;

98 
¥i‹ôy
 = 0;

99 
±hªad_t
 
£lf
;

100 
±e_osResu…
 
osResu…
;

108 i‡(
tid
 !
NULL
)

110 
tid
->
x
 = 0;

113 i‡(
©å
 !
NULL
)

115 
a
 = *
©å
;

119 
a
 = 
NULL
;

122 i‡((
thªad
 = 
	`±e_√w
 ()).
p
 =
NULL
)

124 
FAIL0
;

127 
ç
 = (
±e_thªad_t
 *Ë
thªad
.
p
;

129 
¥i‹ôy
 = 
ç
->
sched_¥i‹ôy
;

131 i‡((
∑rms
 = (
ThªadP¨ms
 *Ë
	`mÆloc
 ( (*∑rms))Ë=
NULL
)

133 
FAIL0
;

136 
∑rms
->
tid
 = 
thªad
;

137 
∑rms
->
°¨t
 = start;

138 
∑rms
->
¨g
 =árg;

140 i‡(
a
 !
NULL
)

142 
°ackSize
 = 
a
->
°acksize
;

143 
ç
->
dëachSèã
 = 
a
->
dëach°©e
;

144 
¥i‹ôy
 = 
a
->
∑øm
.
sched_¥i‹ôy
;

146 i‡–(
¥i‹ôy
 > 
	`±e_osThªadGëMaxPri‹ôy
()) ||

147 (
¥i‹ôy
 < 
	`±e_osThªadGëMöPri‹ôy
()) )

149 
ªsu…
 = 
EINVAL
;

150 
FAIL0
;

160 i‡(
PTHREAD_INHERIT_SCHED
 =
a
->
öhîôsched
)

167 
£lf
 = 
	`±hªad_£lf
 ();

168 
¥i‹ôy
 = ((
±e_thªad_t
 *Ë
£lf
.
p
)->
sched_¥i‹ôy
;

178 
°ackSize
 = 
PTHREAD_STACK_MIN
;

182 
ç
->
°©e
 = 
run
 ? 
PThªadSèãInôül
 : 
PThªadSèãSu•íded
;

184 
ç
->
keys
 = 
NULL
;

194 
ªsu…
 = 
	`±hªad_muãx_lock
 (&
ç
->
thªadLock
);

196 i‡(0 =
ªsu…
)

202 
ç
->
sched_¥i‹ôy
 = 
¥i‹ôy
;

204 (Ë
	`±hªad_muãx_u∆ock
 (&
ç
->
thªadLock
);

208 
osResu…
 = 
	`±e_osThªadCª©e
(&
±e_thªadSèπ
,

209 
°ackSize
,

210 
¥i‹ôy
,

211 
∑rms
,

212 &(
ç
->
thªadId
));

214 i‡(
osResu…
 =
PTE_OS_OK
)

216 
	`±e_osThªadSèπ
(
ç
->
thªadId
);

217 
ªsu…
 = 0;

221 
ç
->
thªadId
 = 0;

222 
ªsu…
 = 
EAGAIN
;

223 
FAIL0
;

236 
FAIL0
:

237 i‡(
ªsu…
 != 0)

240 
	`±e_thªadDe°roy
 (
thªad
);

241 
ç
 = 
NULL
;

243 i‡(
∑rms
 !
NULL
)

245 
	`‰ì
 (
∑rms
);

250 i‡(
tid
 !
NULL
)

252 *
tid
 = 
thªad
;

256  (
ªsu…
);

258 
	}
}

	@global.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

48 
	g±e_¥o˚ssInôülized
 = 
PTE_FALSE
;

49 
±e_thªad_t
 * 
	g±e_thªadReu£T›
 = 
PTE_THREAD_REUSE_EMPTY
;

50 
±e_thªad_t
 * 
	g±e_thªadReu£BŸtom
 = 
PTE_THREAD_REUSE_EMPTY
;

51 
±hªad_key_t
 
	g±e_£lfThªadKey
 = 
NULL
;

52 
±hªad_key_t
 
	g±e_˛ónupKey
 = 
NULL
;

53 
±hªad_c⁄d_t
 
	g±e_c⁄d_li°_hód
 = 
NULL
;

54 
±hªad_c⁄d_t
 
	g±e_c⁄d_li°_èû
 = 
NULL
;

56 
	g±e_c⁄cuºícy
 = 0;

59 
	g±e_„©uªs
 = 0;

61 
	g±e_smp_sy°em
 = 
PTE_TRUE
;

66 
±e_osMuãxH™dÀ
 
	g±e_thªad_ªu£_lock
;

71 
±e_osMuãxH™dÀ
 
	g±e_muãx_ã°_öô_lock
;

77 
±e_osMuãxH™dÀ
 
	g±e_c⁄d_ã°_öô_lock
;

83 
±e_osMuãxH™dÀ
 
	g±e_rwlock_ã°_öô_lock
;

89 
±e_osMuãxH™dÀ
 
	g±e_•ölock_ã°_öô_lock
;

96 
±e_osMuãxH™dÀ
 
	g±e_c⁄d_li°_lock
;

	@implement.h

51 #i‚de‡
_IMPLEMENT_H


52 
	#_IMPLEMENT_H


	)

54 
	~"nk/±e_oßl.h
"

57 
	~"£m≠h‹e.h
"

58 
	~"sched.h
"

68 
	mPThªadSèãInôül
 = 0,

69 
	mPThªadSèãRu¬ög
,

70 
	mPThªadSèãSu•íded
,

71 
	mPThªadSèãC™˚lPídög
,

73 
	mPThªadSèãC™˚lög
,

76 
	mPThªadSèãEx˚±i⁄
,

78 
	mPThªadSèãLa°


80 
	tPThªadSèã
;

83 
±e_thªad_t_
 
	t±e_thªad_t
;

85 
	s±e_thªad_t_


87 
±e_osThªadH™dÀ
 
	mthªadId
;

88 
±hªad_t
 
	m±H™dÀ
;

89 
±e_thªad_t
 * 
	m¥evReu£
;

90 vﬁ©ûê
PThªadSèã
 
	m°©e
;

91 *
	mexôSètus
;

92 *
	m∑rms
;

93 
	m±Eºno
;

94 
	mdëachSèã
;

95 
±hªad_muãx_t
 
	mthªadLock
;

96 
	msched_¥i‹ôy
;

97 
±hªad_muãx_t
 
	mˇn˚lLock
;

98 
	mˇn˚lSèã
;

99 
	mˇn˚lTy≥
;

100 
	mˇn˚lEvít
;

101 #ifde‡
PTE_CLEANUP_C


102 
jmp_buf
 
	m°¨t_m¨k
;

104 
	mim∂icô
:

106 *
	mkeys
;

107 *
	m√xtAssoc
;

114 
	#PTE_ATTR_VALID
 ((Ë0xC4C0FFEE)

	)

116 
	s±hªad_©å_t_


118 
	mvÆid
;

119 *
	m°ackaddr
;

120 
size_t
 
	m°acksize
;

121 
	mdëach°©e
;

122 
sched_∑øm
 
	m∑øm
;

123 
	möhîôsched
;

124 
	mc⁄ã¡i⁄sc›e
;

136 
	s£m_t_


138 
	mvÆue
;

139 
±hªad_muãx_t
 
	mlock
;

140 
±e_osSem≠h‹eH™dÀ
 
	m£m
;

143 
	#PTE_OBJECT_AUTO_INIT
 ((*Ë-1)

	)

144 
	#PTE_OBJECT_INVALID
 0

	)

146 
	s±hªad_muãx_t_


148 
±e_osSem≠h‹eH™dÀ
 
	mh™dÀ
;

149 
	mlock_idx
;

156 
	mªcursive_cou¡
;

159 
	mköd
;

160 
±hªad_t
 
	mow√rThªad
;

163 
	s±hªad_muãx©å_t_


165 
	mpsh¨ed
;

166 
	mköd
;

186 
	#PTE_SPIN_UNLOCKED
 (1)

	)

187 
	#PTE_SPIN_LOCKED
 (2)

	)

188 
	#PTE_SPIN_USE_MUTEX
 (3)

	)

190 
	s±hªad_•ölock_t_


192 
	möãæock
;

195 
	m˝us
;

196 
±hªad_muãx_t
 
	mmuãx
;

197 } 
	mu
;

200 
	s±hªad_b¨rõr_t_


202 
	mnCuºítB¨rõrHeight
;

203 
	mnInôülB¨rõrHeight
;

204 
	miSãp
;

205 
	mpsh¨ed
;

206 
£m_t
 
	m£mB¨rõrBªeched
[2];

209 
	s±hªad_b¨rõøâr_t_


211 
	mpsh¨ed
;

214 
	s±hªad_key_t_


216 
	mkey
;

217 (*
	mde°ru˘‹
) (*);

218 
±hªad_muãx_t
 
	mkeyLock
;

219 *
	mthªads
;

223 
ThªadP¨ms
 
	tThªadP¨ms
;

224 
ThªadKeyAssoc
 
	tThªadKeyAssoc
;

226 
	sThªadP¨ms


228 
±hªad_t
 
	mtid
;

229 *(*
	m°¨t
) (*);

230 *
	m¨g
;

233 
	s±hªad_c⁄d_t_


235 
	mnWaôîsBlocked
;

236 
	mnWaôîsG⁄e
;

237 
	mnWaôîsToUnblock
;

238 
£m_t
 
	m£mBlockQueue
;

240 
£m_t
 
	m£mBlockLock
;

243 
±hªad_muãx_t
 
	mmtxUnblockLock
;

246 
±hªad_c⁄d_t
 
	m√xt
;

247 
±hªad_c⁄d_t
 
	m¥ev
;

251 
	s±hªad_c⁄d©å_t_


253 
	mpsh¨ed
;

256 
	#PTE_RWLOCK_MAGIC
 0xÁˇde2

	)

258 
	s±hªad_rwlock_t_


260 
±hªad_muãx_t
 
	mmtxEx˛usiveAc˚ss
;

261 
±hªad_muãx_t
 
	mmtxSh¨edAc˚ssCom∂ëed
;

262 
±hªad_c⁄d_t
 
	m˙dSh¨edAc˚ssCom∂ëed
;

263 
	mnSh¨edAc˚ssCou¡
;

264 
	mnEx˛usiveAc˚ssCou¡
;

265 
	mnCom∂ëedSh¨edAc˚ssCou¡
;

266 
	mnMagic
;

269 
	s±hªad_rwlock©å_t_


271 
	mpsh¨ed
;

277 
	s±e_mcs_node_t_


279 
±e_mcs_node_t_
 **
	mlock
;

280 
±e_mcs_node_t_
 *
	m√xt
;

281 
	mªadyFœg
;

283 
	m√xtFœg
;

287 
±e_mcs_node_t_
 
	t±e_mcs_loˇl_node_t
;

288 
±e_mcs_node_t_
 *
	t±e_mcs_lock_t
;

291 
	sThªadKeyAssoc


391 
±e_thªad_t
 * 
	mthªad
;

392 
±hªad_key_t
 
	mkey
;

393 
ThªadKeyAssoc
 *
	m√xtKey
;

394 
ThªadKeyAssoc
 *
	m√xtThªad
;

395 
ThªadKeyAssoc
 *
	m¥evKey
;

396 
ThªadKeyAssoc
 *
	m¥evThªad
;

405 
	#PTE_EPS_EXIT
 (1)

	)

406 
	#PTE_EPS_CANCEL
 (2)

	)

410 
	#PTE_MAX
(
a
,
b
Ë(◊)<(b)?(b):◊))

	)

411 
	#PTE_MIN
(
a
,
b
Ë(◊)>(b)?(b):◊))

	)

415 
	#PTE_THREAD_REUSE_EMPTY
 ((
±e_thªad_t
 *Ë1)

	)

417 
±e_¥o˚ssInôülized
;

418 
±e_thªad_t
 * 
±e_thªadReu£T›
;

419 
±e_thªad_t
 * 
±e_thªadReu£BŸtom
;

420 
±hªad_key_t
 
±e_£lfThªadKey
;

421 
±hªad_key_t
 
±e_˛ónupKey
;

422 
±hªad_c⁄d_t
 
±e_c⁄d_li°_hód
;

423 
±hªad_c⁄d_t
 
±e_c⁄d_li°_èû
;

425 
±e_muãx_deÁu…_köd
;

427 
±e_c⁄cuºícy
;

429 
±e_„©uªs
;

431 
±e_osMuãxH™dÀ
 
±e_thªad_ªu£_lock
;

432 
±e_osMuãxH™dÀ
 
±e_muãx_ã°_öô_lock
;

433 
±e_osMuãxH™dÀ
 
±e_c⁄d_li°_lock
;

434 
±e_osMuãxH™dÀ
 
±e_c⁄d_ã°_öô_lock
;

435 
±e_osMuãxH™dÀ
 
±e_rwlock_ã°_öô_lock
;

436 
±e_osMuãxH™dÀ
 
±e_•ölock_ã°_öô_lock
;

439 #ifde‡
__˝lu•lus


452 
±e_is_©å
 (c⁄° 
±hªad_©å_t
 * 
©å
);

454 
±e_c⁄d_check_√ed_öô
 (
±hªad_c⁄d_t
 * 
c⁄d
);

455 
±e_muãx_check_√ed_öô
 (
±hªad_muãx_t
 * 
muãx
);

456 
±e_rwlock_check_√ed_öô
 (
±hªad_rwlock_t
 * 
rwlock
);

457 
±e_•ölock_check_√ed_öô
 (
±hªad_•ölock_t
 * 
lock
);

459 
±e_¥o˚ssInôülize
 ();

461 
±e_¥o˚ssTîmö©e
 ();

463 
±e_thªadDe°roy
 (
±hªad_t
 
tid
);

464 
±e_thªadExôAndDe°roy
 (
±hªad_t
 
tid
);

466 
±e_p›_˛ónup_Æl
 (
execuã
);

468 
±hªad_t
 
±e_√w
 ();

470 
±hªad_t
 
±e_thªadReu£P›
 ();

472 
±e_thªadReu£Push
 (
±hªad_t
 
thªad
);

474 
±e_gë¥o˚ss‹s
 (*
cou¡
);

476 
±e_£âhªad¥i‹ôy
 (
±hªad_t
 
thªad
, 
pﬁicy
, 
¥i‹ôy
);

478 
±e_rwlock_ˇn˚lwrwaô
 (*
¨g
);

481 
±e_thªadSèπ
 (*
vthªadP¨ms
, ** 
out
);

483 
±e_ˇŒU£rDe°royRoutöes
 (
±hªad_t
 
thªad
);

485 
±e_tkAssocCª©e
 (
±e_thªad_t
 * 
thªad
, 
±hªad_key_t
 
key
);

487 
±e_tkAssocDe°roy
 (
ThªadKeyAssoc
 * 
assoc
);

489 
£m_waô_noˇn˚l
 (
£m_t
 * 
£m
);

491 
±e_ªlmûli£cs
 (c⁄° 
time•ec
 * 
ab°ime
);

493 
±e_mcs_lock_acquúe
 (
±e_mcs_lock_t
 * 
lock
, 
±e_mcs_loˇl_node_t
 * 
node
);

495 
±e_mcs_lock_ªÀa£
 (
±e_mcs_loˇl_node_t
 * 
node
);

498 
±e_throw
 (
ex˚±i⁄
);

500 
±e_ˇn˚ŒabÀ_waô
 (
±e_osSem≠h‹eH™dÀ
 
£mH™dÀ
, * 
timeout
);

502 
	#PTE_ATOMIC_EXCHANGE
 
±e_osAtomicExch™ge


	)

503 
	#PTE_ATOMIC_EXCHANGE_ADD
 
±e_osAtomicExch™geAdd


	)

504 
	#PTE_ATOMIC_COMPARE_EXCHANGE
 
±e_osAtomicCom∑ªExch™ge


	)

505 
	#PTE_ATOMIC_DECREMENT
 
±e_osAtomicDe¸emít


	)

506 
	#PTE_ATOMIC_INCREMENT
 
±e_osAtomicIn¸emít


	)

508 
±e_thªad_dëach_≈
();

509 
±e_thªad_dëach_™d_exô_≈
();

512 #ifde‡
__˝lu•lus


	@need_errno.h

16 #i‚de‡
_INC_ERRNO


17 
	#_INC_ERRNO


	)

19 #ifde‡ 
__˝lu•lus


28 
î∫o
;

32 
	#EPERM
 1

	)

33 
	#ENOENT
 2

	)

34 
	#ESRCH
 3

	)

35 
	#EINTR
 4

	)

36 
	#EIO
 5

	)

37 
	#ENXIO
 6

	)

38 
	#E2BIG
 7

	)

39 
	#ENOEXEC
 8

	)

40 
	#EBADF
 9

	)

41 
	#ECHILD
 10

	)

42 
	#EAGAIN
 11

	)

43 
	#ENOMEM
 12

	)

44 
	#EACCES
 13

	)

45 
	#EFAULT
 14

	)

46 
	#EBUSY
 16

	)

47 
	#EEXIST
 17

	)

48 
	#EXDEV
 18

	)

49 
	#ENODEV
 19

	)

50 
	#ENOTDIR
 20

	)

51 
	#EISDIR
 21

	)

52 
	#EINVAL
 22

	)

53 
	#ENFILE
 23

	)

54 
	#EMFILE
 24

	)

55 
	#ENOTTY
 25

	)

56 
	#EFBIG
 27

	)

57 
	#ENOSPC
 28

	)

58 
	#ESPIPE
 29

	)

59 
	#EROFS
 30

	)

60 
	#EMLINK
 31

	)

61 
	#EPIPE
 32

	)

62 
	#EDOM
 33

	)

63 
	#ERANGE
 34

	)

64 
	#EDEADLK
 36

	)

67 #i‚de‡
ENAMETOOLONG


68 
	#ENAMETOOLONG
 38

	)

71 
	#ENOLCK
 39

	)

72 
	#ENOSYS
 40

	)

75 #i‚de‡
ENOTEMPTY


76 
	#ENOTEMPTY
 41

	)

79 
	#EILSEQ
 42

	)

84 
	#EDEADLOCK
 
EDEADLK


	)

86 #ifde‡ 
__˝lu•lus


	@nk/nk_osal.c

2 
	~"±e_ty≥s.h
"

3 
	~"±e_oßl.h
"

4 
	~<«utûus/libccom∑t.h
>

5 
	~<«utûus/thªad.h
>

6 
	~<«utûus/scheduÀr.h
>

7 
	~<«utûus/£m≠h‹e.h
>

9 
	#ERROR
(
fmt
, 
¨gs
...Ë
	`ERROR_PRINT
("emb±hªad: " fmt, ##¨gs)

	)

10 
	#DEBUG
(
fmt
, 
¨gs
...Ë
	`DEBUG_PRINT
("emb±hªad: " fmt, ##¨gs)

	)

11 
	#INFO
(
fmt
, 
¨gs
...Ë
	`INFO_PRINT
("emb±hªad: " fmt, ##¨gs)

	)

14 
	#STATE_UNLOCK
(
a
,
b
Ë
	`•ö_u∆ock_úq_ª°‹e
◊,b)

	)

15 
	#STATE_TRY_LOCK
(
a
,
b
Ë
	`•ö_åy_lock_úq_ßve
◊,b)

	)

16 
	#STATE_LOCK
(
a
Ë
	`•ö_lock_úq_ßve
◊)

	)

18 
	#SEMAPHORE_LOCK_CONF
 
uöt8_t
 
_£m≠h‹e_lock_Êags


	)

19 
	#SEMAPHORE_LOCK
(
s
Ë
_£m≠h‹e_lock_Êags
 = 
	`•ö_lock_úq_ßve
(&(s)->
lock
)

	)

20 
	#SEMAPHORE_TRY_LOCK
(
s
Ë
	`•ö_åy_lock_úq_ßve
(&(s)->
lock
,&
_£m≠h‹e_lock_Êags
)

	)

21 
	#SEMAPHORE_UNLOCK
(
s
Ë
	`•ö_u∆ock_úq_ª°‹e
(&(s)->
lock
, 
_£m≠h‹e_lock_Êags
)

	)

22 
	#SEMAPHORE_UNIRQ
(
s
Ë
	`úq_íabÀ_ª°‹e
(
_£m≠h‹e_lock_Êags
)

	)

24 
	#poff£tof
(
TYPE
, 
MEMBER
Ë((
size_t
Ë&((TYPE *)0)->MEMBER)

	)

25 
	#pc⁄èöî_of
(
±r
, 
ty≥
, 
membî
) ({ \

26 c⁄° 
	`ty≥of
–((
ty≥
 *)0)->
membî
 ) *
__m±r
 = (
±r
); \

27 (
ty≥
 *)–(*)
__m±r
 - 
	`off£tof
—y≥,
membî
Ë);})

	)

35 
±e_osResu…
 
	$±e_osInô
(){

36  
PTE_OS_OK
;

37 
	}
}

47 
±e_osResu…
 
	$±e_osMuãxCª©e
(
±e_osMuãxH™dÀ
 *
pH™dÀ
){

49 *
pH™dÀ
 = 
	`mÆloc
((
pmuãx
));

50 
	`•ölock_öô
((*
pH™dÀ
)->
lock
);

51 
	`DEBUG
("osMutexCreate\n");

52  
PTE_OS_OK
;

53 
	}
}

62 
±e_osResu…
 
	$±e_osMuãxDñëe
(
±e_osMuãxH™dÀ
 
h™dÀ
){

63 
	`•ölock_deöô
(&(
h™dÀ
->
lock
));

64 
	`DEBUG
("osMutexDelete\n");

65  
PTE_OS_OK
;

66 
	}
}

75 
±e_osResu…
 
	$±e_osMuãxLock
(
±e_osMuãxH™dÀ
 
h™dÀ
){

76 
™s
= -1;

77 
h™dÀ
->
Êags
 = 
	`STATE_LOCK
(&(h™dÀ->
lock
));

78 
	`DEBUG
("osMutexLock\n");

79  
PTE_OS_OK
;

81 
	}
}

93 
±e_osResu…
 
	$±e_osMuãxTimedLock
(
±e_osMuãxH™dÀ
 
h™dÀ
, 
timeout
){

94 
°¨t
 = (Ë
	`time
(
NULL
);

95 
íd
 = 
°¨t
;

96 
ªs
 = -1;

97  (
íd
-
°¨t
Ë<
timeout
 ){

98 
ªs
=
	`STATE_TRY_LOCK
(&(
h™dÀ
->
lock
), &(h™dÀ->
Êags
) );

99 
	`DEBUG
("osMutexTimedLock\n");

100 
íd
 = ()
	`time
(
NULL
);

101 if(
ªs
 == 0){

102  
PTE_OS_OK
;

105  
PTE_OS_TIMEOUT
;

106 
	}
}

115 
±e_osResu…
 
	$±e_osMuãxU∆ock
(
±e_osMuãxH™dÀ
 
h™dÀ
){

116 
	`STATE_UNLOCK
(&(
h™dÀ
->
lock
), h™dÀ->
Êags
);

117 
	`DEBUG
("osMutexUnlock\n");

118  
PTE_OS_OK
;

119 
	}
}

135 
±e_osResu…
 
	$±e_osThªadCª©e
(
±e_osThªadE¡ryPoöt
 
íåyPoöt
,

136 
°ackSize
,

137 
öôülPri‹ôy
,

138 *
¨gv
,

139 
±e_osThªadH™dÀ
* 
h™dÀ
)

143 
±e_osThªadH™dÀ
 
h™dÀobj
 = 
	`mÆloc
((
thªad_wôh_sig«l
));

144 
	`mem£t
(
h™dÀobj
,0,(
thªad_wôh_sig«l
));

145 
ªt
 = 
	`nk_thªad_¸óã
(
íåyPoöt
, 
¨gv
, 
NULL
, 
åue
,(
nk_°ack_size_t
Ë
°ackSize
, &(
h™dÀobj
->
tid
),-1);

146 i‡(
ªt
 != 0){

147 
	`DEBUG
("createÉrrorÉxit\n");

148 
	`nk_thªad_exô
(
NULL
);

150 *
h™dÀ
 = 
h™dÀobj
;

151 
nk_thªad
* 
thªad
 = (nk_thªad*Ë(*
h™dÀ
)->
tid
;

152 
	`DEBUG
("============================================\
==========^^^^^^^^^^%%%%osThªadCª©ê%08x, %ld\n", 
thªad
,Åhªad->
tid
);

155  
PTE_OS_OK
;

156 
	}
}

164 
±e_osResu…
 
	$±e_osThªadSèπ
(
±e_osThªadH™dÀ
 
h™dÀ
){

168 
	`nk_thªad_run
(
h™dÀ
->
tid
);

169 
	`DEBUG
("=====================\
 %08x\n", 
h™dÀ
);

172  
PTE_OS_OK
;

173 
	}
}

180 
	$±e_osThªadExô
(){

181 
	`nk_thªad_exô
(
NULL
);

182 
	}
}

192 
±e_osResu…
 
	$±e_osThªadWaôF‹End
(
±e_osThªadH™dÀ
 
thªadH™dÀ
){

193 
nk_thªad_t
 *
thªad
 = (nk_thªad_t*Ë&(
thªadH™dÀ
->
tid
);

194 
åue
){

195 if(
thªad
->
°©us
==
NK_THR_EXITED
){

196  
PTE_OS_OK
;

198 
	`nk_yõld
();

200 
	}
}

205 
±e_osThªadH™dÀ
 
	$±e_osThªadGëH™dÀ
(){

207 
nk_thªad_t
* 
thëhªad
 = 
	`gë_cur_thªad
();

208 
	`DEBUG
("osThreadGetHandle\n");

209  (
±e_osThªadH™dÀ
Ë
	`pc⁄èöî_of
(
thëhªad
,
thªad_wôh_sig«l
, 
tid
);

211 
	}
}

216 
	$±e_osThªadGëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
){

218 
	}
}

225 
±e_osResu…
 
	$±e_osThªadSëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
, 
√wPri‹ôy
){

226  
PTE_OS_OK
;

228 
	}
}

235 
±e_osResu…
 
	$±e_osThªadDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
){

236 
	`DEBUG
("osThreadDelete\n");

237 
	`nk_thªad_de°roy
(&(
h™dÀ
->
tid
));

238 
	}
}

245 
±e_osResu…
 
	$±e_osThªadExôAndDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
){

248 
	`DEBUG
("osThreadExitDelete\n");

249 
	`nk_thªad_de°roy
(&(
h™dÀ
->
tid
));

250 
	}
}

260 
±e_osResu…
 
	$±e_osThªadC™˚l
(
±e_osThªadH™dÀ
 
h™dÀ
){

261 
h™dÀ
->
sig«l
 = 
NK_THREAD_CANCEL
;

263 
	}
}

273 
±e_osResu…
 
	$±e_osThªadCheckC™˚l
(
±e_osThªadH™dÀ
 
h™dÀ
){

274 
nk_thªad_t
 * 
thëhªad
 = (nk_thªad_t*)&(
h™dÀ
->
tid
);

275 
	`DEBUG
("osThreadCheckCancel\n");

276 i‡(
thëhªad
->
°©us
 ==
NK_THR_EXITED
){

277  
PTE_OS_OK
;

279  
PTE_OS_INTERRUPTED
;

281 
	}
}

286 
	$±e_osThªadSÀï
(
m£cs
){

287 
°¨t
 = (Ë
	`time
(
NULL
);

288 
íd
 = 
°¨t
;

289 
ªs
 = -1;

290  (
íd
-
°¨t
Ë<
m£cs
 ){

291 
	`nk_yõld
();

292 
íd
 = ()
	`time
(
NULL
);

294 
	}
}

299 
	$±e_osThªadGëMaxPri‹ôy
(){

302 
	}
}

307 
	$±e_osThªadGëMöPri‹ôy
(){

309 
	}
}

315 
	$±e_osThªadGëDeÁu…Pri‹ôy
(){

317 
	}
}

334 
±e_osResu…
 
	$±e_osSem≠h‹eCª©e
(
öôülVÆue
, 
±e_osSem≠h‹eH™dÀ
 *
pH™dÀ
){

337 *
pH™dÀ
 = 
	`nk_£m≠h‹e_¸óã
(
NULL
,
öôülVÆue
,0,NULL);

338 
	`DEBUG
("osSemaphoreCreate\n");

339  
PTE_OS_OK
;

340 
	}
}

349 
±e_osResu…
 
	$±e_osSem≠h‹eDñëe
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
){

350 
	`nk_£m≠h‹e_ªÀa£
(
h™dÀ
);

351 
	`DEBUG
("osSemaphoreDelete\n");

352  
PTE_OS_OK
;

353 
	}
}

363 
±e_osResu…
 
	$±e_osSem≠h‹ePo°
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, 
cou¡
){

364 
	`DEBUG
("osSemaphorePost\n");

365 
cou¡
 > 0){

366 
	`nk_£m≠h‹e_up
(
h™dÀ
);

367 
cou¡
--;

369 
	}
}

382 
±e_osResu…
 
	$±e_osSem≠h‹ePíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
){

383 
	`DEBUG
("osSemaphorePend\n");

384 
SEMAPHORE_LOCK_CONF
;

385 if(
pTimeout
 =
NULL
){

386 
	`DEBUG
("osSemaphorePend NULLÅime\n");

387 
	`SEMAPHORE_LOCK
(
h™dÀ
);

390  
PTE_OS_OK
;

395 
nk_£m≠h‹e
* 
s
 = 
h™dÀ
;

396 
	`DEBUG
("ªÀa£ sem≠h‹êwôhÇamê%s\n",
s
->
«me
);

397 
°¨t
 = (Ë
	`time
(
NULL
);

398 
íd
 = 
°¨t
;

399 
ªs
 = -1;

400  (
íd
-
°¨t
Ë< *
pTimeout
 ){

401 
	`DEBUG
("osSem≠h‹ePíd %d \n", 
íd
-
°¨t
);

402 
ªs
 = 
	`SEMAPHORE_TRY_LOCK
(
s
);

403 if(
ªs
 == 0){

404  
PTE_OS_OK
;

406 
íd
 = ()
	`time
(
NULL
);

408  
PTE_OS_TIMEOUT
;

410 
	}
}

425 
±e_osResu…
 
	$±e_osSem≠h‹eC™˚ŒabÀPíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
){

426 
nk_thªad_t
* 
thëhªad

	`gë_cur_thªad
();

427 
±e_osThªadH™dÀ
 
osh™dÀ
 = 
	`pc⁄èöî_of
(
thëhªad
, 
thªad_wôh_sig«l
, 
tid
);

428 
	`DEBUG
("osSemaphorecancelablepend\n");

429 
SEMAPHORE_LOCK_CONF
;

430 
ªs
 = -1;

431 if(
pTimeout
 =
NULL
){

432 
åue
){

433 if(
osh™dÀ
->
sig«l
 =
NK_THREAD_CANCEL
){

434  
PTE_OS_INTERRUPTED
;

436 
ªs
 = 
	`SEMAPHORE_TRY_LOCK
(
h™dÀ
);

437 if(
ªs
 == 0){

438  
PTE_OS_OK
;

442 
nk_£m≠h‹e
* 
s
 = 
h™dÀ
;

443 
SEMAPHORE_LOCK_CONF
;

444 
	`DEBUG
("ªÀa£ sem≠h‹êwôhÇamê%s\n",
s
->
«me
);

445 
°¨t
 = (Ë
	`time
(
NULL
);

446 
íd
 = 
°¨t
;

447  (
íd
-
°¨t
Ë< *
pTimeout
 ){

448 if(
osh™dÀ
->
sig«l
 =
NK_THREAD_CANCEL
){

449  
PTE_OS_INTERRUPTED
;

451 
ªs
 = 
	`SEMAPHORE_TRY_LOCK
(
s
);

452 if(
ªs
 == 0){

453  
PTE_OS_OK
;

455 
íd
 = ()
	`time
(
NULL
);

457  
PTE_OS_TIMEOUT
;

459 
	}
}

471 
±e_osResu…
 
	$±e_osTlsSëVÆue
(
key
, * 
vÆue
){

472 
	`DEBUG
("pte_osTlsSetvalue\n");

473 
	`nk_és_£t
(
key
, 
vÆue
);

474  
PTE_OS_OK
;

475 
	}
}

487 * 
	$±e_osTlsGëVÆue
(
key
){

488 
	`DEBUG
("osTlsGetValue\n");

489  
	`nk_és_gë
(
key
);

490 
	}
}

496 
	$±e_osTlsInô
(){

498 
	}
}

509 
±e_osResu…
 
	$±e_osTlsAŒoc
(*
pKey
){

510 
	`DEBUG
("osTlsAlloc\n");

511 
	`nk_és_key_¸óã
(
pKey
, 
NULL
);

512  
PTE_OS_OK
;

513 
	}
}

522 
±e_osResu…
 
	$±e_osTlsFªe
(
key
){

523 
	`DEBUG
("osTlsFree\n");

524 
	`nk_és_key_dñëe
(
key
);

525  
PTE_OS_OK
;

526 
	}
}

546 
	$±e_osAtomicExch™ge
(*
pT¨g
, 
vÆ
){

548 
ªt
 = (Ë
	`xchg64
((**)(&
pT¨g
),(*)(&
vÆ
));

549 
	`DEBUG
("AtomicEXCHANGE, %d , %d\n", *
pT¨g
, 
ªt
 );

551  *
pT¨g
;

554 
	}
}

573 
	$±e_osAtomicCom∑ªExch™ge
(*
pde°
, 
exch™ge
, 
comp
){

574  
	`__sync_vÆ_com∑ª_™d_sw≠
(
pde°
,
comp
,
exch™ge
);

576 
	}
}

592 
	$±e_osAtomicExch™geAdd
(vﬁ©ûe* 
pde°
, 
vÆue
){

593  
	`__sync_„tch_™d_add
(
pde°
, 
vÆue
);

595 
	}
}

610 
	$±e_osAtomicDe¸emít
(*
pde°
){

611  
	`__sync_„tch_™d_sub
(
pde°
,1);

613 
	}
}

623 
	$±e_osAtomicIn¸emít
(*
pde°
){

624  
	`__sync_„tch_™d_add
(
pde°
,1);

626 
	}
}

629 
	$·ime
(
timeb
 *
tb
){

630 
tb
->
time
 = 0;

631 
tb
->
mûlôm
 = 0;

632 
tb
->
timez⁄e
 = 0;

633 
tb
->
d°Êag
=0;

635 
	}
}

	@nk/pte_generic_osal.h

29 #i‚de‡
_GENERIC_OS_SUPPORT_H_


30 
	#_GENERIC_OS_SUPPORT_H_


	)

31 #ifde‡
__˝lu•lus


37 
	e±e_osResu…


41 
PTE_OS_OK
 = 0,

44 
PTE_OS_NO_RESOURCES
,

47 
PTE_OS_GENERAL_FAILURE
,

50 
PTE_OS_TIMEOUT
,

53 
PTE_OS_INTERRUPTED
,

56 
PTE_OS_INVALID_PARAM


59 } 
	t±e_osResu…
;

65 
±e_osResu…
 
±e_osInô
();

79 
±e_osResu…
 
±e_osMuãxCª©e
(
±e_osMuãxH™dÀ
 *
pH™dÀ
);

88 
±e_osResu…
 
±e_osMuãxDñëe
(
±e_osMuãxH™dÀ
 
h™dÀ
);

97 
±e_osResu…
 
±e_osMuãxLock
(
±e_osMuãxH™dÀ
 
h™dÀ
);

109 
±e_osResu…
 
±e_osMuãxTimedLock
(
±e_osMuãxH™dÀ
 
h™dÀ
, 
timeoutM£cs
);

118 
±e_osResu…
 
±e_osMuãxU∆ock
(
±e_osMuãxH™dÀ
 
h™dÀ
);

141 
±e_osResu…
 
±e_osThªadCª©e
(
±e_osThªadE¡ryPoöt
 
íåyPoöt
,

142 
°ackSize
,

143 
öôülPri‹ôy
,

144 *
¨gv
,

145 
±e_osThªadH™dÀ
* 
µã_osThªadH™dÀ
);

154 
±e_osResu…
 
±e_osThªadSèπ
(
±e_osThªadH™dÀ
 
osThªadH™dÀ
);

161 
±e_osThªadExô
();

171 
±e_osResu…
 
±e_osThªadWaôF‹End
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

176 
±e_osThªadH™dÀ
 
±e_osThªadGëH™dÀ
();

181 
±e_osThªadGëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

188 
±e_osResu…
 
±e_osThªadSëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
, 
√wPri‹ôy
);

195 
±e_osResu…
 
±e_osThªadDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
);

202 
±e_osResu…
 
±e_osThªadExôAndDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
);

212 
±e_osResu…
 
±e_osThªadC™˚l
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

222 
±e_osResu…
 
±e_osThªadCheckC™˚l
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

227 
±e_osThªadSÀï
(
m£cs
);

232 
±e_osThªadGëMaxPri‹ôy
();

237 
±e_osThªadGëMöPri‹ôy
();

243 
±e_osThªadGëDeÁu…Pri‹ôy
();

260 
±e_osResu…
 
±e_osSem≠h‹eCª©e
(
öôülVÆue
, 
±e_osSem≠h‹eH™dÀ
 *
pH™dÀ
);

269 
±e_osResu…
 
±e_osSem≠h‹eDñëe
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
);

279 
±e_osResu…
 
±e_osSem≠h‹ePo°
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, 
cou¡
);

292 
±e_osResu…
 
±e_osSem≠h‹ePíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
);

307 
±e_osResu…
 
±e_osSem≠h‹eC™˚ŒabÀPíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
);

320 
±e_osResu…
 
±e_osTlsSëVÆue
(
key
, * 
vÆue
);

332 * 
±e_osTlsGëVÆue
(
key
);

338 
±e_osTlsInô
();

349 
±e_osResu…
 
±e_osTlsAŒoc
(*
pKey
);

358 
±e_osResu…
 
±e_osTlsFªe
(
key
);

378 
±e_osAtomicExch™ge
(*
pT¨g
, 
vÆ
);

397 
±e_osAtomicCom∑ªExch™ge
(*
pde°
, 
exch™ge
, 
comp
);

413 
±e_osAtomicExch™geAdd
(vﬁ©ûe* 
pde°
, 
vÆue
);

428 
±e_osAtomicDe¸emít
(*
pde°
);

438 
±e_osAtomicIn¸emít
(*
pde°
);

441 
timeb
;

443 
·ime
(
timeb
 *
tb
);

445 #ifde‡
__˝lu•lus


	@nk/pte_osal.h

1 #i‚de‡
_PTE_OSAL_H_


2 
	#_PTE_OSAL_H_


	)

3 
	~"±e_ty≥s.h
"

4 
	~"±e_gíîic_oßl.h
"

5 
	~<«utûus/«utûus.h
>

7 
	#ˇŒoc
(
a
,
b
Ë
	`mÆloc
◊*b)

	)

43 #i‚de‡
EPERM


44 
	#EPERM
 1

	)

47 #i‚de‡
ESRCH


48 
	#ESRCH
 3

	)

51 #i‚de‡
EINTR


52 
	#EINTR
 4

	)

55 #i‚de‡
EIO


56 
	#EIO
 5

	)

59 #i‚de‡
EAGAIN


60 
	#EAGAIN
 11

	)

63 #i‚de‡
ENOMEM


64 
	#ENOMEM
 12

	)

67 #i‚de‡
EBUSY


68 
	#EBUSY
 16

	)

71 #i‚de‡
EINVAL


72 
	#EINVAL
 22

	)

75 #i‚de‡
ENOSPC


76 
	#ENOSPC
 28

	)

79 #i‚de‡
EDEADLK


80 
	#EDEADLK
 35

	)

83 #i‚de‡
ENOSYS


84 
	#ENOSYS
 38

	)

87 #i‚de‡
ENOTSUP


88 
	#ENOTSUP
 95

	)

91 #i‚de‡
ETIMEDOUT


92 
	#ETIMEDOUT
 116

	)

95 #i‚de‡
ENOENT


96 
	#ENOENT
 7

	)

99 #i‚de‡
ERANGE


100 
	#ERANGE
 9

	)

	@nk/pte_types.h

3 #i‚de‡
PTE_TYPES_H


4 
	#PTE_TYPES_H


	)

5 
	~<«utûus/li°.h
>

6 
	~<«utûus/£m≠h‹e.h
>

7 
	~<«utûus/thªad.h
>

8 
	~<«utûus/•ölock.h
>

9 
	~<«utûus/libccom∑t.h
>

10 
	spmuãx
{

11 
•ölock_t
 
	mlock
;

12 
uöt8_t
 
	mÊags
;

14 
	sthªad_wôh_sig«l
{

15 
nk_thªad_id_t
 
	mtid
;

16 
uöt8_t
 
	msig«l
;

19 
pmuãx
* 
	t±e_osMuãxH™dÀ
;

20 
nk_thªad_fun_t
 
	t±e_osThªadE¡ryPoöt
;

21 
thªad_wôh_sig«l
* 
	t±e_osThªadH™dÀ
;

22 
nk_£m≠h‹e
* 
	t±e_osSem≠h‹eH™dÀ
;

24 
	e_±hªad_sig«l
{

25 
	mNK_THREAD_NORM
,

26 
	mNK_THREAD_CANCEL


27 }
	t±hªad_sig«l
;

30 
nk_thªad_fun_t
 
	t±e_osThªadE¡ryPoöt
;

31 
	tpid_t
;

32 
	tmode_t
;

39 
	stimeb


41 
time_t
 
	mtime
;

42 
	mmûlôm
;

43 
	mtimez⁄e
;

44 
	md°Êag
;

	@nk_generic_oasl.c

1 #i‚de‡
_PT


2 
	~"±e_ﬂ¶.h
"

3 
	~<«utûus/libcom∑t.h
>

4 
	~<«utûus/thªad.h
>

5 
	~<«utûus/£m≠h‹e.h
>

6 
	#STATE_UNLOCK
(
a
,
b
Ë
	`•ö_u∆ock_úq_ª°‹e
◊,b)

	)

7 
	#STATE_TRY_LOCK
(
a
,
b
Ë
	`•ö_åy_lock_úq_ßve
◊,b)

	)

8 
	#STATE_LOCK
(
a
,
b
Ë
	`•ö_lock_úq_ßve
◊,b)

	)

10 
	#SEMAPHORE_LOCK_CONF
 
uöt8_t
 
_£m≠h‹e_lock_Êags


	)

11 
	#SEMAPHORE_LOCK
(
s
Ë
_£m≠h‹e_lock_Êags
 = 
	`•ö_lock_úq_ßve
(&(s)->
lock
)

	)

12 
	#SEMAPHORE_TRY_LOCK
(
s
Ë
	`•ö_åy_lock_úq_ßve
(&(s)->
lock
,&
_£m≠h‹e_lock_Êags
)

	)

13 
	#SEMAPHORE_UNLOCK
(
s
Ë
	`•ö_u∆ock_úq_ª°‹e
(&(s)->
lock
, 
_£m≠h‹e_lock_Êags
)

	)

14 
	#SEMAPHORE_UNIRQ
(
s
Ë
	`úq_íabÀ_ª°‹e
(
_£m≠h‹e_lock_Êags
)

	)

16 
	#poff£tof
(
TYPE
, 
MEMBER
Ë((
size_t
Ë&((TYPE *)0)->MEMBER)

	)

17 
	#pc⁄èöî_of
(
±r
, 
ty≥
, 
membî
) ({ \

18 c⁄° 
	`ty≥of
–((
ty≥
 *)0)->
membî
 ) *
__m±r
 = (
±r
); \

19 (
ty≥
 *)–(*)
__m±r
 - 
	`off£tof
—y≥,
membî
Ë);})

	)

25 
	e±e_osResu…


29 
	mPTE_OS_OK
 = 0,

32 
	mPTE_OS_NO_RESOURCES
,

35 
	mPTE_OS_GENERAL_FAILURE
,

38 
	mPTE_OS_TIMEOUT
,

41 
	mPTE_OS_INTERRUPTED
,

44 
	mPTE_OS_INVALID_PARAM


47 } 
	t±e_osResu…
;

53 
±e_osResu…
 
	$±e_osInô
(){

54  
PTE_OS_OK
;

55 
	}
}

65 
±e_osResu…
 
	$±e_osMuãxCª©e
(
±e_osMuãxH™dÀ
 *
pH™dÀ
){

67  
PTE_OS_OK
;

68 
	}
}

77 
±e_osResu…
 
	$±e_osMuãxDñëe
(
±e_osMuãxH™dÀ
 
h™dÀ
){

79  
PTE_OS_OK
;

80 
	}
}

89 
±e_osResu…
 
	$±e_osMuãxLock
(
±e_osMuãxH™dÀ
 
h™dÀ
){

90 
™s
= -1;

91 
h™dÀ
->
Êags
 = 
	`STATE_LOCK
(&(h™dÀ->
lock
));

93  
PTE_OS_OK
;

95 
	}
}

107 
±e_osResu…
 
	$±e_osMuãxTimedLock
(
±e_osMuãxH™dÀ
 
h™dÀ
, 
timeoutM£cs
){

108 
°¨t
 = (Ë
	`time
();

109 
íd
 = 
°¨t
;

110 
ªs
 = -1;

111  (
íd
-
°¨t
Ë<
timeout
 ){

112 
ªs
=
	`STATE_TRY_LOCK
(&(
h™dÀ
->
lock
), &(h™dÀ->
Êags
) );

113 
íd
 = ()
	`time
();

114 if(
ªs
 == 0){

115  
PTE_OS_OK
;

118  
PTE_OS_TIMEOUT
;

119 
	}
}

128 
±e_osResu…
 
	$±e_osMuãxU∆ock
(
±e_osMuãxH™dÀ
 
h™dÀ
){

129 
	`STATE_UNLOCK
(&(
h™dÀ
->
lock
), h™dÀ->
Êags
);

130  
PTE_OS_OK
;

131 
	}
}

152 
±e_osResu…
 
	$±e_osThªadCª©e
(
±e_osThªadE¡ryPoöt
 
íåyPoöt
,

153 
°ackSize
,

154 
öôülPri‹ôy
,

155 *
¨gv
,

156 
±e_osThªadH™dÀ
* 
h™dÀ
){

159 
±e_osThªadH™dÀ
 
h™dÀobj
 = 
	`mÆloc
(());

160 *
h™dÀ
 = 
h™dÀobj
;

161 
	`nk_thªad_¸óã
(
íåyPoöt
, 
NULL
,NULL, 
Ál£
,(
nk_°ack_size_t
Ë
°ackSize
, &(
h™dÀobj
->
tid
),-1);

162 
ªtur
 
PTE_OS_OK
;

163 
	}
}

172 
±e_osResu…
 
	$±e_osThªadSèπ
(
±e_osThªadH™dÀ
 
h™dÀ
){

173 
	`nk_thªad_run
(&(
h™dÀ
->
tid
));

174  
PTE_OS_OK
;

175 
	}
}

182 
	$±e_osThªadExô
(){

183 
	`nk_thªad_exô
();

184 
	}
}

194 
±e_osResu…
 
	$±e_osThªadWaôF‹End
(
±e_osThªadH™dÀ
 
thªadH™dÀ
){

195 
nk_thªad_t
 *
thªad
 = (nk_thªad_t*Ë&(
thªadH™dÀ
->
tid
);

196 
åue
){

197 if(
thªad
->
°©us
==
NK_THR_EXITED
){

198  
PTE_OS_OK
;

200 
	`nk_yõld
();

202 
	}
}

207 
±e_osThªadH™dÀ
 
	$±e_osThªadGëH™dÀ
(){

209 
nk_thªad_t
* 
thëhªad
 = 
	`gë_cur_thªad
();

210  (
±e_osThªadH™dÀ
Ë
	`pc⁄èöî_of
(
thëhªad
,
_thªad_wôh_sig«l
, 
tid
);

212 
	}
}

217 
	$±e_osThªadGëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
){

219 
	}
}

226 
±e_osResu…
 
	$±e_osThªadSëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
, 
√wPri‹ôy
){

227  
PTE_OS_OK
;

229 
	}
}

236 
±e_osResu…
 
	$±e_osThªadDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
){

237 
	`nk_thªad_de°roy
(&(
h™dÀ
->
tid
));

238 
	}
}

245 
±e_osResu…
 
	$±e_osThªadExôAndDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
){

248 
	`nk_thªad_de°roy
(&(
h™dÀ
->
tid
));

249 
	}
}

259 
±e_osResu…
 
	$±e_osThªadC™˚l
(
±e_osThªadH™dÀ
 
h™dÀ
){

260 
h™dÀ
->
sögÆ
 = 
NK_THREAD_CANCEL
;

262 
	}
}

272 
±e_osResu…
 
	$±e_osThªadCheckC™˚l
(
±e_osThªadH™dÀ
 
h™dÀ
){

273 
nk_thªad_t
 * 
thëhªad
 = (nk_thªad_t*)&(
h™dÀ
->
tid
);

274 i‡(
thëhªad
->
°©us
 ==
NK_THR_EXITED
){

275  
PTE_OS_OK
;

277  
PTE_OS_INTERRUPTED
;

279 
	}
}

284 
	$±e_osThªadSÀï
(
m£cs
){

285 
°¨t
 = (Ë
	`time
();

286 
íd
 = 
°¨t
;

287 
ªs
 = -1;

288  (
íd
-
°¨t
Ë<
m£cs
 ){

289 
	`nk_yõld
();

290 
íd
 = ()
	`time
();

292  
PTE_OS_OK
;

294 
	}
}

299 
	$±e_osThªadGëMaxPri‹ôy
(){

302 
	}
}

307 
	$±e_osThªadGëMöPri‹ôy
(){

309 
	}
}

315 
	$±e_osThªadGëDeÁu…Pri‹ôy
(){

317 
	}
}

334 
±e_osResu…
 
	$±e_osSem≠h‹eCª©e
(
öôülVÆue
, 
±e_osSem≠h‹eH™dÀ
 *
pH™dÀ
){

336 *
pH™dÀ
 = 
	`nk_£m≠h‹e_¸óã
(
NULL
,
öôülVÆue
,0,NULL);

337  
PTE_OS_OK
;

338 
	}
}

347 
±e_osResu…
 
	$±e_osSem≠h‹eDñëe
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
){

348 
	`nk_£m≠h‹e_ªÀa£
(
h™dÀ
);

349  
PTE_OS_OK
;

350 
	}
}

360 
±e_osResu…
 
	$±e_osSem≠h‹ePo°
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, 
cou¡
){

361 
cou¡
 > 0){

362 
	`nk_£m≠h‹e_up
(
h™dÀ
);

364 
	}
}

377 
±e_osResu…
 
	$±e_osSem≠h‹ePíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
){

378 if(
pTimeout
 = 
NULL
){

379 
	`nk_thªad_exô
();

382 
nk_£m≠h‹e
* 
s
 = 
h™dÀ
;

383 
SEMAPHORE_LOCK_CONF
;

384 
	`DEBUG
("ªÀa£ sem≠h‹êwôhÇamê%s\n",
s
->
«me
);

385 
°¨t
 = (Ë
	`time
();

386 
íd
 = 
°¨t
;

387 
ªs
 = -1;

388  (
íd
-
°¨t
Ë<
m£cs
 ){

389 
ªs
 = 
	`SEMAPHORE_TRY_LOCK
(
s
);

390 if(
ªs
 == 0){

391  
PTE_OS_OK
;

393 
íd
 = ()
	`time
();

395  
PTE_OS_TIMEOUT
;

397 
	}
}

412 
±e_osResu…
 
	$±e_osSem≠h‹eC™˚ŒabÀPíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
){

413 
nk_thªad_t
* 
thëhªad

	`gë_cur_thªad
();

414 
±e_osThªadH™dÀ
 
h™dÀ
 = 
	`pc⁄èöî_of
(
thëªad
, 
thªad_wôh_sig«l
, 
tid
);

416 
pTimeout
 =
NULL
){

417 if(
h™dÀ
->
sig«l
 =
NK_THREAD_CANCEL
){

418  
PTE_OS_INTERRUPTE
;

420 
	`nk_yõld
();

423 
nk_£m≠h‹e
* 
s
 = 
h™dÀ
;

424 
SEMAPHORE_LOCK_CONF
;

425 
	`DEBUG
("ªÀa£ sem≠h‹êwôhÇamê%s\n",
s
->
«me
);

426 
°¨t
 = (Ë
	`time
();

427 
íd
 = 
°¨t
;

428 
ªs
 = -1;

429  (
íd
-
°¨t
Ë<
m£cs
 ){

430 if(
h™dÀ
->
sig«l
 =
NK_THREAD_CANCEL
){

431  
PTE_OS_INTERRUPTE
;

433 
ªs
 = 
	`SEMAPHORE_TRY_LOCK
(
s
);

434 if(
ªs
 == 0){

435  
PTE_OS_OK
;

437 
íd
 = ()
	`time
();

439  
PTE_OS_TIMEOUT
;

441 
	}
}

453 
±e_osResu…
 
	$±e_osTlsSëVÆue
(
key
, * 
vÆue
){

454 
	`nk_és_£t
(
key
, 
vÆue
);

455  
PTE_OS_OK
;

456 
	}
}

468 * 
	$±e_osTlsGëVÆue
(
key
){

469  
	`nk_és_gë
(
key
);

470 
	}
}

476 
	$±e_osTlsInô
(){

478 
	}
}

489 
±e_osResu…
 
	$±e_osTlsAŒoc
(*
pKey
){

490 
	`nk_és_key_¸óã
(
pKey
, 
NULL
);

491  
PTE_OS_OK
;

492 
	}
}

501 
±e_osResu…
 
	$±e_osTlsFªe
(
key
){

502 
	`nk_és_key_dñëe
(
key
);

503  
PTE_OS_OK
;

504 
	}
}

524 
	$±e_osAtomicExch™ge
(*
pT¨g
, 
vÆ
){

525  ()(*(
	`xchg64
(&
pT¨g
, &
vÆ
)));

526 
	}
}

545 
	$±e_osAtomicCom∑ªExch™ge
(*
pde°
, 
exch™ge
, 
comp
){

546  
	`©omic_cmpsw≠
(
pde°
, 
comp
, 
exch™ge
);

547 
	}
}

563 
	$±e_osAtomicExch™geAdd
(vﬁ©ûe* 
pde°
, 
vÆue
){

564  
	`©omic_add
(
pde°
, 
vÆue
);

565 
	}
}

580 
	$±e_osAtomicDe¸emít
(*
pde°
){

581  
	`©omic_dec
(
pde°
);

582 
	}
}

592 
	$±e_osAtomicIn¸emít
(*
pde°
){

593  
	`©omic_öc
(
pde°
);

594 
	}
}

597 
	$·ime
(
timeb
 *
tb
){

598 
tb
->
time
 = 0;

599 
tb
->
mûlôm
 = 0;

600 
tb
->
timez⁄e
 = 0;

601 
tb
->
d°Êag
=0;

603 
	}
}

	@pte_callUserDestroyRoutines.c

48 
	~<«utûus/«utûus.h
>

49 
	~"±hªad.h
"

50 
	~"im∂emít.h
"

52 
	~"nk/±e_oßl.h
"

54 #ifde‡
__˝lu•lus


55 
	~<ex˚±i⁄
>

56 
usög
 
	g°d
::
ãrmö©e
;

60 
	$±e_ˇŒU£rDe°royRoutöes
 (
±hªad_t
 
thªad
)

78 
ThªadKeyAssoc
 * 
assoc
;

80 i‡(
thªad
.
p
 !
NULL
)

82 
assocsRemaöög
;

83 
ôî©i⁄s
 = 0;

84 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
thªad
.
p
;

94 
assocsRemaöög
 = 0;

95 
ôî©i⁄s
++;

97 (Ë
	`±hªad_muãx_lock
(&(
•
->
thªadLock
));

106 
•
->
√xtAssoc
 = sp->
keys
;

107 (Ë
	`±hªad_muãx_u∆ock
(&(
•
->
thªadLock
));

111 * 
vÆue
;

112 
±hªad_key_t
 
k
;

113 (*
de°ru˘‹
) (*);

120 (Ë
	`±hªad_muãx_lock
(&(
•
->
thªadLock
));

122 i‡((
assoc
 = (
ThªadKeyAssoc
 *)
•
->
√xtAssoc
Ë=
NULL
)

125 
	`±hªad_muãx_u∆ock
(&(
•
->
thªadLock
));

140 i‡(
	`±hªad_muãx_åylock
(&(
assoc
->
key
->
keyLock
)Ë=
EBUSY
)

142 
	`±hªad_muãx_u∆ock
(&(
•
->
thªadLock
));

143 
	`±e_osThªadSÀï
(1);

155 
•
->
√xtAssoc
 = 
assoc
->
√xtKey
;

164 
k
 = 
assoc
->
key
;

165 
de°ru˘‹
 = 
k
->destructor;

166 
vÆue
 = 
	`±e_osTlsGëVÆue
(
k
->
key
);

167 
	`±e_osTlsSëVÆue
 (
k
->
key
, 
NULL
);

170 i‡(
vÆue
 !
NULL
 && 
ôî©i⁄s
 <
PTHREAD_DESTRUCTOR_ITERATIONS
)

179 (Ë
	`±hªad_muãx_u∆ock
(&(
•
->
thªadLock
));

180 (Ë
	`±hªad_muãx_u∆ock
(&(
k
->
keyLock
));

182 
assocsRemaöög
++;

184 #ifde‡
__˝lu•lus


186 
åy


191 
	`de°ru˘‹
 (
vÆue
);

193 
	`ˇtch
 (...)

204 
	`ãrmö©e
 ();

212 
	`de°ru˘‹
 (
vÆue
);

223 
	`±e_tkAssocDe°roy
 (
assoc
);

224 (Ë
	`±hªad_muãx_u∆ock
(&(
•
->
thªadLock
));

225 (Ë
	`±hªad_muãx_u∆ock
(&(
k
->
keyLock
));

229 
assocsRemaöög
);

231 
	}
}

	@pte_cancellable_wait.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"£m≠h‹e.h
"

49 
	~"im∂emít.h
"

52 
	$±e_ˇn˚ŒabÀ_waô
 (
±e_osSem≠h‹eH™dÀ
 
£mH™dÀ
, * 
timeout
)

54 
ªsu…
 = 
EINVAL
;

55 
±e_osResu…
 
osResu…
;

56 
ˇn˚lE«bÀd
 = 0;

57 
±hªad_t
 
£lf
;

58 
±e_thªad_t
 * 
•
;

60 
£lf
 = 
	`±hªad_£lf
();

61 
•
 = (
±e_thªad_t
 *Ë
£lf
.
p
;

63 i‡(
•
 !
NULL
)

68 i‡(
•
->
ˇn˚lSèã
 =
PTHREAD_CANCEL_ENABLE
)

70 
ˇn˚lE«bÀd
 = 1;

75 i‡(
ˇn˚lE«bÀd
)

77 
osResu…
 = 
	`±e_osSem≠h‹eC™˚ŒabÀPíd
(
£mH™dÀ
, 
timeout
);

81 
osResu…
 = 
	`±e_osSem≠h‹ePíd
(
£mH™dÀ
, 
timeout
);

84 
osResu…
)

86 
PTE_OS_OK
:

88 
ªsu…
 = 0;

92 
PTE_OS_TIMEOUT
:

94 
ªsu…
 = 
ETIMEDOUT
;

98 
PTE_OS_INTERRUPTED
:

100 i‡(
•
 !
NULL
)

106 (Ë
	`±hªad_muãx_lock
 (&
•
->
ˇn˚lLock
);

107 i‡(
•
->
°©e
 < 
PThªadSèãC™˚lög
)

109 
•
->
°©e
 = 
PThªadSèãC™˚lög
;

110 
•
->
ˇn˚lSèã
 = 
PTHREAD_CANCEL_DISABLE
;

111 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

112 
	`±e_throw
 (
PTE_EPS_CANCEL
);

116 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

123 
ªsu…
 = 
EINVAL
;

129  (
ªsu…
);

131 
	}
}

	@pte_cond_check_need_init.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

49 
	$±e_c⁄d_check_√ed_öô
 (
±hªad_c⁄d_t
 * 
c⁄d
)

51 
ªsu…
 = 0;

76 
	`±e_osMuãxLock
 (
±e_c⁄d_ã°_öô_lock
);

85 i‡(*
c⁄d
 =
PTHREAD_COND_INITIALIZER
)

87 
ªsu…
 = 
	`±hªad_c⁄d_öô
 (
c⁄d
, 
NULL
);

89 i‡(*
c⁄d
 =
NULL
)

96 
ªsu…
 = 
EINVAL
;

100 
	`±e_osMuãxU∆ock
(
±e_c⁄d_ã°_öô_lock
);

102  
ªsu…
;

103 
	}
}

	@pte_detach.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

47 
	$±e_thªad_dëach_comm⁄
 (
thªadShouldExô
)

49 i‡(
±e_¥o˚ssInôülized
)

55 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
	`±hªad_gë•ecific
 (
±e_£lfThªadKey
);

57 i‡(
•
 !
NULL
)

60 
	`±e_ˇŒU£rDe°royRoutöes
 (
•
->
±H™dÀ
);

62 (Ë
	`±hªad_muãx_lock
 (&
•
->
ˇn˚lLock
);

63 
•
->
°©e
 = 
PThªadSèãLa°
;

69 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

71 i‡(
•
->
dëachSèã
 =
PTHREAD_CREATE_DETACHED
)

73 i‡(
thªadShouldExô
)

75 
	`±e_thªadExôAndDe°roy
 (
•
->
±H™dÀ
);

79 
	`±e_thªadDe°roy
 (
•
->
±H™dÀ
);

86 i‡(
thªadShouldExô
)

88 
	`±e_osThªadExô
();

95 
	}
}

97 
	$±e_thªad_dëach_™d_exô_≈
()

99  
	`±e_thªad_dëach_comm⁄
(1);

100 
	}
}

102 
	$±e_thªad_dëach_≈
()

104  
	`±e_thªad_dëach_comm⁄
(0);

105 
	}
}

	@pte_generic_osal.h

29 #i‚de‡
_GENERIC_OS_SUPPORT_H_


30 
	#_GENERIC_OS_SUPPORT_H_


	)

31 #ifde‡
__˝lu•lus


37 
	e±e_osResu…


41 
PTE_OS_OK
 = 0,

44 
PTE_OS_NO_RESOURCES
,

47 
PTE_OS_GENERAL_FAILURE
,

50 
PTE_OS_TIMEOUT
,

53 
PTE_OS_INTERRUPTED
,

56 
PTE_OS_INVALID_PARAM


59 } 
	t±e_osResu…
;

65 
±e_osResu…
 
±e_osInô
();

79 
±e_osResu…
 
±e_osMuãxCª©e
(
±e_osMuãxH™dÀ
 *
pH™dÀ
);

88 
±e_osResu…
 
±e_osMuãxDñëe
(
±e_osMuãxH™dÀ
 
h™dÀ
);

97 
±e_osResu…
 
±e_osMuãxLock
(
±e_osMuãxH™dÀ
 
h™dÀ
);

109 
±e_osResu…
 
±e_osMuãxTimedLock
(
±e_osMuãxH™dÀ
 
h™dÀ
, 
timeoutM£cs
);

118 
±e_osResu…
 
±e_osMuãxU∆ock
(
±e_osMuãxH™dÀ
 
h™dÀ
);

123 (*
±e_osThªadE¡ryPoöt
)(*
	t∑øms
);

140 
±e_osResu…
 
±e_osThªadCª©e
(
±e_osThªadE¡ryPoöt
 
íåyPoöt
,

141 
°ackSize
,

142 
öôülPri‹ôy
,

143 *
¨gv
,

144 
±e_osThªadH™dÀ
* 
µã_osThªadH™dÀ
);

153 
±e_osResu…
 
±e_osThªadSèπ
(
±e_osThªadH™dÀ
 
osThªadH™dÀ
);

160 
±e_osThªadExô
();

170 
±e_osResu…
 
±e_osThªadWaôF‹End
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

175 
±e_osThªadH™dÀ
 
±e_osThªadGëH™dÀ
();

180 
±e_osThªadGëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

187 
±e_osResu…
 
±e_osThªadSëPri‹ôy
(
±e_osThªadH™dÀ
 
thªadH™dÀ
, 
√wPri‹ôy
);

194 
±e_osResu…
 
±e_osThªadDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
);

201 
±e_osResu…
 
±e_osThªadExôAndDñëe
(
±e_osThªadH™dÀ
 
h™dÀ
);

211 
±e_osResu…
 
±e_osThªadC™˚l
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

221 
±e_osResu…
 
±e_osThªadCheckC™˚l
(
±e_osThªadH™dÀ
 
thªadH™dÀ
);

226 
±e_osThªadSÀï
(
m£cs
);

231 
±e_osThªadGëMaxPri‹ôy
();

236 
±e_osThªadGëMöPri‹ôy
();

242 
±e_osThªadGëDeÁu…Pri‹ôy
();

259 
±e_osResu…
 
±e_osSem≠h‹eCª©e
(
öôülVÆue
, 
±e_osSem≠h‹eH™dÀ
 *
pH™dÀ
);

268 
±e_osResu…
 
±e_osSem≠h‹eDñëe
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
);

278 
±e_osResu…
 
±e_osSem≠h‹ePo°
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, 
cou¡
);

291 
±e_osResu…
 
±e_osSem≠h‹ePíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
);

306 
±e_osResu…
 
±e_osSem≠h‹eC™˚ŒabÀPíd
(
±e_osSem≠h‹eH™dÀ
 
h™dÀ
, *
pTimeout
);

319 
±e_osResu…
 
±e_osTlsSëVÆue
(
key
, * 
vÆue
);

331 * 
±e_osTlsGëVÆue
(
key
);

337 
±e_osTlsInô
();

348 
±e_osResu…
 
±e_osTlsAŒoc
(*
pKey
);

357 
±e_osResu…
 
±e_osTlsFªe
(
key
);

377 
±e_osAtomicExch™ge
(*
pT¨g
, 
vÆ
);

396 
±e_osAtomicCom∑ªExch™ge
(*
pde°
, 
exch™ge
, 
comp
);

412 
±e_osAtomicExch™geAdd
(vﬁ©ûe* 
pde°
, 
vÆue
);

427 
±e_osAtomicDe¸emít
(*
pde°
);

437 
±e_osAtomicIn¸emít
(*
pde°
);

440 
timeb
;

442 
·ime
(
timeb
 *
tb
);

444 #ifde‡
__˝lu•lus


	@pte_getprocessors.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

62 
	$±e_gë¥o˚ss‹s
 (*
cou¡
)

64 
ªsu…
 = 0;

66 *
cou¡
 = 1;

68  (
ªsu…
);

69 
	}
}

	@pte_is_attr.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

47 
	$±e_is_©å
 (c⁄° 
±hªad_©å_t
 * 
©å
)

51  (
©å
 =
NULL
 ||

52 *
©å
 =
NULL
 || (*©å)->
vÆid
 !
PTE_ATTR_VALID
);

53 
	}
}

	@pte_mutex_check_need_init.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

48 
±hªad_muãx©å_t_
 
	g±e_ªcursive_muãx©å_s
 =

50 
PTHREAD_PROCESS_PRIVATE
, 
PTHREAD_MUTEX_RECURSIVE


52 
±hªad_muãx©å_t_
 
	g±e_îr‹check_muãx©å_s
 =

54 
PTHREAD_PROCESS_PRIVATE
, 
PTHREAD_MUTEX_ERRORCHECK


56 
±hªad_muãx©å_t
 
	g±e_ªcursive_muãx©å
 = &
±e_ªcursive_muãx©å_s
;

57 
±hªad_muãx©å_t
 
	g±e_îr‹check_muãx©å
 = &
±e_îr‹check_muãx©å_s
;

61 
	$±e_muãx_check_√ed_öô
 (
±hªad_muãx_t
 * 
muãx
)

63 
ªsu…
 = 0;

64 
±hªad_muãx_t
 
mtx
;

89 
	`±e_osMuãxLock
 (
±e_muãx_ã°_öô_lock
);

99 
mtx
 = *
muãx
;

101 i‡(
mtx
 =
PTHREAD_MUTEX_INITIALIZER
)

103 
ªsu…
 = 
	`±hªad_muãx_öô
 (
muãx
, 
NULL
);

105 i‡(
mtx
 =
PTHREAD_RECURSIVE_MUTEX_INITIALIZER
)

107 
ªsu…
 = 
	`±hªad_muãx_öô
 (
muãx
, &
±e_ªcursive_muãx©å
);

109 i‡(
mtx
 =
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
)

111 
ªsu…
 = 
	`±hªad_muãx_öô
 (
muãx
, &
±e_îr‹check_muãx©å
);

113 i‡(
mtx
 =
NULL
)

120 
ªsu…
 = 
EINVAL
;

123 
	`±e_osMuãxU∆ock
(
±e_muãx_ã°_öô_lock
);

125  (
ªsu…
);

126 
	}
}

	@pte_new.c

46 
	~<«utûus/«utûus.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

52 
±hªad_t


53 
	$±e_√w
 ()

55 
±hªad_t
 
t
;

56 
±hªad_t
 
nû
 = {
NULL
, 0};

57 
±e_thªad_t
 * 
ç
;

62 
t
 = 
	`±e_thªadReu£P›
 ();

64 i‡(
NULL
 !
t
.
p
)

66 
ç
 = (
±e_thªad_t
 *Ë
t
.
p
;

71 
ç
 = (
±e_thªad_t
 *Ë
	`ˇŒoc
 (1, (pte_thread_t));

73 i‡(
ç
 =
NULL
)

75  
nû
;

79 
t
.
p
 = 
ç
->
±H™dÀ
.p =Åp;

80 
t
.
x
 = 
ç
->
±H™dÀ
.x = 0;

84 
ç
->
sched_¥i‹ôy
 = 
	`±e_osThªadGëMöPri‹ôy
();

86 
ç
->
dëachSèã
 = 
PTHREAD_CREATE_JOINABLE
;

87 
ç
->
ˇn˚lSèã
 = 
PTHREAD_CANCEL_ENABLE
;

88 
ç
->
ˇn˚lTy≥
 = 
PTHREAD_CANCEL_DEFERRED
;

89 
ç
->
ˇn˚lLock
 = 
PTHREAD_MUTEX_INITIALIZER
;

90 
ç
->
thªadLock
 = 
PTHREAD_MUTEX_INITIALIZER
;

92  
t
;

94 
	}
}

	@pte_relmillisecs.c

43 
	~"nk/±e_oßl.h
"

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

48 
	töt64_t
;

51 
	$±e_ªlmûli£cs
 (c⁄° 
time•ec
 * 
ab°ime
)

53 c⁄° 
NANOSEC_PER_MILLISEC
 = 1000000;

54 c⁄° 
MILLISEC_PER_SEC
 = 1000;

55 
mûli£c⁄ds
;

56 
tmpAbsMûli£c⁄ds
;

57 
tmpCuºMûli£c⁄ds
;

58 
timeb
 
cuºSysTime
;

71 
tmpAbsMûli£c⁄ds
 = (
öt64_t
)
ab°ime
->
tv_£c
 * 
MILLISEC_PER_SEC
;

72 
tmpAbsMûli£c⁄ds
 +((
öt64_t
)
ab°ime
->
tv_n£c
 + (
NANOSEC_PER_MILLISEC
/2)) / NANOSEC_PER_MILLISEC;

76 
	`_·ime
(&
cuºSysTime
);

78 
tmpCuºMûli£c⁄ds
 = (
öt64_t
Ë
cuºSysTime
.
time
 * 
MILLISEC_PER_SEC
;

79 
tmpCuºMûli£c⁄ds
 +(
öt64_t
Ë
cuºSysTime
.
mûlôm
;

81 i‡(
tmpAbsMûli£c⁄ds
 > 
tmpCuºMûli£c⁄ds
)

83 
mûli£c⁄ds
 = (Ë(
tmpAbsMûli£c⁄ds
 - 
tmpCuºMûli£c⁄ds
);

84 i‡(
mûli£c⁄ds
 == 0xFFFFFFFF)

87 
mûli£c⁄ds
--;

93 
mûli£c⁄ds
 = 0;

96  
mûli£c⁄ds
;

97 
	}
}

	@pte_reuse.c

47 
	~<«utûus/«utûus.h
>

48 
	~<«utûus/«ut_°rög.h
>

49 
	~"±hªad.h
"

50 
	~"im∂emít.h
"

86 
±hªad_t


87 
	$±e_thªadReu£P›
 ()

89 
±hªad_t
 
t
 = {
NULL
, 0};

92 
	`±e_osMuãxLock
 (
±e_thªad_ªu£_lock
);

94 i‡(
PTE_THREAD_REUSE_EMPTY
 !
±e_thªadReu£T›
)

96 
±e_thªad_t
 * 
ç
;

98 
ç
 = 
±e_thªadReu£T›
;

100 
±e_thªadReu£T›
 = 
ç
->
¥evReu£
;

102 i‡(
PTE_THREAD_REUSE_EMPTY
 =
±e_thªadReu£T›
)

104 
±e_thªadReu£BŸtom
 = 
PTE_THREAD_REUSE_EMPTY
;

107 
ç
->
¥evReu£
 = 
NULL
;

109 
t
 = 
ç
->
±H™dÀ
;

112 
	`±e_osMuãxU∆ock
(
±e_thªad_ªu£_lock
);

114  
t
;

116 
	}
}

125 
	$±e_thªadReu£Push
 (
±hªad_t
 
thªad
)

127 
±e_thªad_t
 * 
ç
 = (±e_thªad_à*Ë
thªad
.
p
;

128 
±hªad_t
 
t
;

131 
	`±e_osMuãxLock
 (
±e_thªad_ªu£_lock
);

133 
t
 = 
ç
->
±H™dÀ
;

134 
	`mem£t
(
ç
, 0, (
±e_thªad_t
));

137 
ç
->
±H™dÀ
 = 
t
;

140 #ifde‡
PTE_THREAD_ID_REUSE_INCREMENT


141 
ç
->
±H™dÀ
.
x
 +
PTE_THREAD_ID_REUSE_INCREMENT
;

143 
ç
->
±H™dÀ
.
x
++;

146 
ç
->
¥evReu£
 = 
PTE_THREAD_REUSE_EMPTY
;

148 i‡(
PTE_THREAD_REUSE_EMPTY
 !
±e_thªadReu£BŸtom
)

150 
±e_thªadReu£BŸtom
->
¥evReu£
 = 
ç
;

154 
±e_thªadReu£T›
 = 
ç
;

157 
±e_thªadReu£BŸtom
 = 
ç
;

159 
	`±e_osMuãxU∆ock
(
±e_thªad_ªu£_lock
);

160 
	}
}

	@pte_rwlock_cancelwrwait.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

47 
	$±e_rwlock_ˇn˚lwrwaô
 (*
¨g
)

49 
±hªad_rwlock_t
 
rwl
 = (±hªad_rwlock_tË
¨g
;

51 
rwl
->
nSh¨edAc˚ssCou¡
 = -rwl->
nCom∂ëedSh¨edAc˚ssCou¡
;

52 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

54 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
));

55 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

56 
	}
}

	@pte_rwlock_check_need_init.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

48 
	$±e_rwlock_check_√ed_öô
 (
±hªad_rwlock_t
 * 
rwlock
)

50 
ªsu…
 = 0;

75 
	`±e_osMuãxLock
 (
±e_rwlock_ã°_öô_lock
);

85 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

87 
ªsu…
 = 
	`±hªad_rwlock_öô
 (
rwlock
, 
NULL
);

89 i‡(*
rwlock
 =
NULL
)

96 
ªsu…
 = 
EINVAL
;

99 
	`±e_osMuãxU∆ock
(
±e_rwlock_ã°_öô_lock
);

101  
ªsu…
;

102 
	}
}

	@pte_spinlock_check_need_init.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±e_•ölock_check_√ed_öô
 (
±hªad_•ölock_t
 * 
lock
)

50 
ªsu…
 = 0;

62 
	`±e_osMuãxLock
 (
±e_•ölock_ã°_öô_lock
);

72 i‡(*
lock
 =
PTHREAD_SPINLOCK_INITIALIZER
)

74 
ªsu…
 = 
	`±hªad_•ö_öô
 (
lock
, 
PTHREAD_PROCESS_PRIVATE
);

76 i‡(*
lock
 =
NULL
)

83 
ªsu…
 = 
EINVAL
;

86 
	`±e_osMuãxU∆ock
(
±e_•ölock_ã°_öô_lock
);

88  (
ªsu…
);

89 
	}
}

	@pte_threadDestroy.c

47 
	~<«utûus/«utûus.h
>

48 
	~<«utûus/«ut_°rög.h
>

49 
	~"±hªad.h
"

50 
	~"im∂emít.h
"

55 
	$±e_thªadDe°royComm⁄
 (
±hªad_t
 
thªad
, 
shouldThªadExô
)

57 
±e_thªad_t
 * 
ç
 = (±e_thªad_à*Ë
thªad
.
p
;

58 
±e_thªad_t
 
thªadC›y
;

60 i‡(
ç
 !
NULL
)

65 
	`mem˝y
 (&
thªadC›y
, 
ç
,  (threadCopy));

71 
	`±e_thªadReu£Push
 (
thªad
);

73 (Ë
	`±hªad_muãx_de°roy
(&
thªadC›y
.
ˇn˚lLock
);

74 (Ë
	`±hªad_muãx_de°roy
(&
thªadC›y
.
thªadLock
);

76 i‡(
thªadC›y
.
thªadId
 != 0)

78 i‡(
shouldThªadExô
)

80 
	`±e_osThªadExôAndDñëe
(
thªadC›y
.
thªadId
);

84 
	`±e_osThªadDñëe
(
thªadC›y
.
thªadId
);

91 
	}
}

93 
	$±e_thªadDe°roy
 (
±hªad_t
 
thªad
)

95 
	`±e_thªadDe°royComm⁄
(
thªad
,0);

96 
	}
}

98 
	$±e_thªadExôAndDe°roy
 (
±hªad_t
 
thªad
)

100 
	`±e_thªadDe°royComm⁄
(
thªad
,1);

101 
	}
}

	@pte_threadStart.c

47 
	~<«utûus/«utûus.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

51 #i‡
deföed
(
PTE_CLEANUP_CXX
)

53 #i‡
deföed
(
__GNUC__
) && __GNUC__ < 3

54 
	~<√w
>

56 
	~<√w
>

57 
usög


58 
	g°d
::
ãrmö©e_h™dÀr
;

59 
usög


60 
	g°d
::
ãrmö©e
;

61 
usög


62 
	g°d
::
£t_ãrmö©e
;

65 
ãrmö©e_h™dÀr
 
	tãrmö©e_fun˘i⁄
;

67 
ãrmö©e_fun˘i⁄
 
	g±e_ﬁdTîmö©e
;

70 
	$±e_ãrmö©e
 ()

72 
	`£t_ãrmö©e
 (
±e_ﬁdTîmö©e
);

73 (Ë
	`±e_thªad_dëach_≈
();

75 
	}
}

79 
	$±e_thªadSèπ
 (*
vthªadP¨ms
, ** 
out
)

81 
ThªadP¨ms
 * 
thªadP¨ms
 = (ThªadP¨m†*Ë
vthªadP¨ms
;

82 
±hªad_t
 
£lf
;

83 
±e_thªad_t
 * 
•
;

84 *(*
°¨t
) (*);

85 * 
¨g
;

87 #ifde‡
PTE_CLEANUP_C


88 
	~<«utûus/£tjmp.h
>

89 
£tjmp_rc
;

92 * 
°©us
 = (*) 0;

94 
£lf
 = 
thªadP¨ms
->
tid
;

95 
•
 = (
±e_thªad_t
 *Ë
£lf
.
p
;

96 
°¨t
 = 
thªadP¨ms
->start;

97 
¨g
 = 
thªadP¨ms
->arg;

100 
	`±hªad_£t•ecific
 (
±e_£lfThªadKey
, 
•
);

102 
•
->
°©e
 = 
PThªadSèãRu¬ög
;

104 #ifde‡
PTE_CLEANUP_C


107 
£tjmp_rc
 = 
	`£tjmp
 (
•
->
°¨t_m¨k
);

110 i‡(0 =
£tjmp_rc
)

116 
•
->
exôSètus
 = 
°©us
 = (*
°¨t
Ë(
¨g
);

120 
£tjmp_rc
)

122 
PTE_EPS_CANCEL
:

123 
°©us
 = 
•
->
exôSètus
 = 
PTHREAD_CANCELED
;

125 
PTE_EPS_EXIT
:

126 
°©us
 = 
•
->
exôSètus
;

129 
°©us
 = 
•
->
exôSètus
 = 
PTHREAD_CANCELED
;

136 #ifde‡
PTE_CLEANUP_CXX


138 
±e_ﬁdTîmö©e
 = 
	`£t_ãrmö©e
 (&
±e_ãrmö©e
);

140 
åy


147 
åy


149 
°©us
 = 
•
->
exôSètus
 = (*
°¨t
Ë(
¨g
);

151 
	`ˇtch
 (
±e_ex˚±i⁄
 &)

156 
throw
;

158 
	`ˇtch
 (...)

169 
ãrmö©e_fun˘i⁄


170 
ãrm_func
 = 
	`£t_ãrmö©e
 (0);

171 
	`£t_ãrmö©e
 (
ãrm_func
);

173 i‡(
ãrm_func
 != 0)

175 
	`ãrm_func
 ();

178 
throw
;

181 
	`ˇtch
 (
±e_ex˚±i⁄_ˇn˚l
 &)

186 
°©us
 = 
•
->
exôSètus
 = 
PTHREAD_CANCELED
;

188 
	`ˇtch
 (
±e_ex˚±i⁄_exô
 &)

193 
°©us
 = 
•
->
exôSètus
;

195 
	`ˇtch
 (...)

202 
°©us
 = 
•
->
exôSètus
 = 
PTHREAD_CANCELED
;

203 (Ë
	`±hªad_muãx_lock
 (&
•
->
ˇn˚lLock
);

204 
•
->
°©e
 = 
PThªadSèãEx˚±i⁄
;

205 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

206 (Ë
	`±e_thªad_dëach_≈
();

207 (Ë
	`£t_ãrmö©e
 (
±e_ﬁdTîmö©e
);

208 
throw
;

215 (Ë
	`£t_ãrmö©e
 (
±e_ﬁdTîmö©e
);

219 #îr‹ 
ERROR
 [
__FILE__
, 
löe
 
__LINE__
]: 
CÀ™up
 
ty≥
 
undeföed
.

237 (Ë
	`±e_thªad_dëach_™d_exô_≈
 ();

245  (Ë
°©us
;

247 
	}
}

	@pte_throw.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

58 
	$±e_throw
 (
ex˚±i⁄
)

64 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
	`±hªad_gë•ecific
 (
±e_£lfThªadKey
);

67 i‡(
ex˚±i⁄
 !
PTE_EPS_CANCEL
 &&Éx˚±i⁄ !
PTE_EPS_EXIT
)

70 
	`exô
 (1);

73 i‡(
NULL
 =
•
 || sp->
im∂icô
)

81 
exôCode
 = 0;

83 
ex˚±i⁄
)

85 
PTE_EPS_CANCEL
:

86 
exôCode
 = (Ë
PTHREAD_CANCELED
;

88 
PTE_EPS_EXIT
:

89 
exôCode
 = (Ë
•
->
exôSètus
;;

93 
	`±e_thªad_dëach_™d_exô_≈
 ();

99 #ifde‡
PTE_CLEANUP_C


101 
	`±e_p›_˛ónup_Æl
 (1);

102 
	`l⁄gjmp
 (
•
->
°¨t_m¨k
, 
ex˚±i⁄
);

106 #ifde‡
PTE_CLEANUP_CXX


108 
ex˚±i⁄
)

110 
PTE_EPS_CANCEL
:

111 
throw
 
	`±e_ex˚±i⁄_ˇn˚l
 ();

113 
PTE_EPS_EXIT
:

114 
throw
 
	`±e_ex˚±i⁄_exô
 ();

120 #îr‹ 
ERROR
 [
__FILE__
, 
löe
 
__LINE__
]: 
CÀ™up
 
ty≥
 
undeföed
.

127 
	}
}

131 
	$±e_p›_˛ónup_Æl
 (
execuã
)

133 
NULL
 !
	`±e_p›_˛ónup
 (
execuã
))

136 
	}
}

140 
	$±e_gë_ex˚±i⁄_£rvi˚s_code
 ()

142  (Ë
NULL
;

143 
	}
}

	@pte_tkAssocCreate.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

52 
	$±e_tkAssocCª©e
 (
±e_thªad_t
 * 
•
, 
±hªad_key_t
 
key
)

84 
ThªadKeyAssoc
 *
assoc
;

93 
assoc
 = (
ThªadKeyAssoc
 *Ë
	`ˇŒoc
 (1,  (*assoc));

95 i‡(
assoc
 =
NULL
)

97  
ENOMEM
;

100 
assoc
->
thªad
 = 
•
;

101 
assoc
->
key
 = key;

106 
assoc
->
¥evThªad
 = 
NULL
;

107 
assoc
->
√xtThªad
 = (
ThªadKeyAssoc
 *Ë
key
->
thªads
;

108 i‡(
assoc
->
√xtThªad
 !
NULL
)

110 
assoc
->
√xtThªad
->
¥evThªad
 =ássoc;

112 
key
->
thªads
 = (*Ë
assoc
;

117 
assoc
->
¥evKey
 = 
NULL
;

118 
assoc
->
√xtKey
 = (
ThªadKeyAssoc
 *Ë
•
->
keys
;

119 i‡(
assoc
->
√xtKey
 !
NULL
)

121 
assoc
->
√xtKey
->
¥evKey
 =ássoc;

123 
•
->
keys
 = (*Ë
assoc
;

127 
	}
}

	@pte_tkAssocDestroy.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

52 
	$±e_tkAssocDe°roy
 (
ThªadKeyAssoc
 * 
assoc
)

72 i‡(
assoc
 !
NULL
)

74 
ThªadKeyAssoc
 * 
¥ev
, * 
√xt
;

77 
¥ev
 = 
assoc
->
¥evKey
;

78 
√xt
 = 
assoc
->
√xtKey
;

79 i‡(
¥ev
 !
NULL
)

81 
¥ev
->
√xtKey
 = 
√xt
;

83 i‡(
√xt
 !
NULL
)

85 
√xt
->
¥evKey
 = 
¥ev
;

88 i‡(
assoc
->
thªad
->
keys
 ==ássoc)

91 
assoc
->
thªad
->
keys
 = 
√xt
;

93 i‡(
assoc
->
thªad
->
√xtAssoc
 ==ássoc)

99 
assoc
->
thªad
->
√xtAssoc
 = 
√xt
;

103 
¥ev
 = 
assoc
->
¥evThªad
;

104 
√xt
 = 
assoc
->
√xtThªad
;

105 i‡(
¥ev
 !
NULL
)

107 
¥ev
->
√xtThªad
 = 
√xt
;

109 i‡(
√xt
 !
NULL
)

111 
√xt
->
¥evThªad
 = 
¥ev
;

114 i‡(
assoc
->
key
->
thªads
 ==ássoc)

117 
assoc
->
key
->
thªads
 = 
√xt
;

120 
	`‰ì
 (
assoc
);

123 
	}
}

	@pthread.h

44 #i‡!
deföed
–
PTHREAD_H
 )

45 
	#PTHREAD_H


	)

47 
	~"nk/±e_ty≥s.h
"

49 
	~"sched.h
"

51 
	#PTE_VERSION
 2,8,0,0

	)

52 
	#PTE_VERSION_STRING
 "2, 8, 0, 0\0"

	)

76 #i‡!
deföed
–
PTE_CLEANUP_CXX
 ) && !deföed–
PTE_CLEANUP_C
 )

77 
	#PTE_CLEANUP_C


	)

80 #unde‡
PTE_LEVEL


82 #i‡
deföed
(
_POSIX_SOURCE
)

83 
	#PTE_LEVEL
 0

	)

87 #i‡
deföed
(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 199309

88 #unde‡
PTE_LEVEL


89 
	#PTE_LEVEL
 1

	)

93 #i‡
deföed
(
INCLUDE_NP
)

94 #unde‡
PTE_LEVEL


95 
	#PTE_LEVEL
 2

	)

99 
	#PTE_LEVEL_MAX
 3

	)

101 #i‡!
deföed
(
PTE_LEVEL
)

102 
	#PTE_LEVEL
 
PTE_LEVEL_MAX


	)

181 
	~<«utûus/£tjmp.h
>

182 
	~<limôs.h
>

189 
	mPTE_FALSE
 = 0,

190 
	mPTE_TRUE
 = (! 
PTE_FALSE
)

284 #unde‡
_POSIX_THREADS


285 
	#_POSIX_THREADS
 200112L

	)

287 #unde‡
_POSIX_READER_WRITER_LOCKS


288 
	#_POSIX_READER_WRITER_LOCKS
 200112L

	)

290 #unde‡
_POSIX_SPIN_LOCKS


291 
	#_POSIX_SPIN_LOCKS
 200112L

	)

293 #unde‡
_POSIX_BARRIERS


294 
	#_POSIX_BARRIERS
 200112L

	)

296 #unde‡
_POSIX_THREAD_SAFE_FUNCTIONS


297 
	#_POSIX_THREAD_SAFE_FUNCTIONS
 200112L

	)

299 #unde‡
_POSIX_THREAD_ATTR_STACKSIZE


300 
	#_POSIX_THREAD_ATTR_STACKSIZE
 200112L

	)

305 #unde‡
_POSIX_THREAD_ATTR_STACKADDR


306 
	#_POSIX_THREAD_ATTR_STACKADDR
 -1

	)

308 #unde‡
_POSIX_THREAD_PRIO_INHERIT


309 
	#_POSIX_THREAD_PRIO_INHERIT
 -1

	)

311 #unde‡
_POSIX_THREAD_PRIO_PROTECT


312 
	#_POSIX_THREAD_PRIO_PROTECT
 -1

	)

315 #unde‡
_POSIX_THREAD_PRIORITY_SCHEDULING


316 
	#_POSIX_THREAD_PRIORITY_SCHEDULING
 -1

	)

318 #unde‡
_POSIX_THREAD_PROCESS_SHARED


319 
	#_POSIX_THREAD_PROCESS_SHARED
 -1

	)

354 #unde‡
_POSIX_THREAD_DESTRUCTOR_ITERATIONS


355 
	#_POSIX_THREAD_DESTRUCTOR_ITERATIONS
 4

	)

357 #unde‡
PTHREAD_DESTRUCTOR_ITERATIONS


358 
	#PTHREAD_DESTRUCTOR_ITERATIONS
 
_POSIX_THREAD_DESTRUCTOR_ITERATIONS


	)

360 #unde‡
_POSIX_THREAD_KEYS_MAX


361 
	#_POSIX_THREAD_KEYS_MAX
 128

	)

363 #unde‡
PTHREAD_KEYS_MAX


364 
	#PTHREAD_KEYS_MAX
 
_POSIX_THREAD_KEYS_MAX


	)

366 #unde‡
PTHREAD_STACK_MIN


367 
	#PTHREAD_STACK_MIN
 0

	)

369 #unde‡
_POSIX_THREAD_THREADS_MAX


370 
	#_POSIX_THREAD_THREADS_MAX
 64

	)

373 #unde‡
PTHREAD_THREADS_MAX


374 
	#PTHREAD_THREADS_MAX
 2019

	)

376 #unde‡
_POSIX_SEM_NSEMS_MAX


377 
	#_POSIX_SEM_NSEMS_MAX
 256

	)

380 #unde‡
SEM_NSEMS_MAX


381 
	#SEM_NSEMS_MAX
 1024

	)

383 #unde‡
_POSIX_SEM_VALUE_MAX


384 
	#_POSIX_SEM_VALUE_MAX
 32767

	)

386 #unde‡
SEM_VALUE_MAX


387 
	#SEM_VALUE_MAX
 
INT_MAX


	)

397 * 
	mp
;

398 
	mx
;

399 } 
	t±e_h™dÀ_t
;

401 
±e_h™dÀ_t
 
	t±hªad_t
;

402 
±hªad_©å_t_
 * 
	t±hªad_©å_t
;

403 
±hªad_⁄˚_t_
 
	t±hªad_⁄˚_t
;

404 
±hªad_key_t_
 * 
	t±hªad_key_t
;

405 
±hªad_muãx_t_
 * 
	t±hªad_muãx_t
;

406 
±hªad_muãx©å_t_
 * 
	t±hªad_muãx©å_t
;

407 
±hªad_c⁄d_t_
 * 
	t±hªad_c⁄d_t
;

408 
±hªad_c⁄d©å_t_
 * 
	t±hªad_c⁄d©å_t
;

409 
±hªad_rwlock_t_
 * 
	t±hªad_rwlock_t
;

410 
±hªad_rwlock©å_t_
 * 
	t±hªad_rwlock©å_t
;

411 
±hªad_•ölock_t_
 * 
	t±hªad_•ölock_t
;

412 
±hªad_b¨rõr_t_
 * 
	t±hªad_b¨rõr_t
;

413 
±hªad_b¨rõøâr_t_
 * 
	t±hªad_b¨rõøâr_t
;

428 
	mPTHREAD_CREATE_JOINABLE
 = 0,

429 
	mPTHREAD_CREATE_DETACHED
 = 1,

434 
	mPTHREAD_INHERIT_SCHED
 = 0,

435 
	mPTHREAD_EXPLICIT_SCHED
 = 1,

440 
	mPTHREAD_SCOPE_PROCESS
 = 0,

441 
	mPTHREAD_SCOPE_SYSTEM
 = 1,

442 
	mPTHREAD_SCOPE_PROCESS_VFPU
 = 2,

447 
	mPTHREAD_CANCEL_ENABLE
 = 0,

448 
	mPTHREAD_CANCEL_DISABLE
 = 1,

453 
	mPTHREAD_CANCEL_ASYNCHRONOUS
 = 0,

454 
	mPTHREAD_CANCEL_DEFERRED
 = 1,

460 
	mPTHREAD_PROCESS_PRIVATE
 = 0,

461 
	mPTHREAD_PROCESS_SHARED
 = 1,

466 
	mPTHREAD_BARRIER_SERIAL_THREAD
 = -1

476 
	#PTHREAD_CANCELED
 ((*Ë-1)

	)

486 
	#PTHREAD_ONCE_INIT
 { 
PTE_FALSE
, 0, 0, 0}

	)

488 
	s±hªad_⁄˚_t_


490 
	m°©e
;

491 * 
	m£m≠h‹e
;

492 
	mnumSem≠h‹eU£rs
;

493 
	md⁄e
;

507 
	#PTHREAD_MUTEX_INITIALIZER
 ((
±hªad_muãx_t
Ë-1)

	)

508 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER
 ((
±hªad_muãx_t
Ë-2)

	)

509 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
 ((
±hªad_muãx_t
Ë-3)

	)

514 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 
PTHREAD_RECURSIVE_MUTEX_INITIALIZER


	)

515 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER


	)

517 
	#PTHREAD_COND_INITIALIZER
 ((
±hªad_c⁄d_t
Ë-1)

	)

519 
	#PTHREAD_RWLOCK_INITIALIZER
 ((
±hªad_rwlock_t
Ë-1)

	)

521 
	#PTHREAD_SPINLOCK_INITIALIZER
 ((
±hªad_•ölock_t
Ë-1)

	)

530 
	mPTHREAD_MUTEX_FAST_NP
,

531 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

532 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

533 
	mPTHREAD_MUTEX_TIMED_NP
 = 
PTHREAD_MUTEX_FAST_NP
,

534 
	mPTHREAD_MUTEX_ADAPTIVE_NP
 = 
PTHREAD_MUTEX_FAST_NP
,

536 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_FAST_NP
,

537 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

538 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

539 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


543 
±e_˛ónup_t
 
	t±e_˛ónup_t
;

545 (* 
	t±e_˛ónup_ˇŒback_t
)(*);

547 
	s±e_˛ónup_t


549 
±e_˛ónup_ˇŒback_t
 
routöe
;

550 *
¨g
;

551 
±e_˛ónup_t
 *
¥ev
;

554 #ifde‡
PTE_CLEANUP_C


560 
	#±hªad_˛ónup_push
–
_rout
, 
_¨g
 ) \

562 
±e_˛ónup_t
 
_˛ónup
; \

564 
	`±e_push_˛ónup
–&
_˛ónup
, (
±e_˛ónup_ˇŒback_t
Ë(
_rout
), (
_¨g
) ); \

565 

	)

566 
	#±hªad_˛ónup_p›
–
_execuã
 ) \

567 (Ë
	`±e_p›_˛ónup
–
_execuã
 ); \

568 
	}

	)
}

572 #ifde‡
PTE_CLEANUP_CXX


579 ˛as†
	cPThªadCÀ™up


593 
±e_˛ónup_ˇŒback_t
 
	m˛ónUpRout
;

594 * 
	mobj
;

595 
	mexecuãIt
;

597 
	mpublic
:

598 
	$PThªadCÀ™up
() :

599 
	`˛ónUpRout
( 0 ),

600 
	`obj
( 0 ),

601 
	$execuãIt
( 0 )

608 
	$PThªadCÀ™up
(

609 
±e_˛ónup_ˇŒback_t
 
routöe
,

610 * 
¨g
 ) :

611 
	`˛ónUpRout
–
routöe
 ),

612 
	`obj
–
¨g
 ),

613 
	$execuãIt
( 1 )

618 
	}
}

620 ~
	$PThªadCÀ™up
()

622 i‡–
execuãIt
 )

624 (Ë(*
˛ónUpRout
)–
obj
 );

626 
	}
}

628 
	$execuã
–
exec
 )

630 
execuãIt
 = 
exec
;

631 
	}
}

640 
	#±hªad_˛ónup_push
–
_rout
, 
_¨g
 ) \

642 
PThªadCÀ™up
 
	`˛ónup
((
±e_˛ónup_ˇŒback_t
)(
_rout
), \

643 (*Ë(
_¨g
Ë);

	)

645 
	#±hªad_˛ónup_p›
–
_execuã
 ) \

646 
˛ónup
.
	`execuã
–
_execuã
 ); \

647 }

	)

651 #îr‹ 
ERROR
 [
__FILE__
, 
löe
 
__LINE__
]: 
CÀ™up
 
ty≥
 
undeföed
.

665 
±hªad_öô
 ();

666 
±hªad_ãrmö©e
 ();

671 
±hªad_©å_öô
 (
±hªad_©å_t
 * 
©å
);

673 
±hªad_©å_de°roy
 (
±hªad_©å_t
 * 
©å
);

675 
±hªad_©å_gëdëach°©e
 (c⁄° 
±hªad_©å_t
 * 
©å
,

676 *
dëach°©e
);

678 
±hªad_©å_gë°ackaddr
 (c⁄° 
±hªad_©å_t
 * 
©å
,

679 **
°ackaddr
);

681 
±hªad_©å_gë°acksize
 (c⁄° 
±hªad_©å_t
 * 
©å
,

682 
size_t
 * 
°acksize
);

684 
±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 * 
©å
,

685 
dëach°©e
);

687 
±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 * 
©å
,

688 *
°ackaddr
);

690 
±hªad_©å_£t°acksize
 (
±hªad_©å_t
 * 
©å
,

691 
size_t
 
°acksize
);

693 
±hªad_©å_gësched∑øm
 (c⁄° 
±hªad_©å_t
 *
©å
,

694 
sched_∑øm
 *
∑øm
);

696 
±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 *
©å
,

697 c⁄° 
sched_∑øm
 *
∑øm
);

699 
±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 *,

702 
±hªad_©å_gëschedpﬁicy
 (
±hªad_©å_t
 *,

705 
±hªad_©å_£töhîôsched
(
±hªad_©å_t
 * 
©å
,

706 
öhîôsched
);

708 
±hªad_©å_gëöhîôsched
(
±hªad_©å_t
 * 
©å
,

709 * 
öhîôsched
);

711 
±hªad_©å_£tsc›e
 (
±hªad_©å_t
 *,

714 
±hªad_©å_gësc›e
 (c⁄° 
±hªad_©å_t
 *,

720 
±hªad_¸óã
 (
±hªad_t
 * 
tid
,

721 c⁄° 
±hªad_©å_t
 * 
©å
,

722 *(*
°¨t
) (*),

723 *
¨g
);

725 
±hªad_dëach
 (
±hªad_t
 
tid
);

727 
±hªad_equÆ
 (
±hªad_t
 
t1
,

728 
±hªad_t
 
t2
);

730 
±hªad_exô
 (*
vÆue_±r
);

732 
±hªad_joö
 (
±hªad_t
 
thªad
,

733 **
vÆue_±r
);

735 
±hªad_t
 
±hªad_£lf
 ();

737 
±hªad_ˇn˚l
 (
±hªad_t
 
thªad
);

739 
±hªad_£tˇn˚l°©e
 (
°©e
,

740 *
ﬁd°©e
);

742 
±hªad_£tˇn˚…y≥
 (
ty≥
,

743 *
ﬁdty≥
);

745 
±hªad_ã°ˇn˚l
 ();

747 
±hªad_⁄˚
 (
±hªad_⁄˚_t
 * 
⁄˚_c⁄åﬁ
,

748 (*
öô_routöe
) ());

750 #i‡
PTE_LEVEL
 >
PTE_LEVEL_MAX


751 
±e_˛ónup_t
 * 
	`±e_p›_˛ónup
 (
execuã
);

753 
	`±e_push_˛ónup
 (
±e_˛ónup_t
 * 
˛ónup
,

754 (*
routöe
) (*),

755 *
¨g
);

761 
	`±hªad_key_¸óã
 (
±hªad_key_t
 * 
key
,

762 (*
de°ru˘‹
) (*));

764 
	`±hªad_key_dñëe
 (
±hªad_key_t
 
key
);

766 
	`±hªad_£t•ecific
 (
±hªad_key_t
 
key
,

767 c⁄° *
vÆue
);

769 * 
	`±hªad_gë•ecific
 (
±hªad_key_t
 
key
);

775 
	`±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 * 
©å
);

777 
	`±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 * 
©å
);

779 
	`±hªad_muãx©å_gëpsh¨ed
 (c⁄° 
±hªad_muãx©å_t


780 * 
©å
,

781 *
psh¨ed
);

783 
	`±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 * 
©å
,

784 
psh¨ed
);

786 
	`±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 * 
©å
, 
köd
);

787 
	`±hªad_muãx©å_gëty≥
 (
±hªad_muãx©å_t
 * 
©å
, *
köd
);

792 
	`±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 * 
©å
);

794 
	`±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 * 
©å
);

796 
	`±hªad_b¨rõøâr_gëpsh¨ed
 (c⁄° 
±hªad_b¨rõøâr_t


797 * 
©å
,

798 *
psh¨ed
);

800 
	`±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 * 
©å
,

801 
psh¨ed
);

806 
	`±hªad_muãx_öô
 (
±hªad_muãx_t
 * 
muãx
,

807 c⁄° 
±hªad_muãx©å_t
 * 
©å
);

809 
	`±hªad_muãx_de°roy
 (
±hªad_muãx_t
 * 
muãx
);

811 
	`±hªad_muãx_lock
 (
±hªad_muãx_t
 * 
muãx
);

813 
	`±hªad_muãx_timedlock
(
±hªad_muãx_t
 *
muãx
,

814 c⁄° 
time•ec
 *
ab°ime
);

816 
	`±hªad_muãx_åylock
 (
±hªad_muãx_t
 * 
muãx
);

818 
	`±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 * 
muãx
);

823 
	`±hªad_•ö_öô
 (
±hªad_•ölock_t
 * 
lock
, 
psh¨ed
);

825 
	`±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 * 
lock
);

827 
	`±hªad_•ö_lock
 (
±hªad_•ölock_t
 * 
lock
);

829 
	`±hªad_•ö_åylock
 (
±hªad_•ölock_t
 * 
lock
);

831 
	`±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 * 
lock
);

836 
	`±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 * 
b¨rõr
,

837 c⁄° 
±hªad_b¨rõøâr_t
 * 
©å
,

838 
cou¡
);

840 
	`±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 * 
b¨rõr
);

842 
	`±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 * 
b¨rõr
);

847 
	`±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 * 
©å
);

849 
	`±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 * 
©å
);

851 
	`±hªad_c⁄d©å_gëpsh¨ed
 (c⁄° 
±hªad_c⁄d©å_t
 * 
©å
,

852 *
psh¨ed
);

854 
	`±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 * 
©å
,

855 
psh¨ed
);

860 
	`±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 * 
c⁄d
,

861 c⁄° 
±hªad_c⁄d©å_t
 * 
©å
);

863 
	`±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 * 
c⁄d
);

865 
	`±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 * 
c⁄d
,

866 
±hªad_muãx_t
 * 
muãx
);

868 
	`±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 * 
c⁄d
,

869 
±hªad_muãx_t
 * 
muãx
,

870 c⁄° 
time•ec
 *
ab°ime
);

872 
	`±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 * 
c⁄d
);

874 
	`±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 * 
c⁄d
);

879 
	`±hªad_£tsched∑øm
 (
±hªad_t
 
thªad
,

880 
pﬁicy
,

881 c⁄° 
sched_∑øm
 *
∑øm
);

883 
	`±hªad_gësched∑øm
 (
±hªad_t
 
thªad
,

884 *
pﬁicy
,

885 
sched_∑øm
 *
∑øm
);

887 
	`±hªad_£tc⁄cuºícy
 ();

889 
	`±hªad_gëc⁄cuºícy
 ();

894 
	`±hªad_rwlock_öô
(
±hªad_rwlock_t
 *
lock
,

895 c⁄° 
±hªad_rwlock©å_t
 *
©å
);

897 
	`±hªad_rwlock_de°roy
(
±hªad_rwlock_t
 *
lock
);

899 
	`±hªad_rwlock_åyrdlock
(
±hªad_rwlock_t
 *);

901 
	`±hªad_rwlock_åywæock
(
±hªad_rwlock_t
 *);

903 
	`±hªad_rwlock_rdlock
(
±hªad_rwlock_t
 *
lock
);

905 
	`±hªad_rwlock_timedrdlock
(
±hªad_rwlock_t
 *
lock
,

906 c⁄° 
time•ec
 *
ab°ime
);

908 
	`±hªad_rwlock_wæock
(
±hªad_rwlock_t
 *
lock
);

910 
	`±hªad_rwlock_timedwæock
(
±hªad_rwlock_t
 *
lock
,

911 c⁄° 
time•ec
 *
ab°ime
);

913 
	`±hªad_rwlock_u∆ock
(
±hªad_rwlock_t
 *
lock
);

915 
	`±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 * 
©å
);

917 
	`±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 * 
©å
);

919 
	`±hªad_rwlock©å_gëpsh¨ed
 (c⁄° 
±hªad_rwlock©å_t
 * 
©å
,

920 *
psh¨ed
);

922 
	`±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 * 
©å
,

923 
psh¨ed
);

925 #i‡
PTE_LEVEL
 >
PTE_LEVEL_MAX
 - 1

931 
	`±hªad_kûl
(
±hªad_t
 
thªad
, 
sig
);

940 
	`±hªad_muãx©å_£tköd_≈
(
±hªad_muãx©å_t
 * 
©å
,

941 
köd
);

942 
	`±hªad_muãx©å_gëköd_≈
(
±hªad_muãx©å_t
 * 
©å
,

943 *
köd
);

948 
	`±hªad_dñay_≈
 (
time•ec
 * 
öãrvÆ
);

949 
	`±hªad_num_¥o˚ss‹s_≈
();

959 * 
	`±hªad_timech™ge_h™dÀr_≈
(*);

963 #i‡
PTE_LEVEL
 >
PTE_LEVEL_MAX


972 
	#_·ime
 
·ime


	)

973 
	#_timeb
 
timeb


	)

975 #ifde‡
__˝lu•lus


980 ˛as†
	c±e_ex˚±i⁄
 {};

981 ˛as†
	c±e_ex˚±i⁄_ˇn˚l
 : 
public
 
±e_ex˚±i⁄
 {};

982 ˛as†
	c±e_ex˚±i⁄_exô
 : 
public
 
±e_ex˚±i⁄
 {};

987 #ifde‡
PTE_CXX_EXCEPTIONS


993 
	#ˇtch
–
E
 ) \

994 
	`ˇtch
–
±e_ex˚±i⁄
 & ) { 
throw
; 
	}
} \

995 
	`ˇtch
–
E
 )

	)

999 #unde‡
PTE_LEVEL


1000 #unde‡
PTE_LEVEL_MAX


	@pthread_attr_destroy.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_©å_de°roy
 (
±hªad_©å_t
 * 
©å
)

75 i‡(
	`±e_is_©å
 (
©å
) != 0)

77  
EINVAL
;

83 (*
©å
)->
vÆid
 = 0;

84 
	`‰ì
 (*
©å
);

85 *
©å
 = 
NULL
;

88 
	}
}

	@pthread_attr_getdetachstate.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_gëdëach°©e
 (c⁄° 
±hªad_©å_t
 * 
©å
, *
dëach°©e
)

85 i‡(
	`±e_is_©å
 (
©å
Ë!0 || 
dëach°©e
 =
NULL
)

87 *
dëach°©e
 = 
PTHREAD_CREATE_DETACHED
;

88  
EINVAL
;

91 *
dëach°©e
 = (*
©å
)->detachstate;

93 
	}
}

	@pthread_attr_getinheritsched.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$±hªad_©å_gëöhîôsched
 (
±hªad_©å_t
 * 
©å
, *
öhîôsched
)

50 i‡(
	`±e_is_©å
 (
©å
Ë!0 || 
öhîôsched
 =
NULL
)

52  
EINVAL
;

55 *
öhîôsched
 = (*
©å
)->inheritsched;

57 
	}
}

	@pthread_attr_getschedparam.c

46 
	~<«utûus/«utûus.h
>

47 
	~<«utûus/«ut_°rög.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

50 
	~"sched.h
"

53 
	$±hªad_©å_gësched∑øm
 (c⁄° 
±hªad_©å_t
 * 
©å
,

54 
sched_∑øm
 *
∑øm
)

56 i‡(
	`±e_is_©å
 (
©å
Ë!0 || 
∑øm
 =
NULL
)

58  
EINVAL
;

61 
	`mem˝y
 (
∑øm
, &(*
©å
)->param,  (*param));

63 
	}
}

	@pthread_attr_getschedpolicy.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$±hªad_©å_gëschedpﬁicy
 (
±hªad_©å_t
 * 
©å
, *
pﬁicy
)

50 i‡(
	`±e_is_©å
 (
©å
Ë!0 || 
pﬁicy
 =
NULL
)

52  
EINVAL
;

59 i‡(
pﬁicy
 <(*Ë
SCHED_MAX
)

61  
EINVAL
;

64 *
pﬁicy
 = 
SCHED_OTHER
;

67 
	}
}

	@pthread_attr_getscope.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_gësc›e
 (c⁄° 
±hªad_©å_t
 * 
©å
, *
c⁄ã¡i⁄sc›e
)

50 #ifde‡
_POSIX_THREAD_PRIORITY_SCHEDULING


51 *
c⁄ã¡i⁄sc›e
 = (*
©å
)->contentionscope;

54  
ENOSYS
;

56 
	}
}

	@pthread_attr_getstackaddr.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_gë°ackaddr
 (c⁄° 
±hªad_©å_t
 * 
©å
, **
°ackaddr
)

84 #i‡
	`deföed
–
_POSIX_THREAD_ATTR_STACKADDR
 )

86 i‡(
	`±e_is_©å
 (
©å
) != 0)

88  
EINVAL
;

91 *
°ackaddr
 = (*
©å
)->stackaddr;

96  
ENOSYS
;

99 
	}
}

	@pthread_attr_getstacksize.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_gë°acksize
 (c⁄° 
±hªad_©å_t
 * 
©å
, 
size_t
 * 
°acksize
)

85 #ifde‡
_POSIX_THREAD_ATTR_STACKSIZE


87 i‡(
	`±e_is_©å
 (
©å
) != 0)

89  
EINVAL
;

93 *
°acksize
 = (*
©å
)->stacksize;

98  
ENOSYS
;

102 
	}
}

	@pthread_attr_init.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_©å_öô
 (
±hªad_©å_t
 * 
©å
)

77 
±hªad_©å_t
 
©å_ªsu…
;

79 i‡(
©å
 =
NULL
)

82  
EINVAL
;

85 
©å_ªsu…
 = (
±hªad_©å_t
Ë
	`mÆloc
 ( (*attr_result));

87 i‡(
©å_ªsu…
 =
NULL
)

89  
ENOMEM
;

92 #ifde‡
_POSIX_THREAD_ATTR_STACKSIZE


96 
©å_ªsu…
->
°acksize
 = 0;

99 #ifde‡
_POSIX_THREAD_ATTR_STACKADDR


101 
©å_ªsu…
->
°ackaddr
 = 
NULL
;

104 
©å_ªsu…
->
dëach°©e
 = 
PTHREAD_CREATE_JOINABLE
;

111 
©å_ªsu…
->
∑øm
.
sched_¥i‹ôy
 = 
	`±e_osThªadGëDeÁu…Pri‹ôy
();

112 
©å_ªsu…
->
öhîôsched
 = 
PTHREAD_EXPLICIT_SCHED
;

113 
©å_ªsu…
->
c⁄ã¡i⁄sc›e
 = 
PTHREAD_SCOPE_SYSTEM
;

115 
©å_ªsu…
->
vÆid
 = 
PTE_ATTR_VALID
;

117 *
©å
 = 
©å_ªsu…
;

120 
	}
}

	@pthread_attr_setdetachstate.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_£tdëach°©e
 (
±hªad_©å_t
 * 
©å
, 
dëach°©e
)

84 i‡(
	`±e_is_©å
 (
©å
) != 0)

86  
EINVAL
;

89 i‡(
dëach°©e
 !
PTHREAD_CREATE_JOINABLE
 &&

90 
dëach°©e
 !
PTHREAD_CREATE_DETACHED
)

92  
EINVAL
;

95 (*
©å
)->
dëach°©e
 = detachstate;

97 
	}
}

	@pthread_attr_setinheritsched.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$±hªad_©å_£töhîôsched
 (
±hªad_©å_t
 * 
©å
, 
öhîôsched
)

50 i‡(
	`±e_is_©å
 (
©å
) != 0)

52  
EINVAL
;

55 i‡(
PTHREAD_INHERIT_SCHED
 !
öhîôsched


56 && 
PTHREAD_EXPLICIT_SCHED
 !
öhîôsched
)

58  
EINVAL
;

61 (*
©å
)->
öhîôsched
 = inheritsched;

63 
	}
}

	@pthread_attr_setschedparam.c

46 
	~<«utûus/«utûus.h
>

47 
	~<«utûus/«ut_°rög.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

50 
	~"sched.h
"

53 
	$±hªad_©å_£tsched∑øm
 (
±hªad_©å_t
 * 
©å
,

54 c⁄° 
sched_∑øm
 *
∑øm
)

56 
¥i‹ôy
;

58 i‡(
	`±e_is_©å
 (
©å
Ë!0 || 
∑øm
 =
NULL
)

60  
EINVAL
;

63 
¥i‹ôy
 = 
∑øm
->
sched_¥i‹ôy
;

66 i‡(
¥i‹ôy
 < 
	`sched_gë_¥i‹ôy_mö
 (
SCHED_OTHER
) ||

67 
¥i‹ôy
 > 
	`sched_gë_¥i‹ôy_max
 (
SCHED_OTHER
))

69  
EINVAL
;

72 
	`mem˝y
 (&(*
©å
)->
∑øm
,Öaram,  (*param));

74 
	}
}

	@pthread_attr_setschedpolicy.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$±hªad_©å_£tschedpﬁicy
 (
±hªad_©å_t
 * 
©å
, 
pﬁicy
)

50 i‡(
	`±e_is_©å
 (
©å
) != 0)

52  
EINVAL
;

55 i‡(
pﬁicy
 !
SCHED_OTHER
)

57  
ENOTSUP
;

61 
	}
}

	@pthread_attr_setscope.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_£tsc›e
 (
±hªad_©å_t
 * 
©å
, 
c⁄ã¡i⁄sc›e
)

50 #ifde‡
_POSIX_THREAD_PRIORITY_SCHEDULING


51 
c⁄ã¡i⁄sc›e
)

53 
PTHREAD_SCOPE_SYSTEM
:

54 (*
©å
)->
c⁄ã¡i⁄sc›e
 = contentionscope;

56 
PTHREAD_SCOPE_PROCESS
:

57  
ENOTSUP
;

59  
EINVAL
;

62  
ENOSYS
;

64 
	}
}

	@pthread_attr_setstackaddr.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_£t°ackaddr
 (
±hªad_©å_t
 * 
©å
, *
°ackaddr
)

88 #i‡
	`deföed
–
_POSIX_THREAD_ATTR_STACKADDR
 )

90 i‡(
	`±e_is_©å
 (
©å
) != 0)

92  
EINVAL
;

95 (*
©å
)->
°ackaddr
 = stackaddr;

100  
ENOSYS
;

103 
	}
}

	@pthread_attr_setstacksize.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_©å_£t°acksize
 (
±hªad_©å_t
 * 
©å
, 
size_t
 
°acksize
)

89 #ifde‡
_POSIX_THREAD_ATTR_STACKSIZE


91 #i‡
PTHREAD_STACK_MIN
 > 0

94 i‡(
°acksize
 < 
PTHREAD_STACK_MIN
)

96  
EINVAL
;

101 i‡(
	`±e_is_©å
 (
©å
) != 0)

103  
EINVAL
;

107 (*
©å
)->
°acksize
 = stacksize;

112  
ENOSYS
;

116 
	}
}

	@pthread_barrier_destroy.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_b¨rõr_de°roy
 (
±hªad_b¨rõr_t
 * 
b¨rõr
)

53 
ªsu…
 = 0;

54 
±hªad_b¨rõr_t
 
b
;

56 i‡(
b¨rõr
 =
NULL
 || *b¨rõ∏=(
±hªad_b¨rõr_t
Ë
PTE_OBJECT_INVALID
)

58  
EINVAL
;

61 
b
 = *
b¨rõr
;

62 *
b¨rõr
 = 
NULL
;

64 i‡(0 =(
ªsu…
 = 
	`£m_de°roy
 (&(
b
->
£mB¨rõrBªeched
[0]))))

66 i‡(0 =(
ªsu…
 = 
	`£m_de°roy
 (&(
b
->
£mB¨rõrBªeched
[1]))))

68 
	`‰ì
(
b
);

72 (Ë
	`£m_öô
 (&(
b
->
£mB¨rõrBªeched
[0]), b->
psh¨ed
, 0);

75 *
b¨rõr
 = 
b
;

76  (
ªsu…
);

77 
	}
}

	@pthread_barrier_init.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_b¨rõr_öô
 (
±hªad_b¨rõr_t
 * 
b¨rõr
,

52 c⁄° 
±hªad_b¨rõøâr_t
 * 
©å
, 
cou¡
)

54 
±hªad_b¨rõr_t
 
b
;

56 i‡(
b¨rõr
 =
NULL
 || 
cou¡
 == 0)

58  
EINVAL
;

61 i‡(
NULL
 !(
b
 = (
±hªad_b¨rõr_t
Ë
	`ˇŒoc
 (1,  (*b))))

63 
b
->
psh¨ed
 = (
©å
 !
NULL
 && *attr != NULL

64 ? (*
©å
)->
psh¨ed
 : 
PTHREAD_PROCESS_PRIVATE
);

66 
b
->
nCuºítB¨rõrHeight
 = b->
nInôülB¨rõrHeight
 = 
cou¡
;

67 
b
->
iSãp
 = 0;

77 i‡(0 =
	`£m_öô
 (&(
b
->
£mB¨rõrBªeched
[0]), b->
psh¨ed
, 0))

79 i‡(0 =
	`£m_öô
 (&(
b
->
£mB¨rõrBªeched
[1]), b->
psh¨ed
, 0))

81 *
b¨rõr
 = 
b
;

84 (Ë
	`£m_de°roy
 (&(
b
->
£mB¨rõrBªeched
[0]));

88 
	`‰ì
(
b
);

91  
ENOMEM
;

92 
	}
}

	@pthread_barrier_wait.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_b¨rõr_waô
 (
±hªad_b¨rõr_t
 * 
b¨rõr
)

50 
ªsu…
;

51 
°ï
;

52 
±hªad_b¨rõr_t
 
b
;

54 i‡(
b¨rõr
 =
NULL
 || *b¨rõ∏=(
±hªad_b¨rõr_t
Ë
PTE_OBJECT_INVALID
)

56  
EINVAL
;

59 
b
 = *
b¨rõr
;

60 
°ï
 = 
b
->
iSãp
;

62 i‡(0 =
	`PTE_ATOMIC_DECREMENT
 ((*Ë&(
b
->
nCuºítB¨rõrHeight
)))

65 
b
->
nCuºítB¨rõrHeight
 = b->
nInôülB¨rõrHeight
;

76 
ªsu…
 = (
b
->
nInôülB¨rõrHeight
 > 1

77 ? 
	`£m_po°_mu…ùÀ
 (&(
b
->
£mB¨rõrBªeched
[
°ï
]),

78 
b
->
nInôülB¨rõrHeight
 - 1) : 0);

85 
ªsu…
 = 
	`£m_waô
 (&(
b
->
£mB¨rõrBªeched
[
°ï
]));

93 i‡(0 =
ªsu…
)

95 
ªsu…
 = (
°ï
 ==

96 
	`PTE_ATOMIC_COMPARE_EXCHANGE
 (& (
b
->
iSãp
),(1L - 
°ï
),step) ?

97 
PTHREAD_BARRIER_SERIAL_THREAD
 : 0);

100  (
ªsu…
);

101 
	}
}

	@pthread_barrierattr_destroy.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_b¨rõøâr_de°roy
 (
±hªad_b¨rõøâr_t
 * 
©å
)

77 
ªsu…
 = 0;

79 i‡(
©å
 =
NULL
 || *attr == NULL)

81 
ªsu…
 = 
EINVAL
;

85 
±hªad_b¨rõøâr_t
 
ba
 = *
©å
;

87 *
©å
 = 
NULL
;

88 
	`‰ì
 (
ba
);

91  (
ªsu…
);

92 
	}
}

	@pthread_barrierattr_getpshared.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_b¨rõøâr_gëpsh¨ed
 (c⁄° 
±hªad_b¨rõøâr_t
 * 
©å
,

49 *
psh¨ed
)

88 
ªsu…
;

90 i‡((
©å
 !
NULL
 && *©å !NULLË&& (
psh¨ed
 != NULL))

92 *
psh¨ed
 = (*
©å
)->pshared;

93 
ªsu…
 = 0;

97 
ªsu…
 = 
EINVAL
;

100  (
ªsu…
);

101 
	}
}

	@pthread_barrierattr_init.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_b¨rõøâr_öô
 (
±hªad_b¨rõøâr_t
 * 
©å
)

77 
±hªad_b¨rõøâr_t
 
ba
;

78 
ªsu…
 = 0;

80 
ba
 = (
±hªad_b¨rõøâr_t
Ë
	`ˇŒoc
 (1,  (*ba));

82 i‡(
ba
 =
NULL
)

84 
ªsu…
 = 
ENOMEM
;

88 
ba
->
psh¨ed
 = 
PTHREAD_PROCESS_PRIVATE
;

91 *
©å
 = 
ba
;

93  (
ªsu…
);

94 
	}
}

	@pthread_barrierattr_setpshared.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_b¨rõøâr_£çsh¨ed
 (
±hªad_b¨rõøâr_t
 * 
©å
, 
psh¨ed
)

90 
ªsu…
;

92 i‡((
©å
 !
NULL
 && *attr != NULL) &&

93 ((
psh¨ed
 =
PTHREAD_PROCESS_SHARED
) ||

94 (
psh¨ed
 =
PTHREAD_PROCESS_PRIVATE
)))

96 i‡(
psh¨ed
 =
PTHREAD_PROCESS_SHARED
)

99 #i‡!
	`deföed
–
_POSIX_THREAD_PROCESS_SHARED
 )

101 
ªsu…
 = 
ENOSYS
;

102 
psh¨ed
 = 
PTHREAD_PROCESS_PRIVATE
;

106 
ªsu…
 = 0;

113 
ªsu…
 = 0;

116 (*
©å
)->
psh¨ed
 =Öshared;

120 
ªsu…
 = 
EINVAL
;

123  (
ªsu…
);

125 
	}
}

	@pthread_cancel.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

47 
	~<«utûus/«utûus.h
>

49 
	$±hªad_ˇn˚l
 (
±hªad_t
 
thªad
)

72 
ªsu…
;

73 
ˇn˚l_£lf
;

74 
±hªad_t
 
£lf
;

75 
±e_thªad_t
 * 
ç
;

77 
ªsu…
 = 
	`±hªad_kûl
 (
thªad
, 0);

79 i‡(0 !
ªsu…
)

81  
ªsu…
;

84 i‡((
£lf
 = 
	`±hªad_£lf
 ()).
p
 =
NULL
)

86  
ENOMEM
;

103 
ˇn˚l_£lf
 = 
	`±hªad_equÆ
 (
thªad
, 
£lf
);

105 
ç
 = (
±e_thªad_t
 *Ë
thªad
.
p
;

110 (Ë
	`±hªad_muãx_lock
 (&
ç
->
ˇn˚lLock
);

112 i‡(
ç
->
ˇn˚lTy≥
 =
PTHREAD_CANCEL_ASYNCHRONOUS


113 && 
ç
->
ˇn˚lSèã
 =
PTHREAD_CANCEL_ENABLE


114 && 
ç
->
°©e
 < 
PThªadSèãC™˚lög
)

116 i‡(
ˇn˚l_£lf
)

118 
ç
->
°©e
 = 
PThªadSèãC™˚lög
;

119 
ç
->
ˇn˚lSèã
 = 
PTHREAD_CANCEL_DISABLE
;

121 (Ë
	`±hªad_muãx_u∆ock
 (&
ç
->
ˇn˚lLock
);

122 
	`±e_throw
 (
PTE_EPS_CANCEL
);

145 (Ë
	`±hªad_muãx_u∆ock
 (&
ç
->
ˇn˚lLock
);

147 
ªsu…
 = 
EPERM
;

156 i‡(
ç
->
°©e
 < 
PThªadSèãC™˚lPídög
)

158 
ç
->
°©e
 = 
PThªadSèãC™˚lPídög
;

160 i‡(
	`±e_osThªadC™˚l
(
ç
->
thªadId
Ë!
PTE_OS_OK
)

162 
ªsu…
 = 
ESRCH
;

165 i‡(
ç
->
°©e
 >
PThªadSèãC™˚lög
)

167 
ªsu…
 = 
ESRCH
;

170 (Ë
	`±hªad_muãx_u∆ock
 (&
ç
->
ˇn˚lLock
);

173  (
ªsu…
);

174 
	}
}

	@pthread_cond_destroy.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_c⁄d_de°roy
 (
±hªad_c⁄d_t
 * 
c⁄d
)

125 
±hªad_c⁄d_t
 
cv
;

126 
ªsu…
 = 0, 
ªsu…1
 = 0, 
ªsu…2
 = 0;

131 i‡(
c⁄d
 =
NULL
 || *cond == NULL)

133  
EINVAL
;

136 i‡(*
c⁄d
 !
PTHREAD_COND_INITIALIZER
)

139 
	`±e_osMuãxLock
 (
±e_c⁄d_li°_lock
);

141 
cv
 = *
c⁄d
;

148 i‡(
	`£m_waô
 (&(
cv
->
£mBlockLock
)) != 0)

150  
î∫o
;

158 i‡((
ªsu…
 = 
	`±hªad_muãx_åylock
 (&(
cv
->
mtxUnblockLock
))) != 0)

160 (Ë
	`£m_po°
 (&(
cv
->
£mBlockLock
));

161  
ªsu…
;

167 i‡(
cv
->
nWaôîsBlocked
 > cv->
nWaôîsG⁄e
)

169 i‡(
	`£m_po°
 (&(
cv
->
£mBlockLock
)) != 0)

171 
ªsu…
 = 
î∫o
;

173 
ªsu…1
 = 
	`±hªad_muãx_u∆ock
 (&(
cv
->
mtxUnblockLock
));

174 
ªsu…2
 = 
EBUSY
;

181 *
c⁄d
 = 
NULL
;

183 i‡(
	`£m_de°roy
 (&(
cv
->
£mBlockLock
)) != 0)

185 
ªsu…
 = 
î∫o
;

187 i‡(
	`£m_de°roy
 (&(
cv
->
£mBlockQueue
)) != 0)

189 
ªsu…1
 = 
î∫o
;

191 i‡((
ªsu…2
 = 
	`±hªad_muãx_u∆ock
 (&(
cv
->
mtxUnblockLock
))) == 0)

193 
ªsu…2
 = 
	`±hªad_muãx_de°roy
 (&(
cv
->
mtxUnblockLock
));

198 i‡(
±e_c⁄d_li°_hód
 =
cv
)

200 
±e_c⁄d_li°_hód
 = 
cv
->
√xt
;

204 
cv
->
¥ev
->
√xt
 = cv->next;

207 i‡(
±e_c⁄d_li°_èû
 =
cv
)

209 
±e_c⁄d_li°_èû
 = 
cv
->
¥ev
;

213 
cv
->
√xt
->
¥ev
 = cv->prev;

215 
	`‰ì
(
cv
);

219 
	`±e_osMuãxU∆ock
(
±e_c⁄d_li°_lock
);

228 
	`±e_osMuãxLock
 (
±e_c⁄d_ã°_öô_lock
);

233 i‡(*
c⁄d
 =
PTHREAD_COND_INITIALIZER
)

241 *
c⁄d
 = 
NULL
;

249 
ªsu…
 = 
EBUSY
;

252 
	`±e_osMuãxU∆ock
(
±e_c⁄d_ã°_öô_lock
);

255  ((
ªsu…
 !0Ë?Ñesu… : ((
ªsu…1
 !0Ë?Ñesu…1 : 
ªsu…2
));

256 
	}
}

	@pthread_cond_init.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_c⁄d_öô
 (
±hªad_c⁄d_t
 * 
c⁄d
, c⁄° 
±hªad_c⁄d©å_t
 * 
©å
)

79 
ªsu…
;

80 
±hªad_c⁄d_t
 
cv
 = 
NULL
;

82 i‡(
c⁄d
 =
NULL
)

84  
EINVAL
;

87 i‡((
©å
 !
NULL
 && *attr != NULL) &&

88 ((*
©å
)->
psh¨ed
 =
PTHREAD_PROCESS_SHARED
))

94 
ªsu…
 = 
ENOSYS
;

95 
DONE
;

98 
cv
 = (
±hªad_c⁄d_t
Ë
	`ˇŒoc
 (1,  (*cv));

100 i‡(
cv
 =
NULL
)

102 
ªsu…
 = 
ENOMEM
;

103 
DONE
;

106 
cv
->
nWaôîsBlocked
 = 0;

107 
cv
->
nWaôîsToUnblock
 = 0;

108 
cv
->
nWaôîsG⁄e
 = 0;

110 i‡(
	`£m_öô
 (&(
cv
->
£mBlockLock
), 0, 1) != 0)

112 
ªsu…
 = 
î∫o
;

113 
FAIL0
;

116 i‡(
	`£m_öô
 (&(
cv
->
£mBlockQueue
), 0, 0) != 0)

118 
ªsu…
 = 
î∫o
;

119 
FAIL1
;

122 i‡((
ªsu…
 = 
	`±hªad_muãx_öô
 (&(
cv
->
mtxUnblockLock
), 0)) != 0)

124 
FAIL2
;

127 
ªsu…
 = 0;

129 
DONE
;

136 
FAIL2
:

137 (Ë
	`£m_de°roy
 (&(
cv
->
£mBlockQueue
));

139 
FAIL1
:

140 (Ë
	`£m_de°roy
 (&(
cv
->
£mBlockLock
));

142 
FAIL0
:

143 
	`‰ì
(
cv
);

145 
cv
 = 
NULL
;

147 
DONE
:

148 i‡(0 =
ªsu…
)

151 
	`±e_osMuãxLock
 (
±e_c⁄d_li°_lock
);

153 
cv
->
√xt
 = 
NULL
;

154 
cv
->
¥ev
 = 
±e_c⁄d_li°_èû
;

156 i‡(
±e_c⁄d_li°_èû
 !
NULL
)

158 
±e_c⁄d_li°_èû
->
√xt
 = 
cv
;

161 
±e_c⁄d_li°_èû
 = 
cv
;

163 i‡(
±e_c⁄d_li°_hód
 =
NULL
)

165 
±e_c⁄d_li°_hód
 = 
cv
;

168 
	`±e_osMuãxU∆ock
(
±e_c⁄d_li°_lock
);

171 *
c⁄d
 = 
cv
;

173  
ªsu…
;

175 
	}
}

	@pthread_cond_signal.c

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

52 
	$±e_c⁄d_unblock
 (
±hªad_c⁄d_t
 * 
c⁄d
, 
unblockAŒ
)

73 
ªsu…
;

74 
±hªad_c⁄d_t
 
cv
;

75 
nSig«lsToIssue
;

77 i‡(
c⁄d
 =
NULL
 || *cond == NULL)

79  
EINVAL
;

82 
cv
 = *
c⁄d
;

88 i‡(
cv
 =
PTHREAD_COND_INITIALIZER
)

93 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&(
cv
->
mtxUnblockLock
))) != 0)

95  
ªsu…
;

98 i‡(0 !
cv
->
nWaôîsToUnblock
)

100 i‡(0 =
cv
->
nWaôîsBlocked
)

102  
	`±hªad_muãx_u∆ock
 (&(
cv
->
mtxUnblockLock
));

104 i‡(
unblockAŒ
)

106 
cv
->
nWaôîsToUnblock
 +(
nSig«lsToIssue
 = cv->
nWaôîsBlocked
);

107 
cv
->
nWaôîsBlocked
 = 0;

111 
nSig«lsToIssue
 = 1;

112 
cv
->
nWaôîsToUnblock
++;

113 
cv
->
nWaôîsBlocked
--;

116 i‡(
cv
->
nWaôîsBlocked
 > cv->
nWaôîsG⁄e
)

120 i‡(
	`£m_waô
 (&(
cv
->
£mBlockLock
)) != 0)

122 
ªsu…
 = 
î∫o
;

123 (Ë
	`±hªad_muãx_u∆ock
 (&(
cv
->
mtxUnblockLock
));

124  
ªsu…
;

126 i‡(0 !
cv
->
nWaôîsG⁄e
)

128 
cv
->
nWaôîsBlocked
 -cv->
nWaôîsG⁄e
;

129 
cv
->
nWaôîsG⁄e
 = 0;

131 i‡(
unblockAŒ
)

133 
nSig«lsToIssue
 = 
cv
->
nWaôîsToUnblock
 = cv->
nWaôîsBlocked
;

134 
cv
->
nWaôîsBlocked
 = 0;

138 
nSig«lsToIssue
 = 
cv
->
nWaôîsToUnblock
 = 1;

139 
cv
->
nWaôîsBlocked
--;

144  
	`±hªad_muãx_u∆ock
 (&(
cv
->
mtxUnblockLock
));

147 i‡((
ªsu…
 = 
	`±hªad_muãx_u∆ock
 (&(
cv
->
mtxUnblockLock
))) == 0)

149 i‡(
	`£m_po°_mu…ùÀ
 (&(
cv
->
£mBlockQueue
), 
nSig«lsToIssue
) != 0)

151 
ªsu…
 = 
î∫o
;

155  
ªsu…
;

157 
	}
}

160 
	$±hªad_c⁄d_sig«l
 (
±hªad_c⁄d_t
 * 
c⁄d
)

197  (
	`±e_c⁄d_unblock
 (
c⁄d
, 0));

199 
	}
}

202 
	$±hªad_c⁄d_brﬂdˇ°
 (
±hªad_c⁄d_t
 * 
c⁄d
)

236  (
	`±e_c⁄d_unblock
 (
c⁄d
, 
PTE_TRUE
));

238 
	}
}

	@pthread_cond_wait.c

267 
	~"±hªad.h
"

268 
	~"im∂emít.h
"

276 
±hªad_muãx_t
 *
	mmuãxPå
;

277 
±hªad_c⁄d_t
 
	mcv
;

278 *
	mªsu…På
;

279 } 
	t±e_c⁄d_waô_˛ónup_¨gs_t
;

282 
	$±e_c⁄d_waô_˛ónup
 (*
¨gs
)

284 
±e_c⁄d_waô_˛ónup_¨gs_t
 *
˛ónup_¨gs
 =

285 (
±e_c⁄d_waô_˛ónup_¨gs_t
 *Ë
¨gs
;

286 
±hªad_c⁄d_t
 
cv
 = 
˛ónup_¨gs
->cv;

287 *
ªsu…På
 = 
˛ónup_¨gs
->resultPtr;

288 
nSig«lsWasLe·
;

289 
ªsu…
;

297 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&(
cv
->
mtxUnblockLock
))) != 0)

299 *
ªsu…På
 = 
ªsu…
;

303 i‡(0 !(
nSig«lsWasLe·
 = 
cv
->
nWaôîsToUnblock
))

305 --(
cv
->
nWaôîsToUnblock
);

307 i‡(
INT_MAX
 / 2 =++(
cv
->
nWaôîsG⁄e
))

311 i‡(
	`£m_waô
 (&(
cv
->
£mBlockLock
)) != 0)

313 *
ªsu…På
 = 
î∫o
;

321 
cv
->
nWaôîsBlocked
 -cv->
nWaôîsG⁄e
;

322 i‡(
	`£m_po°
 (&(
cv
->
£mBlockLock
)) != 0)

324 *
ªsu…På
 = 
î∫o
;

332 
cv
->
nWaôîsG⁄e
 = 0;

335 i‡((
ªsu…
 = 
	`±hªad_muãx_u∆ock
 (&(
cv
->
mtxUnblockLock
))) != 0)

337 *
ªsu…På
 = 
ªsu…
;

341 i‡(1 =
nSig«lsWasLe·
)

343 i‡(
	`£m_po°
 (&(
cv
->
£mBlockLock
)) != 0)

345 *
ªsu…På
 = 
î∫o
;

354 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (
˛ónup_¨gs
->
muãxPå
)) != 0)

356 *
ªsu…På
 = 
ªsu…
;

358 
	}
}

361 
	$±e_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 * 
c⁄d
,

362 
±hªad_muãx_t
 * 
muãx
, c⁄° 
time•ec
 *
ab°ime
)

364 
ªsu…
 = 0;

365 
±hªad_c⁄d_t
 
cv
;

366 
±e_c⁄d_waô_˛ónup_¨gs_t
 
˛ónup_¨gs
;

368 i‡(
c⁄d
 =
NULL
 || *cond == NULL)

370  
EINVAL
;

379 i‡(*
c⁄d
 =
PTHREAD_COND_INITIALIZER
)

381 
ªsu…
 = 
	`±e_c⁄d_check_√ed_öô
 (
c⁄d
);

384 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
)

386  
ªsu…
;

389 
cv
 = *
c⁄d
;

392 i‡(
	`£m_waô
 (&(
cv
->
£mBlockLock
)) != 0)

394  
î∫o
;

397 ++(
cv
->
nWaôîsBlocked
);

399 i‡(
	`£m_po°
 (&(
cv
->
£mBlockLock
)) != 0)

401  
î∫o
;

407 
˛ónup_¨gs
.
muãxPå
 = 
muãx
;

408 
˛ónup_¨gs
.
cv
 = cv;

409 
˛ónup_¨gs
.
ªsu…På
 = &
ªsu…
;

411 
	`±hªad_˛ónup_push
 (
±e_c⁄d_waô_˛ónup
, (*Ë&
˛ónup_¨gs
);

416 i‡((
ªsu…
 = 
	`±hªad_muãx_u∆ock
 (
muãx
)) == 0)

434 i‡(
	`£m_timedwaô
 (&(
cv
->
£mBlockQueue
), 
ab°ime
) != 0)

436 
ªsu…
 = 
î∫o
;

444 
	`±hªad_˛ónup_p›
 (1);

449  
ªsu…
;

451 
	}
}

455 
	$±hªad_c⁄d_waô
 (
±hªad_c⁄d_t
 * 
c⁄d
, 
±hªad_muãx_t
 * 
muãx
)

507  (
	`±e_c⁄d_timedwaô
 (
c⁄d
, 
muãx
, 
NULL
));

509 
	}
}

513 
	$±hªad_c⁄d_timedwaô
 (
±hªad_c⁄d_t
 * 
c⁄d
,

514 
±hªad_muãx_t
 * 
muãx
,

515 c⁄° 
time•ec
 *
ab°ime
)

561 i‡(
ab°ime
 =
NULL
)

563  
EINVAL
;

566  (
	`±e_c⁄d_timedwaô
 (
c⁄d
, 
muãx
, 
ab°ime
));

568 
	}
}

	@pthread_condattr_destroy.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

52 
	$±hªad_c⁄d©å_de°roy
 (
±hªad_c⁄d©å_t
 * 
©å
)

79 
ªsu…
 = 0;

81 i‡(
©å
 =
NULL
 || *attr == NULL)

83 
ªsu…
 = 
EINVAL
;

87 
	`‰ì
(*
©å
);

90 *
©å
 = 
NULL
;

91 
ªsu…
 = 0;

94  
ªsu…
;

96 
	}
}

	@pthread_condattr_getpshared.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

49 
	$±hªad_c⁄d©å_gëpsh¨ed
 (c⁄° 
±hªad_c⁄d©å_t
 * 
©å
, *
psh¨ed
)

89 
ªsu…
;

91 i‡((
©å
 !
NULL
 && *©å !NULLË&& (
psh¨ed
 != NULL))

93 *
psh¨ed
 = (*
©å
)->pshared;

94 
ªsu…
 = 0;

98 
ªsu…
 = 
EINVAL
;

101  
ªsu…
;

103 
	}
}

	@pthread_condattr_init.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

52 
	$±hªad_c⁄d©å_öô
 (
±hªad_c⁄d©å_t
 * 
©å
)

82 
±hªad_c⁄d©å_t
 
©å_ªsu…
;

83 
ªsu…
 = 0;

85 
©å_ªsu…
 = (
±hªad_c⁄d©å_t
Ë
	`ˇŒoc
 (1,  (*attr_result));

87 i‡(
©å_ªsu…
 =
NULL
)

89 
ªsu…
 = 
ENOMEM
;

92 *
©å
 = 
©å_ªsu…
;

94  
ªsu…
;

96 
	}
}

	@pthread_condattr_setpshared.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

49 
	$±hªad_c⁄d©å_£çsh¨ed
 (
±hªad_c⁄d©å_t
 * 
©å
, 
psh¨ed
)

91 
ªsu…
;

93 i‡((
©å
 !
NULL
 && *attr != NULL)

94 && ((
psh¨ed
 =
PTHREAD_PROCESS_SHARED
)

95 || (
psh¨ed
 =
PTHREAD_PROCESS_PRIVATE
)))

97 i‡(
psh¨ed
 =
PTHREAD_PROCESS_SHARED
)

100 #i‡!
	`deföed
–
_POSIX_THREAD_PROCESS_SHARED
 )

101 
ªsu…
 = 
ENOSYS
;

102 
psh¨ed
 = 
PTHREAD_PROCESS_PRIVATE
;

104 
ªsu…
 = 0;

111 
ªsu…
 = 0;

114 (*
©å
)->
psh¨ed
 =Öshared;

118 
ªsu…
 = 
EINVAL
;

121  
ªsu…
;

123 
	}
}

	@pthread_delay_np.c

44 
	~<«utûus/«utûus.h
>

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

91 
	$±hªad_dñay_≈
 (
time•ec
 *
öãrvÆ
)

93 
waô_time
;

94 
£cs_ö_mûli£cs
;

95 
mûli£cs
;

96 
±hªad_t
 
£lf
;

97 
±e_thªad_t
 * 
•
;

99 i‡(
öãrvÆ
 =
NULL
)

101  
EINVAL
;

104 i‡(
öãrvÆ
->
tv_£c
 =0L && i¡îvÆ->
tv_n£c
 == 0L)

106 
	`±hªad_ã°ˇn˚l
 ();

107 
	`±e_osThªadSÀï
 (1);

108 
	`±hªad_ã°ˇn˚l
 ();

113 
£cs_ö_mûli£cs
 = 
öãrvÆ
->
tv_£c
 * 1000L;

116 
mûli£cs
 = (
öãrvÆ
->
tv_n£c
 + 999999L) / 1000000L;

118 
waô_time
 = 
£cs_ö_mûli£cs
 + 
mûli£cs
;

120 i‡(
NULL
 =(
£lf
 = 
	`±hªad_£lf
 ()).
p
)

122  
ENOMEM
;

125 
•
 = (
±e_thªad_t
 *Ë
£lf
.
p
;

127 i‡(
•
->
ˇn˚lSèã
 =
PTHREAD_CANCEL_ENABLE
)

129 
±e_osResu…
 
ˇn˚lSètus
;

134 
ˇn˚lSètus
 = 
	`±e_osThªadCheckC™˚l
(
•
->
thªadId
);

136 i‡(
ˇn˚lSètus
 =
PTE_OS_INTERRUPTED
)

141 (Ë
	`±hªad_muãx_lock
 (&
•
->
ˇn˚lLock
);

142 i‡(
•
->
°©e
 < 
PThªadSèãC™˚lög
)

144 
•
->
°©e
 = 
PThªadSèãC™˚lög
;

145 
•
->
ˇn˚lSèã
 = 
PTHREAD_CANCEL_DISABLE
;

146 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

148 
	`±e_throw
 (
PTE_EPS_CANCEL
);

151 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

152  
ESRCH
;

154 i‡(
ˇn˚lSètus
 !
PTE_OS_OK
)

156  
EINVAL
;

162 
	`±e_osThªadSÀï
 (
waô_time
);

166 
	}
}

	@pthread_detach.c

44 
	~"nk/±e_oßl.h
"

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_dëach
 (
±hªad_t
 
thªad
)

76 
ªsu…
;

77 
de°royIt
 = 
PTE_FALSE
;

78 
±e_thªad_t
 * 
ç
 = (±e_thªad_à*Ë
thªad
.
p
;

81 
	`±e_osMuãxLock
 (
±e_thªad_ªu£_lock
);

83 i‡(
NULL
 =
ç


84 || 
thªad
.
x
 !
ç
->
±H™dÀ
.x)

86 
ªsu…
 = 
ESRCH
;

88 i‡(
PTHREAD_CREATE_DETACHED
 =
ç
->
dëachSèã
)

90 
ªsu…
 = 
EINVAL
;

99 
ªsu…
 = 0;

101 i‡(
	`±hªad_muãx_lock
 (&
ç
->
ˇn˚lLock
) == 0)

103 i‡(
ç
->
°©e
 !
PThªadSèãLa°
)

105 
ç
->
dëachSèã
 = 
PTHREAD_CREATE_DETACHED
;

107 i‡(
ç
->
dëachSèã
 !
PTHREAD_CREATE_DETACHED
)

112 
de°royIt
 = 
PTE_TRUE
;

114 (Ë
	`±hªad_muãx_u∆ock
 (&
ç
->
ˇn˚lLock
);

119 
ªsu…
 = 
ESRCH
;

123 
	`±e_osMuãxU∆ock
(
±e_thªad_ªu£_lock
);

125 i‡(
ªsu…
 == 0)

129 i‡(
de°royIt
)

134 
	`±e_osThªadWaôF‹End
(
ç
->
thªadId
);

136 
	`±e_thªadDe°roy
 (
thªad
);

140  (
ªsu…
);

142 
	}
}

	@pthread_equal.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_equÆ
 (
±hªad_t
 
t1
,Öthªad_à
t2
)

72 
ªsu…
;

78 
ªsu…
 = ( 
t1
.
p
 =
t2
.∞&&Å1.
x
 ==Å2.x );

80  (
ªsu…
);

82 
	}
}

	@pthread_exit.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

48 
	$±hªad_exô
 (*
vÆue_±r
)

71 
±e_thªad_t
 * 
•
;

77 
•
 = (
±e_thªad_t
 *Ë
	`±hªad_gë•ecific
 (
±e_£lfThªadKey
);

79 i‡(
NULL
 =
•
)

90 
	`±e_osThªadExô
();

95 
•
->
exôSètus
 = 
vÆue_±r
;

97 
	`±e_throw
 (
PTE_EPS_EXIT
);

101 
	}
}

	@pthread_getconcurrency.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_gëc⁄cuºícy
 ()

50  
±e_c⁄cuºícy
;

51 
	}
}

	@pthread_getschedparam.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$±hªad_gësched∑øm
 (
±hªad_t
 
thªad
, *
pﬁicy
,

49 
sched_∑øm
 *
∑øm
)

51 
ªsu…
;

54 
ªsu…
 = 
	`±hªad_kûl
 (
thªad
, 0);

55 i‡(0 !
ªsu…
)

57  
ªsu…
;

64 i‡(
pﬁicy
 <(*Ë
SCHED_MAX
 || 
∑øm
 =
NULL
)

66  
EINVAL
;

70 *
pﬁicy
 = 
SCHED_OTHER
;

78 
∑øm
->
sched_¥i‹ôy
 = ((
±e_thªad_t
 *)
thªad
.
p
)->sched_priority;

81 
	}
}

	@pthread_getspecific.c

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

50 
	$±hªad_gë•ecific
 (
±hªad_key_t
 
key
)

74 * 
±r
;

76 i‡(
key
 =
NULL
)

78 
±r
 = 
NULL
;

82 
±r
 = 
	`±e_osTlsGëVÆue
 (
key
->key);

85  
±r
;

86 
	}
}

	@pthread_init.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

49 
	$±hªad_öô
()

52 i‡(
±e_¥o˚ssInôülized
)

61  
PTE_TRUE
;

64 
±e_¥o˚ssInôülized
 = 
PTE_TRUE
;

67 
	`±e_osInô
();

72 i‡((
	`±hªad_key_¸óã
 (&
±e_£lfThªadKey
, 
NULL
) != 0) ||

73 (
	`±hªad_key_¸óã
 (&
±e_˛ónupKey
, 
NULL
) != 0))

75 
	`±hªad_ãrmö©e
();

81 
	`±e_osMuãxCª©e
 (&
±e_thªad_ªu£_lock
);

82 
	`±e_osMuãxCª©e
 (&
±e_muãx_ã°_öô_lock
);

83 
	`±e_osMuãxCª©e
 (&
±e_c⁄d_li°_lock
);

84 
	`±e_osMuãxCª©e
 (&
±e_c⁄d_ã°_öô_lock
);

85 
	`±e_osMuãxCª©e
 (&
±e_rwlock_ã°_öô_lock
);

86 
	`±e_osMuãxCª©e
 (&
±e_•ölock_ã°_öô_lock
);

89  (
±e_¥o˚ssInôülized
);

91 
	}
}

	@pthread_join.c

44 
	~"nk/±e_oßl.h
"

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

52 
	$±hªad_joö
 (
±hªad_t
 
thªad
, **
vÆue_±r
)

86 
ªsu…
;

87 
±hªad_t
 
£lf
;

88 
±e_thªad_t
 * 
ç
 = (±e_thªad_à*Ë
thªad
.
p
;

91 
	`±e_osMuãxLock
 (
±e_thªad_ªu£_lock
);

93 i‡(
NULL
 =
ç


94 || 
thªad
.
x
 !
ç
->
±H™dÀ
.x)

96 
ªsu…
 = 
ESRCH
;

98 i‡(
PTHREAD_CREATE_DETACHED
 =
ç
->
dëachSèã
)

100 
ªsu…
 = 
EINVAL
;

104 
ªsu…
 = 0;

107 
	`±e_osMuãxU∆ock
(
±e_thªad_ªu£_lock
);

109 i‡(
ªsu…
 == 0)

114 
£lf
 = 
	`±hªad_£lf
();

116 i‡(
NULL
 =
£lf
.
p
)

118 
ªsu…
 = 
ENOENT
;

120 i‡(
	`±hªad_equÆ
 (
£lf
, 
thªad
))

122 
ªsu…
 = 
EDEADLK
;

134 
ªsu…
 = 
	`±e_osThªadWaôF‹End
(
ç
->
thªadId
);

136 i‡(
PTE_OS_OK
 =
ªsu…
)

138 i‡(
vÆue_±r
 !
NULL
)

140 *
vÆue_±r
 = 
ç
->
exôSètus
;

148 
ªsu…
 = 
	`±hªad_dëach
 (
thªad
);

150 i‡(
ªsu…
 =
PTE_OS_INTERRUPTED
)

153 
ªsu…
 = 0;

157 
ªsu…
 = 
ESRCH
;

162  (
ªsu…
);

164 
	}
}

	@pthread_key_create.c

44 
	~<«utûus/«utûus.h
>

45 
	~"nk/±e_oßl.h
"

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

52 
	$±hªad_key_¸óã
 (
±hªad_key_t
 * 
key
, (*
de°ru˘‹
) (*))

83 
ªsu…
 = 0;

84 
±hªad_key_t
 
√wkey
;

86 i‡((
√wkey
 = (
±hªad_key_t
Ë
	`ˇŒoc
 (1,  (*√wkey))Ë=
NULL
)

88 
ªsu…
 = 
ENOMEM
;

92 
±e_osResu…
 
osResu…
 = 
	`±e_osTlsAŒoc
(&(
√wkey
->
key
));

94 i‡(
osResu…
 !
PTE_OS_OK
)

96 
ªsu…
 = 
EAGAIN
;

98 
	`‰ì
 (
√wkey
);

99 
√wkey
 = 
NULL
;

101 i‡(
de°ru˘‹
 !
NULL
)

110 
√wkey
->
keyLock
 = 
PTHREAD_MUTEX_INITIALIZER
;

111 
√wkey
->
de°ru˘‹
 = destructor;

116 *
key
 = 
√wkey
;

118  (
ªsu…
);

119 
	}
}

	@pthread_key_delete.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

52 
	$±hªad_key_dñëe
 (
±hªad_key_t
 
key
)

79 
ªsu…
 = 0;

81 i‡(
key
 !
NULL
)

83 i‡(
key
->
thªads
 !
NULL
 &&

84 
key
->
de°ru˘‹
 !
NULL
 &&

85 
	`±hªad_muãx_lock
 (&(
key
->
keyLock
)) == 0)

87 
ThªadKeyAssoc
 *
assoc
;

96 (
assoc
 = (
ThªadKeyAssoc
 *Ë
key
->
thªads
Ë!
NULL
)

98 
±e_thªad_t
 * 
thªad
 = 
assoc
->thread;

100 i‡(
assoc
 =
NULL
)

106 i‡(
	`±hªad_muãx_lock
 (&(
thªad
->
thªadLock
)) == 0)

114 
	`±e_tkAssocDe°roy
 (
assoc
);

115 (Ë
	`±hªad_muãx_u∆ock
 (&(
thªad
->
thªadLock
));

120 
	`±e_tkAssocDe°roy
 (
assoc
);

123 
	`±hªad_muãx_u∆ock
 (&(
key
->
keyLock
));

126 
	`±e_osTlsFªe
 (
key
->key);

127 i‡(
key
->
de°ru˘‹
 !
NULL
)

130 
EBUSY
 =(
ªsu…
 = 
	`±hªad_muãx_de°roy
 (&(
key
->
keyLock
))))

132 
	`±e_osThªadSÀï
(1);

136 
	`‰ì
 (
key
);

139  (
ªsu…
);

140 
	}
}

	@pthread_kill.c

46 
	~<«utûus/«utûus.h
>

47 
	~<«utûus/«ut_°rög.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

52 
	$±hªad_kûl
 (
±hªad_t
 
thªad
, 
sig
)

81 
ªsu…
 = 0;

82 
±e_thªad_t
 * 
ç
;

85 
	`±e_osMuãxLock
 (
±e_thªad_ªu£_lock
);

87 
ç
 = (
±e_thªad_t
 *Ë
thªad
.
p
;

89 i‡(
NULL
 =
ç


90 || 
thªad
.
x
 !
ç
->
±H™dÀ
.x

91 || 0 =
ç
->
thªadId
)

93 
ªsu…
 = 
ESRCH
;

96 
	`±e_osMuãxU∆ock
(
±e_thªad_ªu£_lock
);

98 i‡(0 =
ªsu…
 && 0 !
sig
)

103 
ªsu…
 = 
EINVAL
;

106  
ªsu…
;

108 
	}
}

	@pthread_mutex_destroy.c

46 
	~<«utûus/«utûus.h
>

47 
	~<«utûus/«ut_°rög.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

53 
	$±hªad_muãx_de°roy
 (
±hªad_muãx_t
 * 
muãx
)

55 
ªsu…
 = 0;

56 
±hªad_muãx_t
 
mx
;

65 i‡(*
muãx
 < 
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
)

67 
mx
 = *
muãx
;

69 
ªsu…
 = 
	`±hªad_muãx_åylock
 (&
mx
);

75 i‡(
ªsu…
 == 0)

77 i‡(
mx
->
köd
 !
PTHREAD_MUTEX_RECURSIVE
 || 1 =mx->
ªcursive_cou¡
)

90 *
muãx
 = 
NULL
;

92 
ªsu…
 = 
	`±hªad_muãx_u∆ock
 (&
mx
);

94 i‡(
ªsu…
 == 0)

96 
	`±e_osSem≠h‹eDñëe
(
mx
->
h™dÀ
);

98 
	`‰ì
(
mx
);

106 *
muãx
 = 
mx
;

114 
mx
->
ªcursive_cou¡
--;

115 
ªsu…
 = 
EBUSY
;

125 
	`±e_osMuãxLock
 (
±e_muãx_ã°_öô_lock
);

131 i‡(*
muãx
 >
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
)

139 *
muãx
 = 
NULL
;

147 
ªsu…
 = 
EBUSY
;

150 
	`±e_osMuãxU∆ock
(
±e_muãx_ã°_öô_lock
);

154  (
ªsu…
);

155 
	}
}

	@pthread_mutex_init.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	#ERROR
(
fmt
, 
¨gs
...Ë
	`ERROR_PRINT
("emb±hªad: " fmt, ##¨gs)

	)

51 
	#DEBUG
(
fmt
, 
¨gs
...Ë
	`DEBUG_PRINT
("emb±hªad: " fmt, ##¨gs)

	)

52 
	#INFO
(
fmt
, 
¨gs
...Ë
	`INFO_PRINT
("emb±hªad: " fmt, ##¨gs)

	)

56 
	$±hªad_muãx_öô
 (
±hªad_muãx_t
 * 
muãx
, c⁄° 
±hªad_muãx©å_t
 * 
©å
)

58 
ªsu…
 = 0;

59 
±hªad_muãx_t
 
mx
;

62 i‡(
muãx
 =
NULL
)

64  
EINVAL
;

67 
mx
 = (
±hªad_muãx_t
Ë
	`ˇŒoc
 (1,  (*mx));

68 
	`mem£t
(
mx
, 0, 1*(*mx));

69 i‡(
mx
 =
NULL
)

71 
ªsu…
 = 
ENOMEM
;

75 
mx
->
lock_idx
 = 0;

76 
mx
->
ªcursive_cou¡
 = 0;

77 
	`DEBUG
("©åádd∏%08x\n", 
©å
);

78 
	`DEBUG
("©å köd %08x\n", *
©å
);

80 
mx
->
köd
 = 
PTHREAD_MUTEX_DEFAULT
;

83 ? 
PTHREAD_MUTEX_DEFAULT
 : (*
©å
)->
köd
);

84 
	`DEBUG
("pass mxkind\n");

85 
mx
->
ow√rThªad
.
p
 = 
NULL
;

87 
	`±e_osSem≠h‹eCª©e
(0,&
mx
->
h™dÀ
);

91 *
muãx
 = 
mx
;

93  (
ªsu…
);

94 
	}
}

	@pthread_mutex_lock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

51 
	$±hªad_muãx_lock
 (
±hªad_muãx_t
 * 
muãx
)

53 
ªsu…
 = 0;

54 
±hªad_muãx_t
 
mx
;

59 i‡(*
muãx
 =
NULL
)

61  
EINVAL
;

70 i‡(*
muãx
 >
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
)

72 i‡((
ªsu…
 = 
	`±e_muãx_check_√ed_öô
 (
muãx
)) != 0)

74  (
ªsu…
);

78 
mx
 = *
muãx
;

80 i‡(
mx
->
köd
 =
PTHREAD_MUTEX_NORMAL
)

82 i‡(
	`PTE_ATOMIC_EXCHANGE
(

83 &
mx
->
lock_idx
,

86 
	`PTE_ATOMIC_EXCHANGE
(&
mx
->
lock_idx
,-1) != 0)

88 i‡(
	`±e_osSem≠h‹ePíd
(
mx
->
h™dÀ
,
NULL
Ë!
PTE_OS_OK
)

90 
ªsu…
 = 
EINVAL
;

98 
±hªad_t
 
£lf
 = 
	`±hªad_£lf
();

100 i‡(
	`PTE_ATOMIC_COMPARE_EXCHANGE
(&
mx
->
lock_idx
,1,0) == 0)

102 
mx
->
ªcursive_cou¡
 = 1;

103 
mx
->
ow√rThªad
 = 
£lf
;

107 i‡(
	`±hªad_equÆ
 (
mx
->
ow√rThªad
, 
£lf
))

109 i‡(
mx
->
köd
 =
PTHREAD_MUTEX_RECURSIVE
)

111 
mx
->
ªcursive_cou¡
++;

115 
ªsu…
 = 
EDEADLK
;

120 
	`PTE_ATOMIC_EXCHANGE
(&
mx
->
lock_idx
,-1) != 0)

122 i‡(
	`±e_osSem≠h‹ePíd
(
mx
->
h™dÀ
,
NULL
Ë!
PTE_OS_OK
)

124 
ªsu…
 = 
EINVAL
;

129 i‡(0 =
ªsu…
)

131 
mx
->
ªcursive_cou¡
 = 1;

132 
mx
->
ow√rThªad
 = 
£lf
;

139  (
ªsu…
);

140 
	}
}

	@pthread_mutex_timedlock.c

43 
	~"nk/±e_oßl.h
"

47 
	~<«utûus/«utûus.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

53 
	$±e_timed_evítwaô
 (
±e_osSem≠h‹eH™dÀ
 
evít
, c⁄° 
time•ec
 *
ab°ime
)

77 
mûli£c⁄ds
;

78 
±e_osResu…
 
°©us
;

79 
ªtvÆ
;

81 i‡(
ab°ime
 =
NULL
)

83 
°©us
 = 
	`±e_osSem≠h‹ePíd
(
evít
, 
NULL
);

90 
mûli£c⁄ds
 = 
	`±e_ªlmûli£cs
 (
ab°ime
);

92 
°©us
 = 
	`±e_osSem≠h‹ePíd
(
evít
, &
mûli£c⁄ds
);

96 i‡(
°©us
 =
PTE_OS_TIMEOUT
)

98 
ªtvÆ
 = 
ETIMEDOUT
;

102 
ªtvÆ
 = 0;

105  
ªtvÆ
;

107 
	}
}

111 
	$±hªad_muãx_timedlock
 (
±hªad_muãx_t
 * 
muãx
,

112 c⁄° 
time•ec
 *
ab°ime
)

114 
ªsu…
;

115 
±hªad_muãx_t
 
mx
;

127 i‡(*
muãx
 >
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
)

129 i‡((
ªsu…
 = 
	`±e_muãx_check_√ed_öô
 (
muãx
)) != 0)

131  (
ªsu…
);

135 
mx
 = *
muãx
;

137 i‡(
mx
->
köd
 =
PTHREAD_MUTEX_NORMAL
)

139 i‡(
	`PTE_ATOMIC_EXCHANGE
(&
mx
->
lock_idx
,1) != 0)

141 
	`PTE_ATOMIC_EXCHANGE
(&
mx
->
lock_idx
,-1) != 0)

143 i‡(0 !(
ªsu…
 = 
	`±e_timed_evítwaô
 (
mx
->
h™dÀ
, 
ab°ime
)))

145  
ªsu…
;

152 
±hªad_t
 
£lf
 = 
	`±hªad_£lf
();

154 i‡(
	`PTE_ATOMIC_COMPARE_EXCHANGE
(&
mx
->
lock_idx
,1,0) == 0)

156 
mx
->
ªcursive_cou¡
 = 1;

157 
mx
->
ow√rThªad
 = 
£lf
;

161 i‡(
	`±hªad_equÆ
 (
mx
->
ow√rThªad
, 
£lf
))

163 i‡(
mx
->
köd
 =
PTHREAD_MUTEX_RECURSIVE
)

165 
mx
->
ªcursive_cou¡
++;

169  
EDEADLK
;

174 
	`PTE_ATOMIC_EXCHANGE
(&
mx
->
lock_idx
,-1) != 0)

176 i‡(0 !(
ªsu…
 = 
	`±e_timed_evítwaô
 (
mx
->
h™dÀ
, 
ab°ime
)))

178  
ªsu…
;

182 
mx
->
ªcursive_cou¡
 = 1;

183 
mx
->
ow√rThªad
 = 
£lf
;

189 
	}
}

	@pthread_mutex_trylock.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_muãx_åylock
 (
±hªad_muãx_t
 * 
muãx
)

50 
ªsu…
 = 0;

51 
±hªad_muãx_t
 
mx
;

63 i‡(*
muãx
 >
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
)

65 i‡((
ªsu…
 = 
	`±e_muãx_check_√ed_öô
 (
muãx
)) != 0)

67  (
ªsu…
);

71 
mx
 = *
muãx
;

73 i‡(0 =
	`PTE_ATOMIC_COMPARE_EXCHANGE
 (&
mx
->
lock_idx
,1,0))

75 i‡(
mx
->
köd
 !
PTHREAD_MUTEX_NORMAL
)

77 
mx
->
ªcursive_cou¡
 = 1;

78 
mx
->
ow√rThªad
 = 
	`±hªad_£lf
 ();

83 i‡(
mx
->
köd
 =
PTHREAD_MUTEX_RECURSIVE
 &&

84 
	`±hªad_equÆ
 (
mx
->
ow√rThªad
, 
	`±hªad_£lf
 ()))

86 
mx
->
ªcursive_cou¡
++;

90 
ªsu…
 = 
EBUSY
;

94  (
ªsu…
);

95 
	}
}

	@pthread_mutex_unlock.c

43 
	~"nk/±e_oßl.h
"

47 
	~<«utûus/«utûus.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

52 
	#TEST_IE
 
I¡îlockedExch™ge


	)

55 
	$±hªad_muãx_u∆ock
 (
±hªad_muãx_t
 * 
muãx
)

57 
ªsu…
 = 0;

58 
±hªad_muãx_t
 
mx
;

64 
mx
 = *
muãx
;

71 i‡(
mx
 < 
PTHREAD_ERRORCHECK_MUTEX_INITIALIZER
)

73 i‡(
mx
->
köd
 =
PTHREAD_MUTEX_NORMAL
)

75 
idx
;

77 
idx
 = 
	`PTE_ATOMIC_EXCHANGE
 (&
mx
->
lock_idx
,0);

78 i‡(
idx
 != 0)

80 i‡(
idx
 < 0)

85 i‡(
	`±e_osSem≠h‹ePo°
(
mx
->
h™dÀ
,1Ë!
PTE_OS_OK
)

87 
ªsu…
 = 
EINVAL
;

96 
ªsu…
 = 
EPERM
;

101 i‡(
	`±hªad_equÆ
 (
mx
->
ow√rThªad
, 
	`±hªad_£lf
 ()))

103 i‡(
mx
->
köd
 !
PTHREAD_MUTEX_RECURSIVE


104 || 0 =--
mx
->
ªcursive_cou¡
)

106 
mx
->
ow√rThªad
.
p
 = 
NULL
;

108 i‡(
	`PTE_ATOMIC_EXCHANGE
 (&
mx
->
lock_idx
,0) < 0)

110 i‡(
	`±e_osSem≠h‹ePo°
(
mx
->
h™dÀ
,1Ë!
PTE_OS_OK
)

112 
ªsu…
 = 
EINVAL
;

120 
ªsu…
 = 
EPERM
;

126 
ªsu…
 = 
EINVAL
;

129  (
ªsu…
);

130 
	}
}

	@pthread_mutexattr_destroy.c

44 
	~<«utûus/«utûus.h
>

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

50 
	$±hªad_muãx©å_de°roy
 (
±hªad_muãx©å_t
 * 
©å
)

76 
ªsu…
 = 0;

78 i‡(
©å
 =
NULL
 || *attr == NULL)

80 
ªsu…
 = 
EINVAL
;

84 
±hªad_muãx©å_t
 
ma
 = *
©å
;

86 *
©å
 = 
NULL
;

87 
	`‰ì
 (
ma
);

90  (
ªsu…
);

91 
	}
}

	@pthread_mutexattr_getkind_np.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

47 
	$±hªad_muãx©å_gëköd_≈
 (
±hªad_muãx©å_t
 * 
©å
, *
köd
)

49  
	`±hªad_muãx©å_gëty≥
 (
©å
, 
köd
);

50 
	}
}

	@pthread_mutexattr_getpshared.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_muãx©å_gëpsh¨ed
 (c⁄° 
±hªad_muãx©å_t
 * 
©å
, *
psh¨ed
)

87 
ªsu…
;

89 i‡((
©å
 !
NULL
 && *©å !NULLË&& (
psh¨ed
 != NULL))

91 *
psh¨ed
 = (*
©å
)->pshared;

92 
ªsu…
 = 0;

96 
ªsu…
 = 
EINVAL
;

99  (
ªsu…
);

101 
	}
}

	@pthread_mutexattr_gettype.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_muãx©å_gëty≥
 (
±hªad_muãx©å_t
 * 
©å
, *
köd
)

50 
ªsu…
 = 0;

52 i‡(
©å
 !
NULL
 && *©å !NULL && 
köd
 != NULL)

54 *
köd
 = (*
©å
)->kind;

58 
ªsu…
 = 
EINVAL
;

61  (
ªsu…
);

62 
	}
}

	@pthread_mutexattr_init.c

44 
	~<«utûus/«utûus.h
>

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

50 
	$±hªad_muãx©å_öô
 (
±hªad_muãx©å_t
 * 
©å
)

76 
ªsu…
 = 0;

77 
±hªad_muãx©å_t
 
ma
;

79 
ma
 = (
±hªad_muãx©å_t
Ë
	`ˇŒoc
 (1,  (*ma));

81 i‡(
ma
 =
NULL
)

83 
ªsu…
 = 
ENOMEM
;

87 
ma
->
psh¨ed
 = 
PTHREAD_PROCESS_PRIVATE
;

88 
ma
->
köd
 = 
PTHREAD_MUTEX_DEFAULT
;

91 *
©å
 = 
ma
;

93  (
ªsu…
);

94 
	}
}

	@pthread_mutexattr_setkind_np.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

47 
	$±hªad_muãx©å_£tköd_≈
 (
±hªad_muãx©å_t
 * 
©å
, 
köd
)

49  
	`±hªad_muãx©å_£ây≥
 (
©å
, 
köd
);

50 
	}
}

	@pthread_mutexattr_setpshared.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_muãx©å_£çsh¨ed
 (
±hªad_muãx©å_t
 * 
©å
, 
psh¨ed
)

90 
ªsu…
;

92 i‡((
©å
 !
NULL
 && *attr != NULL) &&

93 ((
psh¨ed
 =
PTHREAD_PROCESS_SHARED
) ||

94 (
psh¨ed
 =
PTHREAD_PROCESS_PRIVATE
)))

96 i‡(
psh¨ed
 =
PTHREAD_PROCESS_SHARED
)

99 #i‡!
	`deföed
–
_POSIX_THREAD_PROCESS_SHARED
 )

101 
ªsu…
 = 
ENOSYS
;

102 
psh¨ed
 = 
PTHREAD_PROCESS_PRIVATE
;

106 
ªsu…
 = 0;

113 
ªsu…
 = 0;

116 (*
©å
)->
psh¨ed
 =Öshared;

120 
ªsu…
 = 
EINVAL
;

123  (
ªsu…
);

125 
	}
}

	@pthread_mutexattr_settype.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_muãx©å_£ây≥
 (
±hªad_muãx©å_t
 * 
©å
, 
köd
)

127 
ªsu…
 = 0;

129 i‡((
©å
 !
NULL
 && *attr != NULL))

131 
köd
)

133 
PTHREAD_MUTEX_FAST_NP
:

134 
PTHREAD_MUTEX_RECURSIVE_NP
:

135 
PTHREAD_MUTEX_ERRORCHECK_NP
:

136 (*
©å
)->
köd
 = kind;

139 
ªsu…
 = 
EINVAL
;

145 
ªsu…
 = 
EINVAL
;

148  (
ªsu…
);

149 
	}
}

	@pthread_num_processors_np.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

52 
	$±hªad_num_¥o˚ss‹s_≈
 ()

54 
cou¡
;

56 i‡(
	`±e_gë¥o˚ss‹s
 (&
cou¡
) != 0)

58 
cou¡
 = 1;

61  (
cou¡
);

62 
	}
}

	@pthread_once.c

43 
	~"nk/±e_oßl.h
"

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

47 
	#PTE_ONCE_STARTED
 1

	)

48 
	#PTE_ONCE_INIT
 0

	)

49 
	#PTE_ONCE_DONE
 2

	)

52 
	$±e_⁄˚_öô_routöe_˛ónup
(* 
¨g
)

54 
±hªad_⁄˚_t
 * 
⁄˚_c⁄åﬁ
 = (±hªad_⁄˚_à*Ë
¨g
;

56 (Ë
	`PTE_ATOMIC_EXCHANGE
(&
⁄˚_c⁄åﬁ
->
°©e
,
PTE_ONCE_INIT
);

58 i‡(
	`PTE_ATOMIC_EXCHANGE_ADD
((*)&
⁄˚_c⁄åﬁ
->
£m≠h‹e
, 0L))

60 
	`±e_osSem≠h‹ePo°
((
±e_osSem≠h‹eH™dÀ
Ë
⁄˚_c⁄åﬁ
->
£m≠h‹e
, 1);

62 
	}
}

65 
	$±hªad_⁄˚
 (
±hªad_⁄˚_t
 * 
⁄˚_c⁄åﬁ
, (*
öô_routöe
) ())

103 
ªsu…
;

104 
°©e
;

105 
±e_osSem≠h‹eH™dÀ
 
£ma
;

107 i‡(
⁄˚_c⁄åﬁ
 =
NULL
 || 
öô_routöe
 == NULL)

109 
ªsu…
 = 
EINVAL
;

110 
FAIL0
;

114 
ªsu…
 = 0;

117 (
°©e
 =

118 
	`PTE_ATOMIC_COMPARE_EXCHANGE
(&
⁄˚_c⁄åﬁ
->
°©e
,

119 
PTE_ONCE_STARTED
,

120 
PTE_ONCE_INIT
))

121 !
PTE_ONCE_DONE
)

123 i‡(
PTE_ONCE_INIT
 =
°©e
)

127 
	`±hªad_˛ónup_push
(
±e_⁄˚_öô_routöe_˛ónup
, (*Ë
⁄˚_c⁄åﬁ
);

128 (*
öô_routöe
)();

129 
	`±hªad_˛ónup_p›
(0);

131 (Ë
	`PTE_ATOMIC_EXCHANGE
(&
⁄˚_c⁄åﬁ
->
°©e
,
PTE_ONCE_DONE
);

137 i‡(
	`PTE_ATOMIC_EXCHANGE_ADD
((*)&
⁄˚_c⁄åﬁ
->
£m≠h‹e
, 0L))

139 
	`±e_osSem≠h‹ePo°
((
±e_osSem≠h‹eH™dÀ
Ë
⁄˚_c⁄åﬁ
->
£m≠h‹e
,⁄˚_c⁄åﬁ->
numSem≠h‹eU£rs
);

144 
	`PTE_ATOMIC_INCREMENT
(&
⁄˚_c⁄åﬁ
->
numSem≠h‹eU£rs
);

146 i‡(!
	`PTE_ATOMIC_EXCHANGE_ADD
((*)&
⁄˚_c⁄åﬁ
->
£m≠h‹e
, 0L))

148 
	`±e_osSem≠h‹eCª©e
(0, (
±e_osSem≠h‹eH™dÀ
*Ë&
£ma
);

150 i‡(
	`PTE_ATOMIC_COMPARE_EXCHANGE
((*Ë&
⁄˚_c⁄åﬁ
->
£m≠h‹e
,

151 (Ë
£ma
,

154 
	`±e_osSem≠h‹eDñëe
((
±e_osSem≠h‹eH™dÀ
)
£ma
);

162 i‡(
	`PTE_ATOMIC_EXCHANGE_ADD
(&
⁄˚_c⁄åﬁ
->
°©e
, 0LË=
PTE_ONCE_STARTED
)

164 
	`±e_osSem≠h‹ePíd
((
±e_osSem≠h‹eH™dÀ
Ë
⁄˚_c⁄åﬁ
->
£m≠h‹e
,
NULL
);

167 i‡(0 =
	`PTE_ATOMIC_DECREMENT
(&
⁄˚_c⁄åﬁ
->
numSem≠h‹eU£rs
))

170 i‡((
£ma
 =

171 (
±e_osSem≠h‹eH™dÀ
Ë
	`PTE_ATOMIC_EXCHANGE
((*Ë&
⁄˚_c⁄åﬁ
->
£m≠h‹e
,0)))

173 
	`±e_osSem≠h‹eDñëe
(
£ma
);

184 
FAIL0
:

185  (
ªsu…
);

186 
	}
}

	@pthread_rwlock_destroy.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

51 
	$±hªad_rwlock_de°roy
 (
±hªad_rwlock_t
 * 
rwlock
)

53 
±hªad_rwlock_t
 
rwl
;

54 
ªsu…
 = 0, 
ªsu…1
 = 0, 
ªsu…2
 = 0;

56 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

58  
EINVAL
;

61 i‡(*
rwlock
 !
PTHREAD_RWLOCK_INITIALIZER
)

63 
rwl
 = *
rwlock
;

65 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

67  
EINVAL
;

70 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
))) != 0)

72  
ªsu…
;

75 i‡((
ªsu…
 =

76 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

78 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

79  
ªsu…
;

86 i‡(
rwl
->
nEx˛usiveAc˚ssCou¡
 > 0

87 || 
rwl
->
nSh¨edAc˚ssCou¡
 >Ñwl->
nCom∂ëedSh¨edAc˚ssCou¡
)

89 
ªsu…
 = 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
));

90 
ªsu…1
 = 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

91 
ªsu…2
 = 
EBUSY
;

95 
rwl
->
nMagic
 = 0;

97 i‡((
ªsu…
 =

98 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

100 
	`±hªad_muãx_u∆ock
 (&
rwl
->
mtxEx˛usiveAc˚ss
);

101  
ªsu…
;

104 i‡((
ªsu…
 =

105 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
))) != 0)

107  
ªsu…
;

110 *
rwlock
 = 
NULL
;

111 
ªsu…
 = 
	`±hªad_c⁄d_de°roy
 (&(
rwl
->
˙dSh¨edAc˚ssCom∂ëed
));

112 
ªsu…1
 = 
	`±hªad_muãx_de°roy
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
));

113 
ªsu…2
 = 
	`±hªad_muãx_de°roy
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

114 
	`‰ì
 (
rwl
);

123 
	`±e_osMuãxLock
 (
±e_rwlock_ã°_öô_lock
);

128 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

136 *
rwlock
 = 
NULL
;

144 
ªsu…
 = 
EBUSY
;

147 
	`±e_osMuãxU∆ock
(
±e_rwlock_ã°_öô_lock
);

151  ((
ªsu…
 !0Ë?Ñesu… : ((
ªsu…1
 !0Ë?Ñesu…1 : 
ªsu…2
));

152 
	}
}

	@pthread_rwlock_init.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

51 
	$±hªad_rwlock_öô
 (
±hªad_rwlock_t
 * 
rwlock
,

52 c⁄° 
±hªad_rwlock©å_t
 * 
©å
)

54 
ªsu…
;

55 
±hªad_rwlock_t
 
rwl
 = 0;

57 i‡(
rwlock
 =
NULL
)

59  
EINVAL
;

62 i‡(
©å
 !
NULL
 && *attr != NULL)

64 
ªsu…
 = 
EINVAL
;

65 
DONE
;

68 
rwl
 = (
±hªad_rwlock_t
Ë
	`ˇŒoc
 (1,  (*rwl));

70 i‡(
rwl
 =
NULL
)

72 
ªsu…
 = 
ENOMEM
;

73 
DONE
;

76 
rwl
->
nSh¨edAc˚ssCou¡
 = 0;

77 
rwl
->
nEx˛usiveAc˚ssCou¡
 = 0;

78 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

80 
ªsu…
 = 
	`±hªad_muãx_öô
 (&
rwl
->
mtxEx˛usiveAc˚ss
, 
NULL
);

81 i‡(
ªsu…
 != 0)

83 
FAIL0
;

86 
ªsu…
 = 
	`±hªad_muãx_öô
 (&
rwl
->
mtxSh¨edAc˚ssCom∂ëed
, 
NULL
);

87 i‡(
ªsu…
 != 0)

89 
FAIL1
;

92 
ªsu…
 = 
	`±hªad_c⁄d_öô
 (&
rwl
->
˙dSh¨edAc˚ssCom∂ëed
, 
NULL
);

93 i‡(
ªsu…
 != 0)

95 
FAIL2
;

98 
rwl
->
nMagic
 = 
PTE_RWLOCK_MAGIC
;

100 
ªsu…
 = 0;

101 
DONE
;

103 
FAIL2
:

104 (Ë
	`±hªad_muãx_de°roy
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
));

106 
FAIL1
:

107 (Ë
	`±hªad_muãx_de°roy
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

109 
FAIL0
:

110 
	`‰ì
(
rwl
)

112 
rwl
 = 
NULL
;

114 
DONE
:

115 *
rwlock
 = 
rwl
;

117  
ªsu…
;

118 
	}
}

	@pthread_rwlock_rdlock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock_rdlock
 (
±hªad_rwlock_t
 * 
rwlock
)

52 
ªsu…
;

53 
±hªad_rwlock_t
 
rwl
;

55 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

57  
EINVAL
;

66 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

68 
ªsu…
 = 
	`±e_rwlock_check_√ed_öô
 (
rwlock
);

70 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
)

72  
ªsu…
;

76 
rwl
 = *
rwlock
;

78 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

80  
EINVAL
;

83 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
))) != 0)

85  
ªsu…
;

88 i‡(++
rwl
->
nSh¨edAc˚ssCou¡
 =
INT_MAX
)

90 i‡((
ªsu…
 =

91 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

93 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

94  
ªsu…
;

97 
rwl
->
nSh¨edAc˚ssCou¡
 -rwl->
nCom∂ëedSh¨edAc˚ssCou¡
;

98 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

100 i‡((
ªsu…
 =

101 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

103 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

104  
ªsu…
;

108  (
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
)));

109 
	}
}

	@pthread_rwlock_timedrdlock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock_timedrdlock
 (
±hªad_rwlock_t
 * 
rwlock
,

51 c⁄° 
time•ec
 *
ab°ime
)

53 
ªsu…
;

54 
±hªad_rwlock_t
 
rwl
;

56 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

58  
EINVAL
;

67 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

69 
ªsu…
 = 
	`±e_rwlock_check_√ed_öô
 (
rwlock
);

71 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
)

73  
ªsu…
;

77 
rwl
 = *
rwlock
;

79 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

81  
EINVAL
;

84 i‡((
ªsu…
 =

85 
	`±hªad_muãx_timedlock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
), 
ab°ime
)) != 0)

87  
ªsu…
;

90 i‡(++
rwl
->
nSh¨edAc˚ssCou¡
 =
INT_MAX
)

92 i‡((
ªsu…
 =

93 
	`±hªad_muãx_timedlock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
),

94 
ab°ime
)) != 0)

96 i‡(
ªsu…
 =
ETIMEDOUT
)

98 ++
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
;

100 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

101  
ªsu…
;

104 
rwl
->
nSh¨edAc˚ssCou¡
 -rwl->
nCom∂ëedSh¨edAc˚ssCou¡
;

105 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

107 i‡((
ªsu…
 =

108 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

110 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

111  
ªsu…
;

115  (
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
)));

116 
	}
}

	@pthread_rwlock_timedwrlock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock_timedwæock
 (
±hªad_rwlock_t
 * 
rwlock
,

51 c⁄° 
time•ec
 *
ab°ime
)

53 
ªsu…
;

54 
±hªad_rwlock_t
 
rwl
;

56 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

58  
EINVAL
;

67 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

69 
ªsu…
 = 
	`±e_rwlock_check_√ed_öô
 (
rwlock
);

71 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
)

73  
ªsu…
;

77 
rwl
 = *
rwlock
;

79 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

81  
EINVAL
;

84 i‡((
ªsu…
 =

85 
	`±hªad_muãx_timedlock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
), 
ab°ime
)) != 0)

87  
ªsu…
;

90 i‡((
ªsu…
 =

91 
	`±hªad_muãx_timedlock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
),

92 
ab°ime
)) != 0)

94 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

95  
ªsu…
;

98 i‡(
rwl
->
nEx˛usiveAc˚ssCou¡
 == 0)

100 i‡(
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 > 0)

102 
rwl
->
nSh¨edAc˚ssCou¡
 -rwl->
nCom∂ëedSh¨edAc˚ssCou¡
;

103 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

106 i‡(
rwl
->
nSh¨edAc˚ssCou¡
 > 0)

108 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = -rwl->
nSh¨edAc˚ssCou¡
;

114 
	`±hªad_˛ónup_push
 (
±e_rwlock_ˇn˚lwrwaô
, (*Ë
rwl
);

118 
ªsu…
 =

119 
	`±hªad_c⁄d_timedwaô
 (&(
rwl
->
˙dSh¨edAc˚ssCom∂ëed
),

120 &(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
),

121 
ab°ime
);

123 
ªsu…
 =0 && 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 < 0);

125 
	`±hªad_˛ónup_p›
 ((
ªsu…
 != 0) ? 1 : 0);

127 i‡(
ªsu…
 == 0)

129 
rwl
->
nSh¨edAc˚ssCou¡
 = 0;

134 i‡(
ªsu…
 == 0)

136 
rwl
->
nEx˛usiveAc˚ssCou¡
++;

139  
ªsu…
;

140 
	}
}

	@pthread_rwlock_tryrdlock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock_åyrdlock
 (
±hªad_rwlock_t
 * 
rwlock
)

52 
ªsu…
;

53 
±hªad_rwlock_t
 
rwl
;

55 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

57  
EINVAL
;

66 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

68 
ªsu…
 = 
	`±e_rwlock_check_√ed_öô
 (
rwlock
);

70 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
)

72  
ªsu…
;

76 
rwl
 = *
rwlock
;

78 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

80  
EINVAL
;

83 i‡((
ªsu…
 = 
	`±hªad_muãx_åylock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
))) != 0)

85  
ªsu…
;

88 i‡(++
rwl
->
nSh¨edAc˚ssCou¡
 =
INT_MAX
)

90 i‡((
ªsu…
 =

91 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

93 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

94  
ªsu…
;

97 
rwl
->
nSh¨edAc˚ssCou¡
 -rwl->
nCom∂ëedSh¨edAc˚ssCou¡
;

98 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

100 i‡((
ªsu…
 =

101 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

103 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

104  
ªsu…
;

108  (
	`±hªad_muãx_u∆ock
 (&
rwl
->
mtxEx˛usiveAc˚ss
));

109 
	}
}

	@pthread_rwlock_trywrlock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock_åywæock
 (
±hªad_rwlock_t
 * 
rwlock
)

52 
ªsu…
, 
ªsu…1
;

53 
±hªad_rwlock_t
 
rwl
;

55 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

57  
EINVAL
;

66 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

68 
ªsu…
 = 
	`±e_rwlock_check_√ed_öô
 (
rwlock
);

70 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
)

72  
ªsu…
;

76 
rwl
 = *
rwlock
;

78 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

80  
EINVAL
;

83 i‡((
ªsu…
 = 
	`±hªad_muãx_åylock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
))) != 0)

85  
ªsu…
;

88 i‡((
ªsu…
 =

89 
	`±hªad_muãx_åylock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

91 
ªsu…1
 = 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

92  ((
ªsu…1
 !0Ë?Ñesu…1 : 
ªsu…
);

95 i‡(
rwl
->
nEx˛usiveAc˚ssCou¡
 == 0)

97 i‡(
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 > 0)

99 
rwl
->
nSh¨edAc˚ssCou¡
 -rwl->
nCom∂ëedSh¨edAc˚ssCou¡
;

100 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

103 i‡(
rwl
->
nSh¨edAc˚ssCou¡
 > 0)

105 i‡((
ªsu…
 =

106 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

108 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

109  
ªsu…
;

112 i‡((
ªsu…
 =

113 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
))) == 0)

115 
ªsu…
 = 
EBUSY
;

120 
rwl
->
nEx˛usiveAc˚ssCou¡
 = 1;

125 
ªsu…
 = 
EBUSY
;

128  
ªsu…
;

129 
	}
}

	@pthread_rwlock_unlock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock_u∆ock
 (
±hªad_rwlock_t
 * 
rwlock
)

52 
ªsu…
, 
ªsu…1
;

53 
±hªad_rwlock_t
 
rwl
;

55 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

57  (
EINVAL
);

60 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

68 
rwl
 = *
rwlock
;

70 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

72  
EINVAL
;

75 i‡(
rwl
->
nEx˛usiveAc˚ssCou¡
 == 0)

77 i‡((
ªsu…
 =

78 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

80  
ªsu…
;

83 i‡(++
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 == 0)

85 
ªsu…
 = 
	`±hªad_c⁄d_sig«l
 (&(
rwl
->
˙dSh¨edAc˚ssCom∂ëed
));

88 
ªsu…1
 = 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
));

92 
rwl
->
nEx˛usiveAc˚ssCou¡
--;

94 
ªsu…
 = 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
));

95 
ªsu…1
 = 
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

99  ((
ªsu…
 !0Ë?Ñesu… : 
ªsu…1
);

100 
	}
}

	@pthread_rwlock_wrlock.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock_wæock
 (
±hªad_rwlock_t
 * 
rwlock
)

52 
ªsu…
;

53 
±hªad_rwlock_t
 
rwl
;

55 i‡(
rwlock
 =
NULL
 || *rwlock == NULL)

57  
EINVAL
;

66 i‡(*
rwlock
 =
PTHREAD_RWLOCK_INITIALIZER
)

68 
ªsu…
 = 
	`±e_rwlock_check_√ed_öô
 (
rwlock
);

70 i‡(
ªsu…
 !0 &&Ñesu… !
EBUSY
)

72  
ªsu…
;

76 
rwl
 = *
rwlock
;

78 i‡(
rwl
->
nMagic
 !
PTE_RWLOCK_MAGIC
)

80  
EINVAL
;

83 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
))) != 0)

85  
ªsu…
;

88 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
))) != 0)

90 (Ë
	`±hªad_muãx_u∆ock
 (&(
rwl
->
mtxEx˛usiveAc˚ss
));

91  
ªsu…
;

94 i‡(
rwl
->
nEx˛usiveAc˚ssCou¡
 == 0)

96 i‡(
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 > 0)

98 
rwl
->
nSh¨edAc˚ssCou¡
 -rwl->
nCom∂ëedSh¨edAc˚ssCou¡
;

99 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = 0;

102 i‡(
rwl
->
nSh¨edAc˚ssCou¡
 > 0)

104 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 = -rwl->
nSh¨edAc˚ssCou¡
;

110 
	`±hªad_˛ónup_push
 (
±e_rwlock_ˇn˚lwrwaô
, (*Ë
rwl
);

114 
ªsu…
 = 
	`±hªad_c⁄d_waô
 (&(
rwl
->
˙dSh¨edAc˚ssCom∂ëed
),

115 &(
rwl
->
mtxSh¨edAc˚ssCom∂ëed
));

117 
ªsu…
 =0 && 
rwl
->
nCom∂ëedSh¨edAc˚ssCou¡
 < 0);

119 
	`±hªad_˛ónup_p›
 ((
ªsu…
 != 0) ? 1 : 0);

121 i‡(
ªsu…
 == 0)

123 
rwl
->
nSh¨edAc˚ssCou¡
 = 0;

128 i‡(
ªsu…
 == 0)

130 
rwl
->
nEx˛usiveAc˚ssCou¡
++;

133  
ªsu…
;

134 
	}
}

	@pthread_rwlockattr_destroy.c

46 
	~<«utûus/«utûus.h
>

47 
	~<«utûus/«ut_°rög.h
>

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

52 
	$±hªad_rwlock©å_de°roy
 (
±hªad_rwlock©å_t
 * 
©å
)

78 
ªsu…
 = 0;

80 i‡(
©å
 =
NULL
 || *attr == NULL)

82 
ªsu…
 = 
EINVAL
;

86 
±hªad_rwlock©å_t
 
rwa
 = *
©å
;

88 *
©å
 = 
NULL
;

89 
	`‰ì
 (
rwa
);

92  (
ªsu…
);

93 
	}
}

	@pthread_rwlockattr_getpshared.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock©å_gëpsh¨ed
 (c⁄° 
±hªad_rwlock©å_t
 * 
©å
,

51 *
psh¨ed
)

90 
ªsu…
;

92 i‡((
©å
 !
NULL
 && *©å !NULLË&& (
psh¨ed
 != NULL))

94 *
psh¨ed
 = (*
©å
)->pshared;

95 
ªsu…
 = 0;

99 
ªsu…
 = 
EINVAL
;

102  (
ªsu…
);

104 
	}
}

	@pthread_rwlockattr_init.c

46 
	~<«utûus/«utûus.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

51 
	$±hªad_rwlock©å_öô
 (
±hªad_rwlock©å_t
 * 
©å
)

74 
ªsu…
 = 0;

75 
±hªad_rwlock©å_t
 
rwa
;

77 
rwa
 = (
±hªad_rwlock©å_t
Ë
	`ˇŒoc
 (1,  (*rwa));

79 i‡(
rwa
 =
NULL
)

81 
ªsu…
 = 
ENOMEM
;

85 
rwa
->
psh¨ed
 = 
PTHREAD_PROCESS_PRIVATE
;

88 *
©å
 = 
rwa
;

90  (
ªsu…
);

91 
	}
}

	@pthread_rwlockattr_setpshared.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

50 
	$±hªad_rwlock©å_£çsh¨ed
 (
±hªad_rwlock©å_t
 * 
©å
, 
psh¨ed
)

92 
ªsu…
;

94 i‡((
©å
 !
NULL
 && *attr != NULL) &&

95 ((
psh¨ed
 =
PTHREAD_PROCESS_SHARED
) ||

96 (
psh¨ed
 =
PTHREAD_PROCESS_PRIVATE
)))

98 i‡(
psh¨ed
 =
PTHREAD_PROCESS_SHARED
)

101 #i‡!
	`deföed
–
_POSIX_THREAD_PROCESS_SHARED
 )

103 
ªsu…
 = 
ENOSYS
;

104 
psh¨ed
 = 
PTHREAD_PROCESS_PRIVATE
;

108 
ªsu…
 = 0;

115 
ªsu…
 = 0;

118 (*
©å
)->
psh¨ed
 =Öshared;

122 
ªsu…
 = 
EINVAL
;

125  (
ªsu…
);

127 
	}
}

	@pthread_self.c

45 
	~<«utûus/«utûus.h
>

46 
	~"±hªad.h
"

47 
	~"im∂emít.h
"

49 
±hªad_t


50 
	$±hªad_£lf
 ()

71 
±hªad_t
 
£lf
;

72 
±e_thªad_t
 * 
•
;

74 
•
 = (
±e_thªad_t
 *Ë
	`±hªad_gë•ecific
 (
±e_£lfThªadKey
);

76 i‡(
•
 !
NULL
)

78 
£lf
 = 
•
->
±H™dÀ
;

90 
£lf
 = 
	`±e_√w
 ();

91 
•
 = (
±e_thªad_t
 *Ë
£lf
.
p
;

93 i‡(
•
 !
NULL
)

101 
•
->
im∂icô
 = 1;

102 
•
->
dëachSèã
 = 
PTHREAD_CREATE_DETACHED
;

104 
•
->
thªadId
 = 
	`±e_osThªadGëH™dÀ
();

109 
•
->
sched_¥i‹ôy
 = 0;

111 
	`±hªad_£t•ecific
 (
±e_£lfThªadKey
, (*Ë
•
);

115  (
£lf
);

117 
	}
}

	@pthread_setcancelstate.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_£tˇn˚l°©e
 (
°©e
, *
ﬁd°©e
)

88 
ªsu…
 = 0;

89 
±hªad_t
 
£lf
 = 
	`±hªad_£lf
 ();

90 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
£lf
.
p
;

92 i‡(
•
 =
NULL


93 || (
°©e
 !
PTHREAD_CANCEL_ENABLE
 && sèã !
PTHREAD_CANCEL_DISABLE
))

95  
EINVAL
;

101 (Ë
	`±hªad_muãx_lock
 (&
•
->
ˇn˚lLock
);

103 i‡(
ﬁd°©e
 !
NULL
)

105 *
ﬁd°©e
 = 
•
->
ˇn˚lSèã
;

108 
•
->
ˇn˚lSèã
 = 
°©e
;

113 i‡(
°©e
 =
PTHREAD_CANCEL_ENABLE


114 && (
•
->
ˇn˚lTy≥
 =
PTHREAD_CANCEL_ASYNCHRONOUS
)

115 && (
	`±e_osThªadCheckC™˚l
(
•
->
thªadId
Ë=
PTE_OS_INTERRUPTED
) )

117 
•
->
°©e
 = 
PThªadSèãC™˚lög
;

118 
•
->
ˇn˚lSèã
 = 
PTHREAD_CANCEL_DISABLE
;

119 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

120 
	`±e_throw
 (
PTE_EPS_CANCEL
);

125 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

127  (
ªsu…
);

129 
	}
}

	@pthread_setcanceltype.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_£tˇn˚…y≥
 (
ty≥
, *
ﬁdty≥
)

89 
ªsu…
 = 0;

90 
±hªad_t
 
£lf
 = 
	`±hªad_£lf
 ();

91 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
£lf
.
p
;

93 #i‚de‡
PTE_SUPPORT_ASYNC_CANCEL


94 i‡(
ty≥
 =
PTHREAD_CANCEL_ASYNCHRONOUS
)

99  
EPERM
;

103 i‡(
•
 =
NULL


104 || (
ty≥
 !
PTHREAD_CANCEL_DEFERRED


105 && 
ty≥
 !
PTHREAD_CANCEL_ASYNCHRONOUS
))

107  
EINVAL
;

113 (Ë
	`±hªad_muãx_lock
 (&
•
->
ˇn˚lLock
);

115 i‡(
ﬁdty≥
 !
NULL
)

117 *
ﬁdty≥
 = 
•
->
ˇn˚lTy≥
;

120 
•
->
ˇn˚lTy≥
 = 
ty≥
;

126 i‡(
•
->
ˇn˚lSèã
 =
PTHREAD_CANCEL_ENABLE


127 && (
ty≥
 =
PTHREAD_CANCEL_ASYNCHRONOUS
)

128 && (
	`±e_osThªadCheckC™˚l
(
•
->
thªadId
Ë=
PTE_OS_INTERRUPTED
) )

130 
•
->
°©e
 = 
PThªadSèãC™˚lög
;

131 
•
->
ˇn˚lSèã
 = 
PTHREAD_CANCEL_DISABLE
;

132 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

133 
	`±e_throw
 (
PTE_EPS_CANCEL
);

138 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

140  (
ªsu…
);

142 
	}
}

	@pthread_setconcurrency.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_£tc⁄cuºícy
 (
Àvñ
)

50 i‡(
Àvñ
 < 0)

52  
EINVAL
;

56 
±e_c⁄cuºícy
 = 
Àvñ
;

59 
	}
}

	@pthread_setschedparam.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$±hªad_£tsched∑øm
 (
±hªad_t
 
thªad
, 
pﬁicy
,

49 c⁄° 
sched_∑øm
 *
∑øm
)

51 
ªsu…
;

54 
ªsu…
 = 
	`±hªad_kûl
 (
thªad
, 0);

55 i‡(0 !
ªsu…
)

57  
ªsu…
;

61 i‡(
pﬁicy
 < 
SCHED_MIN
 ||Öﬁicy > 
SCHED_MAX
)

63  
EINVAL
;

67 i‡(
pﬁicy
 !
SCHED_OTHER
)

69  
ENOTSUP
;

72  (
	`±e_£âhªad¥i‹ôy
 (
thªad
, 
pﬁicy
, 
∑øm
->
sched_¥i‹ôy
));

73 
	}
}

77 
	$±e_£âhªad¥i‹ôy
 (
±hªad_t
 
thªad
, 
pﬁicy
, 
¥i‹ôy
)

79 
¥io
;

80 
ªsu…
;

81 
±e_thªad_t
 * 
ç
 = (±e_thªad_à*Ë
thªad
.
p
;

83 
¥io
 = 
¥i‹ôy
;

86 i‡(
¥io
 < 
	`sched_gë_¥i‹ôy_mö
 (
pﬁicy
) ||

87 
¥io
 > 
	`sched_gë_¥i‹ôy_max
 (
pﬁicy
))

89  
EINVAL
;

92 
ªsu…
 = 
	`±hªad_muãx_lock
 (&
ç
->
thªadLock
);

94 i‡(0 =
ªsu…
)

98 i‡(0 !
	`±e_osThªadSëPri‹ôy
(
ç
->
thªadId
, 
¥io
))

100 
ªsu…
 = 
EINVAL
;

108 
ç
->
sched_¥i‹ôy
 = 
¥i‹ôy
;

111 (Ë
	`±hªad_muãx_u∆ock
 (&
ç
->
thªadLock
);

114  
ªsu…
;

115 
	}
}

	@pthread_setspecific.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

50 
	$±hªad_£t•ecific
 (
±hªad_key_t
 
key
, c⁄° *
vÆue
)

76 
±hªad_t
 
£lf
;

77 
ªsu…
 = 0;

79 i‡(
key
 !
±e_£lfThªadKey
)

86 
£lf
 = 
	`±hªad_£lf
 ();

87 i‡(
£lf
.
p
 =
NULL
)

89  
ENOENT
;

98 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
	`±hªad_gë•ecific
 (
±e_£lfThªadKey
);

100 i‡(
•
 =
NULL
)

102 i‡(
vÆue
 =
NULL
)

104  
ENOENT
;

107 
£lf
 = *((
±hªad_t
 *Ë
vÆue
);

111 
£lf
 = 
•
->
±H™dÀ
;

115 
ªsu…
 = 0;

117 i‡(
key
 !
NULL
)

119 i‡(
£lf
.
p
 !
NULL
 && 
key
->
de°ru˘‹
 !NULL && 
vÆue
 != NULL)

130 
ThªadKeyAssoc
 *
assoc
;

132 i‡(
	`±hªad_muãx_lock
(&(
key
->
keyLock
)) == 0)

134 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
£lf
.
p
;

136 (Ë
	`±hªad_muãx_lock
(&(
•
->
thªadLock
));

138 
assoc
 = (
ThªadKeyAssoc
 *Ë
•
->
keys
;

142 
assoc
 !
NULL
)

144 i‡(
assoc
->
key
 == key)

151 
assoc
 =ássoc->
√xtKey
;

157 i‡(
assoc
 =
NULL
)

159 
ªsu…
 = 
	`±e_tkAssocCª©e
 (
•
, 
key
);

162 (Ë
	`±hªad_muãx_u∆ock
(&(
•
->
thªadLock
));

164 (Ë
	`±hªad_muãx_u∆ock
(&(
key
->
keyLock
));

167 i‡(
ªsu…
 == 0)

169 i‡(
	`±e_osTlsSëVÆue
 (
key
->key, (*Ë
vÆue
Ë!
PTE_OS_OK
)

171 
ªsu…
 = 
EAGAIN
;

177  (
ªsu…
);

178 
	}
}

	@pthread_spin_destroy.c

44 
	~<«utûus/«utûus.h
>

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

50 
	$±hªad_•ö_de°roy
 (
±hªad_•ölock_t
 * 
lock
)

52 
±hªad_•ölock_t
 
s
;

53 
ªsu…
 = 0;

55 i‡(
lock
 =
NULL
 || *lock == NULL)

57  
EINVAL
;

60 i‡((
s
 = *
lock
Ë!
PTHREAD_SPINLOCK_INITIALIZER
)

62 i‡(
s
->
öãæock
 =
PTE_SPIN_USE_MUTEX
)

64 
ªsu…
 = 
	`±hªad_muãx_de°roy
 (&(
s
->
u
.
muãx
));

66 i‡(
PTE_SPIN_UNLOCKED
 !=

67 
	`PTE_ATOMIC_COMPARE_EXCHANGE
 (

68 & (
s
->
öãæock
),

69 (Ë
PTE_OBJECT_INVALID
,

70 
PTE_SPIN_UNLOCKED
))

72 
ªsu…
 = 
EINVAL
;

75 i‡(0 =
ªsu…
)

81 *
lock
 = 
NULL
;

82 
	`‰ì
(
s
);

92 
	`±e_osMuãxLock
 (
±e_•ölock_ã°_öô_lock
);

97 i‡(*
lock
 =
PTHREAD_SPINLOCK_INITIALIZER
)

105 *
lock
 = 
NULL
;

113 
ªsu…
 = 
EBUSY
;

116 
	`±e_osMuãxU∆ock
(
±e_•ölock_ã°_öô_lock
);

120  (
ªsu…
);

121 
	}
}

	@pthread_spin_init.c

44 
	~<«utûus/«utûus.h
>

45 
	~"±hªad.h
"

46 
	~"im∂emít.h
"

50 
	$±hªad_•ö_öô
 (
±hªad_•ölock_t
 * 
lock
, 
psh¨ed
)

52 
±hªad_•ölock_t
 
s
;

53 
˝us
 = 0;

54 
ªsu…
 = 0;

56 i‡(
lock
 =
NULL
)

58  
EINVAL
;

61 i‡(0 !
	`±e_gë¥o˚ss‹s
 (&
˝us
))

63 
˝us
 = 1;

66 i‡(
˝us
 > 1)

68 i‡(
psh¨ed
 =
PTHREAD_PROCESS_SHARED
)

74 #i‡
_POSIX_THREAD_PROCESS_SHARED
 >= 0

80 #îr‹ 
ERROR
 [
__FILE__
, 
löe
 
__LINE__
]: 
Pro˚ss
 
sh¨ed
 
•ö
 
locks
 
¨e
 
nŸ
 
suµ‹ãd
 
yë
.

84  
ENOSYS
;

91 
s
 = (
±hªad_•ölock_t
Ë
	`ˇŒoc
 (1,  (*s));

93 i‡(
s
 =
NULL
)

95  
ENOMEM
;

98 i‡(
˝us
 > 1)

100 
s
->
u
.
˝us
 = cpus;

101 
s
->
öãæock
 = 
PTE_SPIN_UNLOCKED
;

105 
±hªad_muãx©å_t
 
ma
;

106 
ªsu…
 = 
	`±hªad_muãx©å_öô
 (&
ma
);

108 i‡(0 =
ªsu…
)

110 
ma
->
psh¨ed
 =Öshared;

111 
ªsu…
 = 
	`±hªad_muãx_öô
 (&(
s
->
u
.
muãx
), &
ma
);

112 i‡(0 =
ªsu…
)

114 
s
->
öãæock
 = 
PTE_SPIN_USE_MUTEX
;

117 (Ë
	`±hªad_muãx©å_de°roy
 (&
ma
);

120 i‡(0 =
ªsu…
)

122 *
lock
 = 
s
;

126 
	`‰ì
(
s
);

128 *
lock
 = 
NULL
;

131  (
ªsu…
);

132 
	}
}

	@pthread_spin_lock.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_•ö_lock
 (
±hªad_•ölock_t
 * 
lock
)

50 
±hªad_•ölock_t
 
s
;

52 i‡(
NULL
 =
lock
 || NULL == *lock)

54  (
EINVAL
);

57 i‡(*
lock
 =
PTHREAD_SPINLOCK_INITIALIZER
)

59 
ªsu…
;

61 i‡((
ªsu…
 = 
	`±e_•ölock_check_√ed_öô
 (
lock
)) != 0)

63  (
ªsu…
);

67 
s
 = *
lock
;

69  
PTE_SPIN_LOCKED
 ==

70 
	`PTE_ATOMIC_COMPARE_EXCHANGE
 (&(
s
->
öãæock
),

71 
PTE_SPIN_LOCKED
,

72 
PTE_SPIN_UNLOCKED
))

76 i‡(
s
->
öãæock
 =
PTE_SPIN_LOCKED
)

80 i‡(
s
->
öãæock
 =
PTE_SPIN_USE_MUTEX
)

82  
	`±hªad_muãx_lock
 (&(
s
->
u
.
muãx
));

85  
EINVAL
;

86 
	}
}

	@pthread_spin_trylock.c

44 
	~"±hªad.h
"

45 
	~"im∂emít.h
"

49 
	$±hªad_•ö_åylock
 (
±hªad_•ölock_t
 * 
lock
)

51 
±hªad_•ölock_t
 
s
;

53 i‡(
NULL
 =
lock
 || NULL == *lock)

55  (
EINVAL
);

58 i‡(*
lock
 =
PTHREAD_SPINLOCK_INITIALIZER
)

60 
ªsu…
;

62 i‡((
ªsu…
 = 
	`±e_•ölock_check_√ed_öô
 (
lock
)) != 0)

64  (
ªsu…
);

68 
s
 = *
lock
;

71 
	`PTE_ATOMIC_COMPARE_EXCHANGE
 (&(
s
->
öãæock
),

72 
PTE_SPIN_LOCKED
,

73 
PTE_SPIN_UNLOCKED
))

75 
PTE_SPIN_UNLOCKED
:

77 
PTE_SPIN_LOCKED
:

78  
EBUSY
;

79 
PTE_SPIN_USE_MUTEX
:

80  
	`±hªad_muãx_åylock
 (&(
s
->
u
.
muãx
));

83  
EINVAL
;

84 
	}
}

	@pthread_spin_unlock.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_•ö_u∆ock
 (
±hªad_•ölock_t
 * 
lock
)

50 
±hªad_•ölock_t
 
s
;

52 i‡(
NULL
 =
lock
 || NULL == *lock)

54  (
EINVAL
);

57 
s
 = *
lock
;

59 i‡(
s
 =
PTHREAD_SPINLOCK_INITIALIZER
)

61  
EPERM
;

65 
	`PTE_ATOMIC_COMPARE_EXCHANGE
 (&(
s
->
öãæock
),

66 
PTE_SPIN_UNLOCKED
,

67 
PTE_SPIN_LOCKED
))

69 
PTE_SPIN_LOCKED
:

71 
PTE_SPIN_UNLOCKED
:

72  
EPERM
;

73 
PTE_SPIN_USE_MUTEX
:

74  
	`±hªad_muãx_u∆ock
 (&(
s
->
u
.
muãx
));

77  
EINVAL
;

78 
	}
}

	@pthread_terminate.c

45 
	~<«utûus/«utûus.h
>

46 
	~<«utûus/«ut_°rög.h
>

47 
	~"±hªad.h
"

48 
	~"im∂emít.h
"

51 
	$±hªad_ãrmö©e
()

53 i‡(
±e_¥o˚ssInôülized
)

55 
±e_thªad_t
 * 
ç
, * 
çNext
;

57 i‡(
±e_£lfThªadKey
 !
NULL
)

62 
	`±hªad_key_dñëe
 (
±e_£lfThªadKey
);

64 
±e_£lfThªadKey
 = 
NULL
;

67 i‡(
±e_˛ónupKey
 !
NULL
)

72 
	`±hªad_key_dñëe
 (
±e_˛ónupKey
);

74 
±e_˛ónupKey
 = 
NULL
;

77 
	`±e_osMuãxLock
 (
±e_thªad_ªu£_lock
);

80 
ç
 = 
±e_thªadReu£T›
;

81 
ç
 !
PTE_THREAD_REUSE_EMPTY
)

83 
çNext
 = 
ç
->
¥evReu£
;

84 
	`‰ì
 (
ç
);

85 
ç
 = 
çNext
;

88 
	`±e_osMuãxU∆ock
(
±e_thªad_ªu£_lock
);

90 
±e_¥o˚ssInôülized
 = 
PTE_FALSE
;

93 
	}
}

	@pthread_testcancel.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

48 
	$±hªad_ã°ˇn˚l
 ()

77 
±hªad_t
 
£lf
 = 
	`±hªad_£lf
 ();

78 
±e_thªad_t
 * 
•
 = (±e_thªad_à*Ë
£lf
.
p
;

80 i‡(
•
 =
NULL
)

90 i‡(
•
->
°©e
 !
PThªadSèãC™˚lPídög
)

95 (Ë
	`±hªad_muãx_lock
 (&
•
->
ˇn˚lLock
);

97 i‡(
•
->
ˇn˚lSèã
 !
PTHREAD_CANCEL_DISABLE
)

99 
•
->
°©e
 = 
PThªadSèãC™˚lög
;

100 
•
->
ˇn˚lSèã
 = 
PTHREAD_CANCEL_DISABLE
;

102 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

103 
	`±e_throw
 (
PTE_EPS_CANCEL
);

106 (Ë
	`±hªad_muãx_u∆ock
 (&
•
->
ˇn˚lLock
);

107 
	}
}

	@pthread_timechange_handler_np.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

71 
	$±hªad_timech™ge_h™dÀr_≈
 (*
¨g
)

97 
ªsu…
 = 0;

98 
±hªad_c⁄d_t
 
cv
;

101 
	`±e_osMuãxLock
 (
±e_c⁄d_li°_lock
);

103 
cv
 = 
±e_c⁄d_li°_hód
;

105 
cv
 !
NULL
 && 0 =
ªsu…
)

107 
ªsu…
 = 
	`±hªad_c⁄d_brﬂdˇ°
 (&
cv
);

108 
cv
 = cv->
√xt
;

111 
	`±e_osMuãxU∆ock
(
±e_c⁄d_li°_lock
);

113  (*Ë(
ªsu…
 !0 ? 
EAGAIN
 : 0);

114 
	}
}

	@sched.h

51 #i‚de‡
_SCHED_H


52 
	#_SCHED_H


	)

54 
	~"nk/±e_ty≥s.h
"

56 #unde‡
PTE_LEVEL


58 #i‡
deföed
(
_POSIX_SOURCE
)

59 
	#PTE_LEVEL
 0

	)

63 #i‡
deföed
(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 199309

64 #unde‡
PTE_LEVEL


65 
	#PTE_LEVEL
 1

	)

69 #i‡
deföed
(
INCLUDE_NP
)

70 #unde‡
PTE_LEVEL


71 
	#PTE_LEVEL
 2

	)

75 
	#PTE_LEVEL_MAX
 3

	)

77 #i‡!
deföed
(
PTE_LEVEL
)

78 
	#PTE_LEVEL
 
PTE_LEVEL_MAX


	)

90 
	mSCHED_OTHER
 = 0,

91 
	mSCHED_FIFO
,

92 
	mSCHED_RR
,

93 
	mSCHED_MIN
 = 
SCHED_OTHER
,

94 
	mSCHED_MAX
 = 
SCHED_RR


97 
	ssched_∑øm


99 
	msched_¥i‹ôy
;

102 #ifde‡
__˝lu•lus


107 
sched_yõld
 ();

109 
sched_gë_¥i‹ôy_mö
 (
pﬁicy
);

111 
sched_gë_¥i‹ôy_max
 (
pﬁicy
);

113 
sched_£tscheduÀr
 (
pid_t
 
pid
, 
pﬁicy
);

125 
	#sched_º_gë_öãrvÆ
(
_pid
, 
_öãrvÆ
) \

126 –
î∫o
 = 
ENOTSUP
, (Ë-1 )

	)

129 #ifde‡
__˝lu•lus


133 #unde‡
PTE_LEVEL


134 #unde‡
PTE_LEVEL_MAX


	@sched_get_priority_max.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$sched_gë_¥i‹ôy_max
 (
pﬁicy
)

50  
	`±e_osThªadGëMaxPri‹ôy
();

51 
	}
}

	@sched_get_priority_min.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$sched_gë_¥i‹ôy_mö
 (
pﬁicy
)

50  
	`±e_osThªadGëMöPri‹ôy
();

51 
	}
}

	@sched_setscheduler.c

43 
	~"±hªad.h
"

44 
	~"im∂emít.h
"

45 
	~"sched.h
"

48 
	$sched_£tscheduÀr
 (
pid_t
 
pid
, 
pﬁicy
)

50 
î∫o
 = 
EPERM
;

52 
	}
}

	@sched_yield.c

45 
	~<«utûus/«utûus.h
>

46 
	~"nk/±e_oßl.h
"

48 
	~"±hªad.h
"

49 
	~"im∂emít.h
"

50 
	~"sched.h
"

53 
	$sched_yõld
 ()

79 
	`±e_osThªadSÀï
 (1);

82 
	}
}

	@sem_close.c

50 
	~"±hªad.h
"

51 
	~"£m≠h‹e.h
"

52 
	~"im∂emít.h
"

56 
	$£m_˛o£
 (
£m_t
 * 
£m
)

58 
î∫o
 = 
ENOSYS
;

60 
	}
}

	@sem_destroy.c

52 
	~<«utûus/«utûus.h
>

53 
	~"nk/±e_oßl.h
"

55 
	~"±hªad.h
"

56 
	~"£m≠h‹e.h
"

57 
	~"im∂emít.h
"

61 
	$£m_de°roy
 (
£m_t
 * 
£m
)

86 
ªsu…
 = 0;

87 
£m_t
 
s
 = 
NULL
;

89 i‡(
£m
 =
NULL
 || *sem == NULL)

91 
ªsu…
 = 
EINVAL
;

95 
s
 = *
£m
;

97 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&
s
->
lock
)) == 0)

99 i‡(
s
->
vÆue
 < 0)

101 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

102 
ªsu…
 = 
EBUSY
;

107 
±e_osResu…
 
osResu…
 = 
	`±e_osSem≠h‹eDñëe
(
s
->
£m
);

109 i‡(
osResu…
 !
PTE_OS_OK
)

111 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

112 
ªsu…
 = 
EINVAL
;

124 *
£m
 = 
NULL
;

128 
s
->
vÆue
 = 
SEM_VALUE_MAX
;

130 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

138 
	`±e_osThªadSÀï
(1);

140 
	`±hªad_muãx_de°roy
 (&
s
->
lock
Ë=
EBUSY
);

146 i‡(
ªsu…
 != 0)

148 
î∫o
 = 
ªsu…
;

152 
	`‰ì
 (
s
);

156 
	}
}

	@sem_getvalue.c

50 
	~"±hªad.h
"

51 
	~"£m≠h‹e.h
"

52 
	~"im∂emít.h
"

56 
	$£m_gëvÆue
 (
£m_t
 * 
£m
, *
svÆ
)

86 i‡(
£m
 =
NULL
 || *£m =NULL || 
svÆ
 == NULL)

88 
î∫o
 = 
EINVAL
;

93 
vÆue
;

94 
£m_t
 
s
 = *
£m
;

95 
ªsu…
 = 0;

97 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
(&
s
->
lock
)) == 0)

101 i‡(*
£m
 =
NULL
)

103 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

104 
î∫o
 = 
EINVAL
;

108 
vÆue
 = 
s
->value;

109 (Ë
	`±hªad_muãx_u∆ock
(&
s
->
lock
);

110 *
svÆ
 = 
vÆue
;

113  
ªsu…
;

116 
	}
}

	@sem_init.c

44 
	~<«utûus/«utûus.h
>

45 
	~"±hªad.h
"

46 
	~"£m≠h‹e.h
"

47 
	~"im∂emít.h
"

51 
	$£m_öô
 (
£m_t
 * 
£m
, 
psh¨ed
, 
vÆue
)

89 
ªsu…
 = 0;

90 
£m_t
 
s
 = 
NULL
;

93 i‡(
psh¨ed
 != 0)

99 
ªsu…
 = 
EPERM
;

101 i‡(
vÆue
 > ()
SEM_VALUE_MAX
)

103 
ªsu…
 = 
EINVAL
;

107 
s
 = (
£m_t
Ë
	`ˇŒoc
 (1,  (*s));

109 i‡(
NULL
 =
s
)

111 
ªsu…
 = 
ENOMEM
;

116 
s
->
vÆue
 = value;

117 i‡(
	`±hªad_muãx_öô
(&
s
->
lock
, 
NULL
) == 0)

120 
±e_osResu…
 
osResu…
 = 
	`±e_osSem≠h‹eCª©e
(0, &
s
->
£m
);

124 i‡(
osResu…
 !
PTE_OS_OK
)

126 (Ë
	`±hªad_muãx_de°roy
(&
s
->
lock
);

127 
ªsu…
 = 
ENOSPC
;

133 
ªsu…
 = 
ENOSPC
;

136 i‡(
ªsu…
 != 0)

138 
	`‰ì
(
s
);

143 i‡(
ªsu…
 != 0)

145 
î∫o
 = 
ªsu…
;

149 *
£m
 = 
s
;

153 
	}
}

	@sem_open.c

50 
	~"±hªad.h
"

51 
	~"£m≠h‹e.h
"

52 
	~"im∂emít.h
"

56 
	$£m_›í
 (c⁄° *
«me
, 
oÊag
, 
mode_t
 
mode
, 
vÆue
)

58 
î∫o
 = 
ENOSYS
;

60 
	}
}

	@sem_post.c

52 
	~<«utûus/«utûus.h
>

53 
	~"±hªad.h
"

54 
	~"£m≠h‹e.h
"

55 
	~"im∂emít.h
"

59 
	$£m_po°
 (
£m_t
 * 
£m
)

85 
ªsu…
 = 0;

86 
£m_t
 
s
 = *
£m
;

88 i‡(
s
 =
NULL
)

90 
ªsu…
 = 
EINVAL
;

92 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&
s
->
lock
)) == 0)

96 i‡(*
£m
 =
NULL
)

98 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

99 
ªsu…
 = 
EINVAL
;

103 i‡(
s
->
vÆue
 < 
SEM_VALUE_MAX
)

105 
±e_osResu…
 
osResu…
 = 
	`±e_osSem≠h‹ePo°
(
s
->
£m
, 1);

107 i‡(++
s
->
vÆue
 <= 0

108 && (
osResu…
 !
PTE_OS_OK
))

110 
s
->
vÆue
--;

111 
ªsu…
 = 
EINVAL
;

117 
ªsu…
 = 
ERANGE
;

120 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

123 i‡(
ªsu…
 != 0)

125 
î∫o
 = 
ªsu…
;

131 
	}
}

	@sem_post_multiple.c

52 
	~<«utûus/«utûus.h
>

53 
	~"±hªad.h
"

54 
	~"£m≠h‹e.h
"

55 
	~"im∂emít.h
"

59 
	$£m_po°_mu…ùÀ
 (
£m_t
 * 
£m
, 
cou¡
)

88 
ªsu…
 = 0;

89 
waôîs
;

90 
£m_t
 
s
 = *
£m
;

92 i‡(
s
 =
NULL
 || 
cou¡
 <= 0)

94 
ªsu…
 = 
EINVAL
;

96 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&
s
->
lock
)) == 0)

100 i‡(*
£m
 =
NULL
)

102 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

103 
ªsu…
 = 
EINVAL
;

107 i‡(
s
->
vÆue
 <(
SEM_VALUE_MAX
 - 
cou¡
))

109 
waôîs
 = -
s
->
vÆue
;

110 
s
->
vÆue
 +
cou¡
;

111 i‡(
waôîs
 > 0)

114 
	`±e_osSem≠h‹ePo°
(
s
->
£m
, (
waôîs
<=
cou¡
)?waiters:count);

115 
ªsu…
 = 0;

127 
ªsu…
 = 
ERANGE
;

130 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

133 i‡(
ªsu…
 != 0)

135 
î∫o
 = 
ªsu…
;

141 
	}
}

	@sem_timedwait.c

52 
	~<«utûus/«utûus.h
>

53 
	~"±hªad.h
"

54 
	~"£m≠h‹e.h
"

55 
	~"im∂emít.h
"

59 
£m_t
 
	m£m
;

60 * 
	mªsu…På
;

61 } 
	t£m_timedwaô_˛ónup_¨gs_t
;

64 
	$±e_£m_timedwaô_˛ónup
 (* 
¨gs
)

66 
£m_timedwaô_˛ónup_¨gs_t
 * 
a
 = (£m_timedwaô_˛ónup_¨gs_à*)
¨gs
;

67 
£m_t
 
s
 = 
a
->
£m
;

69 i‡(
	`±hªad_muãx_lock
 (&
s
->
lock
) == 0)

79 
timeout
 = 0;

80 i‡(
	`±e_osSem≠h‹ePíd
(
s
->
£m
, &
timeout
Ë=
PTE_OS_OK
)

83 *(
a
->
ªsu…På
) = 0;

88 
s
->
vÆue
++;

96 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

98 
	}
}

102 
	$£m_timedwaô
 (
£m_t
 * 
£m
, c⁄° 
time•ec
 *
ab°ime
)

141 
ªsu…
 = 0;

142 
£m_t
 
s
 = *
£m
;

145 
	`±hªad_ã°ˇn˚l
();

147 i‡(
£m
 =
NULL
)

149 
ªsu…
 = 
EINVAL
;

153 
mûli£c⁄ds
;

154 *
pTimeout
;

156 i‡(
ab°ime
 =
NULL
)

158 
pTimeout
 = 
NULL
;

165 
mûli£c⁄ds
 = 
	`±e_ªlmûli£cs
 (
ab°ime
);

166 
pTimeout
 = &
mûli£c⁄ds
;

169 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&
s
->
lock
)) == 0)

171 
v
;

175 i‡(*
£m
 =
NULL
)

177 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

178 
î∫o
 = 
EINVAL
;

182 
v
 = --
s
->
vÆue
;

183 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

185 i‡(
v
 < 0)

189 
£m_timedwaô_˛ónup_¨gs_t
 
˛ónup_¨gs
;

191 
˛ónup_¨gs
.
£m
 = 
s
;

192 
˛ónup_¨gs
.
ªsu…På
 = &
ªsu…
;

195 
	`±hªad_˛ónup_push
(
±e_£m_timedwaô_˛ónup
, (*Ë&
˛ónup_¨gs
);

197 
ªsu…
 = 
	`±e_ˇn˚ŒabÀ_waô
(
s
->
£m
,
pTimeout
);

199 
	`±hªad_˛ónup_p›
(
ªsu…
);

206 i‡(
ªsu…
 != 0)

209 
î∫o
 = 
ªsu…
;

216 
	}
}

	@sem_trywait.c

50 
	~"±hªad.h
"

51 
	~"£m≠h‹e.h
"

52 
	~"im∂emít.h
"

56 
	$£m_åywaô
 (
£m_t
 * 
£m
)

85 
ªsu…
 = 0;

86 
£m_t
 
s
 = *
£m
;

88 i‡(
s
 =
NULL
)

90 
ªsu…
 = 
EINVAL
;

92 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&
s
->
lock
)) == 0)

96 i‡(*
£m
 =
NULL
)

98 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

99 
î∫o
 = 
EINVAL
;

103 i‡(
s
->
vÆue
 > 0)

105 
s
->
vÆue
--;

109 
ªsu…
 = 
EAGAIN
;

112 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

115 i‡(
ªsu…
 != 0)

117 
î∫o
 = 
ªsu…
;

123 
	}
}

	@sem_unlink.c

50 
	~"±hªad.h
"

51 
	~"£m≠h‹e.h
"

52 
	~"im∂emít.h
"

56 
	$£m_u∆ök
 (c⁄° *
«me
)

58 
î∫o
 = 
ENOSYS
;

60 
	}
}

	@sem_wait.c

52 
	~<«utûus/«utûus.h
>

53 
	~"±hªad.h
"

54 
	~"£m≠h‹e.h
"

55 
	~"im∂emít.h
"

59 
	$±e_£m_waô_˛ónup
(* 
£m
)

61 
£m_t
 
s
 = (£m_tË
£m
;

62 
timeout
;

64 i‡(
	`±hªad_muãx_lock
 (&
s
->
lock
) == 0)

73 
timeout
 = 0;

74 i‡(
	`±e_osSem≠h‹ePíd
(
s
->
£m
, &
timeout
Ë!
PTE_OS_OK
)

76 ++
s
->
vÆue
;

84 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

86 
	}
}

90 
	$£m_waô
 (
£m_t
 * 
£m
)

120 
ªsu…
 = 0;

121 
£m_t
 
s
 = *
£m
;

123 
	`±hªad_ã°ˇn˚l
();

125 i‡(
s
 =
NULL
)

127 
ªsu…
 = 
EINVAL
;

131 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&
s
->
lock
)) == 0)

133 
v
;

137 i‡(*
£m
 =
NULL
)

139 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

140 
î∫o
 = 
EINVAL
;

144 
v
 = --
s
->
vÆue
;

145 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

147 i‡(
v
 < 0)

150 
	`±hªad_˛ónup_push
(
±e_£m_waô_˛ónup
, (*Ë
s
);

151 
ªsu…
 = 
	`±e_ˇn˚ŒabÀ_waô
(
s
->
£m
,
NULL
);

153 
	`±hªad_˛ónup_p›
(
ªsu…
);

168 i‡(
ªsu…
 != 0)

170 
î∫o
 = 
ªsu…
;

176 
	}
}

180 
	$£m_waô_noˇn˚l
 (
£m_t
 * 
£m
)

211 
ªsu…
 = 0;

212 
£m_t
 
s
 = *
£m
;

214 
	`±hªad_ã°ˇn˚l
();

216 i‡(
s
 =
NULL
)

218 
ªsu…
 = 
EINVAL
;

222 i‡((
ªsu…
 = 
	`±hªad_muãx_lock
 (&
s
->
lock
)) == 0)

224 
v
;

228 i‡(*
£m
 =
NULL
)

230 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

231 
î∫o
 = 
EINVAL
;

235 
v
 = --
s
->
vÆue
;

236 (Ë
	`±hªad_muãx_u∆ock
 (&
s
->
lock
);

238 i‡(
v
 < 0)

240 
	`±e_osSem≠h‹ePíd
(
s
->
£m
, 
NULL
);

246 i‡(
ªsu…
 != 0)

248 
î∫o
 = 
ªsu…
;

254 
	}
}

	@semaphore.h

52 #i‡!
deföed
–
SEMAPHORE_H
 )

53 
	#SEMAPHORE_H


	)

55 #i‡
deföed
(
_POSIX_SOURCE
)

56 
	#PTE_LEVEL
 0

	)

60 #i‡
deföed
(
INCLUDE_NP
)

61 #unde‡
PTE_LEVEL


62 
	#PTE_LEVEL
 2

	)

70 
	#_POSIX_SEMAPHORES


	)

72 #ifde‡
__˝lu•lus


78 
£m_t_
 * 
	t£m_t
;

80 
£m_öô
 (
£m_t
 * 
£m
,

81 
psh¨ed
,

82 
vÆue
);

84 
£m_de°roy
 (
£m_t
 * 
£m
);

86 
£m_åywaô
 (
£m_t
 * 
£m
);

88 
£m_waô
 (
£m_t
 * 
£m
);

90 
£m_timedwaô
 (
£m_t
 * 
£m
,

91 c⁄° 
time•ec
 * 
ab°ime
);

93 
£m_po°
 (
£m_t
 * 
£m
);

95 
£m_po°_mu…ùÀ
 (
£m_t
 * 
£m
,

96 
cou¡
);

98 
£m_›í
 (c⁄° * 
«me
,

99 
oÊag
,

100 
mode_t
 
mode
,

101 
vÆue
);

103 
£m_˛o£
 (
£m_t
 * 
£m
);

105 
£m_u∆ök
 (c⁄° * 
«me
);

107 
£m_gëvÆue
 (
£m_t
 * 
£m
,

108 * 
svÆ
);

110 #ifde‡
__˝lu•lus


	@/usr/include/limits.h

22 #i‚de‡
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<bôs/libc-hódî-°¨t.h
>

32 
	#MB_LEN_MAX
 16

	)

37 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

42 #i‚de‡
_LIMITS_H


43 
	#_LIMITS_H
 1

	)

45 
	~<bôs/w‹dsize.h
>

54 
	#CHAR_BIT
 8

	)

57 
	#SCHAR_MIN
 (-128)

	)

58 
	#SCHAR_MAX
 127

	)

61 
	#UCHAR_MAX
 255

	)

64 #ifde‡
__CHAR_UNSIGNED__


65 
	#CHAR_MIN
 0

	)

66 
	#CHAR_MAX
 
UCHAR_MAX


	)

68 
	#CHAR_MIN
 
SCHAR_MIN


	)

69 
	#CHAR_MAX
 
SCHAR_MAX


	)

73 
	#SHRT_MIN
 (-32768)

	)

74 
	#SHRT_MAX
 32767

	)

77 
	#USHRT_MAX
 65535

	)

80 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

81 
	#INT_MAX
 2147483647

	)

84 
	#UINT_MAX
 4294967295U

	)

87 #i‡
__WORDSIZE
 == 64

88 
	#LONG_MAX
 9223372036854775807L

	)

90 
	#LONG_MAX
 2147483647L

	)

92 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

95 #i‡
__WORDSIZE
 == 64

96 
	#ULONG_MAX
 18446744073709551615UL

	)

98 
	#ULONG_MAX
 4294967295UL

	)

101 #ifde‡
__USE_ISOC99


104 
	#LLONG_MAX
 9223372036854775807LL

	)

105 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

108 
	#ULLONG_MAX
 18446744073709551615ULL

	)

122 #i‡
deföed
 
__GNUC__
 && !deföed 
_GCC_LIMITS_H_


124 #ö˛ude_√xà<
limôs
.
h
>

130 #i‡
deföed
 
__USE_ISOC99
 && deföed 
__GNUC__


131 #i‚de‡
LLONG_MIN


132 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

134 #i‚de‡
LLONG_MAX


135 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

137 #i‚de‡
ULLONG_MAX


138 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

145 #i‡
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

146 #i‚de‡
CHAR_WIDTH


147 
	#CHAR_WIDTH
 8

	)

149 #i‚de‡
SCHAR_WIDTH


150 
	#SCHAR_WIDTH
 8

	)

152 #i‚de‡
UCHAR_WIDTH


153 
	#UCHAR_WIDTH
 8

	)

155 #i‚de‡
SHRT_WIDTH


156 
	#SHRT_WIDTH
 16

	)

158 #i‚de‡
USHRT_WIDTH


159 
	#USHRT_WIDTH
 16

	)

161 #i‚de‡
INT_WIDTH


162 
	#INT_WIDTH
 32

	)

164 #i‚de‡
UINT_WIDTH


165 
	#UINT_WIDTH
 32

	)

167 #i‚de‡
LONG_WIDTH


168 
	#LONG_WIDTH
 
__WORDSIZE


	)

170 #i‚de‡
ULONG_WIDTH


171 
	#ULONG_WIDTH
 
__WORDSIZE


	)

173 #i‚de‡
LLONG_WIDTH


174 
	#LLONG_WIDTH
 64

	)

176 #i‚de‡
ULLONG_WIDTH


177 
	#ULLONG_WIDTH
 64

	)

181 #ifdef 
__USE_POSIX


183 
	~<bôs/posix1_lim.h
>

186 #ifdef 
__USE_POSIX2


187 
	~<bôs/posix2_lim.h
>

190 #ifdef 
__USE_XOPEN


191 
	~<bôs/x›í_lim.h
>

	@
1
.
1
/usr/include
135
2969
cleanup.c
create.c
global.c
implement.h
need_errno.h
nk/nk_osal.c
nk/pte_generic_osal.h
nk/pte_osal.h
nk/pte_types.h
nk_generic_oasl.c
pte_callUserDestroyRoutines.c
pte_cancellable_wait.c
pte_cond_check_need_init.c
pte_detach.c
pte_generic_osal.h
pte_getprocessors.c
pte_is_attr.c
pte_mutex_check_need_init.c
pte_new.c
pte_relmillisecs.c
pte_reuse.c
pte_rwlock_cancelwrwait.c
pte_rwlock_check_need_init.c
pte_spinlock_check_need_init.c
pte_threadDestroy.c
pte_threadStart.c
pte_throw.c
pte_tkAssocCreate.c
pte_tkAssocDestroy.c
pthread.h
pthread_attr_destroy.c
pthread_attr_getdetachstate.c
pthread_attr_getinheritsched.c
pthread_attr_getschedparam.c
pthread_attr_getschedpolicy.c
pthread_attr_getscope.c
pthread_attr_getstackaddr.c
pthread_attr_getstacksize.c
pthread_attr_init.c
pthread_attr_setdetachstate.c
pthread_attr_setinheritsched.c
pthread_attr_setschedparam.c
pthread_attr_setschedpolicy.c
pthread_attr_setscope.c
pthread_attr_setstackaddr.c
pthread_attr_setstacksize.c
pthread_barrier_destroy.c
pthread_barrier_init.c
pthread_barrier_wait.c
pthread_barrierattr_destroy.c
pthread_barrierattr_getpshared.c
pthread_barrierattr_init.c
pthread_barrierattr_setpshared.c
pthread_cancel.c
pthread_cond_destroy.c
pthread_cond_init.c
pthread_cond_signal.c
pthread_cond_wait.c
pthread_condattr_destroy.c
pthread_condattr_getpshared.c
pthread_condattr_init.c
pthread_condattr_setpshared.c
pthread_delay_np.c
pthread_detach.c
pthread_equal.c
pthread_exit.c
pthread_getconcurrency.c
pthread_getschedparam.c
pthread_getspecific.c
pthread_init.c
pthread_join.c
pthread_key_create.c
pthread_key_delete.c
pthread_kill.c
pthread_mutex_destroy.c
pthread_mutex_init.c
pthread_mutex_lock.c
pthread_mutex_timedlock.c
pthread_mutex_trylock.c
pthread_mutex_unlock.c
pthread_mutexattr_destroy.c
pthread_mutexattr_getkind_np.c
pthread_mutexattr_getpshared.c
pthread_mutexattr_gettype.c
pthread_mutexattr_init.c
pthread_mutexattr_setkind_np.c
pthread_mutexattr_setpshared.c
pthread_mutexattr_settype.c
pthread_num_processors_np.c
pthread_once.c
pthread_rwlock_destroy.c
pthread_rwlock_init.c
pthread_rwlock_rdlock.c
pthread_rwlock_timedrdlock.c
pthread_rwlock_timedwrlock.c
pthread_rwlock_tryrdlock.c
pthread_rwlock_trywrlock.c
pthread_rwlock_unlock.c
pthread_rwlock_wrlock.c
pthread_rwlockattr_destroy.c
pthread_rwlockattr_getpshared.c
pthread_rwlockattr_init.c
pthread_rwlockattr_setpshared.c
pthread_self.c
pthread_setcancelstate.c
pthread_setcanceltype.c
pthread_setconcurrency.c
pthread_setschedparam.c
pthread_setspecific.c
pthread_spin_destroy.c
pthread_spin_init.c
pthread_spin_lock.c
pthread_spin_trylock.c
pthread_spin_unlock.c
pthread_terminate.c
pthread_testcancel.c
pthread_timechange_handler_np.c
sched.h
sched_get_priority_max.c
sched_get_priority_min.c
sched_setscheduler.c
sched_yield.c
sem_close.c
sem_destroy.c
sem_getvalue.c
sem_init.c
sem_open.c
sem_post.c
sem_post_multiple.c
sem_timedwait.c
sem_trywait.c
sem_unlink.c
sem_wait.c
semaphore.h
/usr/include/limits.h
